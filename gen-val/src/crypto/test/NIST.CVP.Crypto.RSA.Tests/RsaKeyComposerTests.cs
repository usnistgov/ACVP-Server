using NIST.CVP.Crypto.Common.Asymmetric.RSA.Keys;
using NIST.CVP.Crypto.Common.Asymmetric.RSA.PrimeGenerators;
using NIST.CVP.Math;
using NIST.CVP.Tests.Core.TestCategoryAttributes;
using NUnit.Framework;

namespace NIST.CVP.Crypto.RSA.Tests
{
    [TestFixture, FastCryptoTest]
    public class RsaKeyComposerTests
    {
        [Test]
        [TestCase("0100000001",
            "ff03b1a74827c746db83d2eaff00067622f545b62584321256e62b01509f10962f9c5c8fd0b7f5184a9ce8e81f439df47dda14563dd55a221799d2aa57ed2713271678a5a0b8b40a84ad13d5b6e6599e6467c670109cf1f45ccfed8f75ea3b814548ab294626fe4d14ff764dd8b091f11a0943a2dd2b983b0df02f4c4d00b413",
            "dacaabc1dc57faa9fd6a4274c4d588765a1d3311c22e57d8101431b07eb3ddcb05d77d9a742ac2322fe6a063bd1e05acb13b0fe91c70115c2b1eee1155e072527011a5f849de7072a1ce8e6b71db525fbcda7a89aaed46d27aca5eaeaf35a26270a4a833c5cda681ffd49baa0f610bad100cdf47cc86e5034e2a0b2179e04ec7",
            "d9f3094b36634c05a02ae1a5569035107a48029e39b3c6a1853817f063e18e761c0c538e55ff2c7e53d603bb35cabb3b8d07f82aa0afdeaf7441fcf6746c5bcaaa2cde398ad73edb9c340c3ffca559132581eaf8f65c13d02f3445a932a3e1fadb5912f7553edec5047e4d0ed06ee87effc549e194d38e06b73a971c961688ba2d4aa4f450d2523372f317d41d06f9f0360e962ce953a69f36c53c370799fcfba195e8f691ebe862f84ae4bbd7747bc14499bd0efffcdc7154325908355c2ffc5b3948b8102b33aa2420381470e4ee858380ff0eea58288516c263f6d51dbbd0e477d1393a0a3ee60e1fde4330856665bf522006608a6104c138c0f39e09c4c5",
            "1bf009caddc664b4404d59711fde16d7c55822449de1c5a084d22ed5791fdaa37ea538867fc91a17e6856e277c2dedd70ca8bf6ec44b0e729917a88e5988cc561d948ddeea46e21fd8ff46cce7657c94bfb1bdf40b3b30d4595a8bc3a15f1d4ad4c665c09b3b265ba19cdb0b89cbaadd0097ff52e9f6e594f86829c5bb4e9ba0200f12fa6dc60fd28dec0d194f08deb50f5a7749540160d6e8338e75b11165b76f4650c2fcce08f979ad9941daedaa5e328473bf712f8f549c36967f5e15477dc643d1f48d563139134e5cdc4bb84f9782cd5125e864e067cb980290f215cb41090e297bac2714efba61115d85613851c2de50a82f4ab526b88c61b7c9a0b589")]
        [TestCase("0100000001",
            "f006d9631c1fc1f7b4feda14a87e4ba096394d49cbeb16e7b16fe201026dd370fe5d630139c7a4715c6278919a38aafa558092728feabbce49a23aa5a69245f78b705da5340e63b81fd0e8fc999f39e8c26c930bc92fb88bd81873fd67d89284a1ff6e677a8951d5589f7be18822cec86ad5092fb60bbe66cdd41628be6afc5ad03452bc72e926600e26252b5bae60af0f769e966bc231318152c671c2b69fe5d004898413a65478ed058cce1a1c6ae545afd3eed439dcd0f82a3965381d0a6f",
            "efbfd0ef2afa51bb74ad1b8aa1cab32ef68c02d91a4f49aebffa98bbd1a1b17d37286baa3221cabb8f6ef0951afbc6f2ae9390c29100b8235cdcef943aa5849e8fb07fb50d8451bc8734bd40ae98d3633ec63f95a1f73237c303127a6e4cf88b1a57a817c4bbb833a49e82dfc2f965709a6d11637221d7db74e8f9b4745eb12ca5ec4d571535e4e4e457f7ec02dca08a62a7b88946976ed5a1bf7da7cebd2a7a6cd87e49f7ec01989549f4fe750776213562d486fb89ecdc6f344a44ab05dc2d",
            "e0ca3df58784ef25839e8e25360a06c1fdab9f869e16d9f0308c68e4e794ca993f566f9f05a2cd2613a0dfcd1c5811dc96e26bb44a33de4d993b1505c480394f2ee6a151bd96bb2c067fc8d91b1840c5ff388d7f2f55813a08fc1d1b4b2160c3b7c7986b12ca4a859e755be9cfb1d6651baeae408e6ac14337fe6cc9579e62231f2e3297da0d001b503303d80ba39f01710a08a61ed04b1793fab5a132f8f9e173377f5f04e4262caac2c1a8ff59e306069e5e15a3b16823fb503fcff2383c2897a27d9f62a35d4ab0d92ebf9470cef8873eaf6231902da7b269a418ac9c2ea3ac59083dc768736789848a1506e080a489686fe795354713180aee28a22f729d2cf6c2a7caf9bf9025050c1eb83d9122280fc278b431e87752d21eac7d369eec96cbb89f323e658a7f723dd45a587abc3ccc78ac7dc2df33cc5e4cb4a28dcb270b4ad9ce72f7fba0e8818c20dbd33dc2cc8cdf64272a44419dd101a6c34a5e7c6347eff01ce16132b44c6b2f6568a3bd206d974902753d15307b6d092b3d3983",
            "39d70d55f2de05d384f4af6d405e7d6d52d5346e9b9eebc51281ca88fbb62c8454b3c37d33b6166b507db649241f5e8ece26750b098c62ad43825c98ecc6ef82cc9305c424a12a46a61aa33efea7642db91800892c5f9886b43795e946916749fa30cdf289dfc5bf7f939ec445c3b873af374a9566c1e441bbef08a6fdf154ec6559d78a54d571964e60663d4217ba82f53ed306ba5a870e344f0be2332b939ee97b75f34b846fb4ac53d2f489ab0c755c749fd7c3c124232149a05eb916a13bd2d16e474e379bf0ee32f1c3cd00c3c86a0a9ff7e699962cb80cd1c593b77f4ec84f78324496fd8ba2c1c7e315733372472f8ef0b6c148497573dbaf53014cc8fda091c2b196d38b72a57363eec2872e5d3bdba0e20fc3f0ed0fe378bf563d7d6a6cf8b4dca48e5581d5a65cd1e4e97ac30e9a093ab38351d86dba96d0898dece6935c4788a52633da355e322d2836e119de2d76727456e117e022e095600aa1af79139f539409baaffe2363f0fb2bf6341a4dd4ece72b193e865a5ce3b1cb4d")]
        [TestCase("0123456789",
            "FF78DB51E9D1CD70947A7AF8ED89EF70ADF410DDD190555C7986CFB0ABF2183E2F108300E449C751FEE308743FBDDB708771319C66129E1E94C0DDE2862FF86892C536335E636D8D8BB4B2D0C51DD2EC1A36C4688AD34E1D9CADF4E755E16417076F6FA379AF07E1A1A7A9041366CE32DC5B5F6E5238FFD91BE494FB4F2B8868D84B118D054A4E4383FFFAA42BEB626513BCD30F13D6D0C470662117DC95D1F1099AD9CF96EE3EDBA204457CFF1B841013B79114A15FDFC56F07C887332E17EF",
            "F0DDAB3F1BCA6C12131F5628A20ADE9885E6C87769FC7119E7E5CB8E331749E7B23A2271C7C44AB11FF4D5965937C0D875F511B4BFE164A1CDC5267899FF9E91ABA0C5E6C87A4578A15732BB18F08E5F9E673737B5230E746810F9A12E06753E1DC56CE763BDE7F6A2688A7D9715A892E02A808CB5EAD917D570C762685045A440136BA0C626E1C967B7C982BC42470078D5B9D9E6B69268E4DE26C6656ADE791F49D65D7855F1B7A9F4E8634F134E48C7824E5FBC73AD871595EF3E0B31A767",
            "F05E83D6D5E4FB674CA59B6A9953EE4BFF640ED9FFEC2E022188F6DFCFF4474B43575D42691D6F13CE100AC59245555BA3680D0EF1569B988312F1BDDE3901E206DB5E0EE56C89A701AAE3941AA7B03B8397C75B1404D3128AB37023D8D54A7BA148A0B3E6790157E9FC74DEC3779A3643C921750507339BFF8F2C0966FE395BE14F4D4C04938475B9293C44261B76A0A670217AB68DA39A1C845149841697E86912209892B263AAC60AEEBAE9DBB16BEA74F19E5F5498F38998B58D135A3276E103BBB54808310257625A9E8777F18B4E8825F8F60AE040265B8961A854C58FA16973A85B3B012E1CD203EF545559022B201558056C65E40FB3A8EDF1C4F6B92119E741A785957B5A07FD2CF4E2B9DB04AB4494D72CF0E8049A19908222AC08AB855AE3181E3026123F972846AF3FAD5B4FF6F5B7B4AC52D9362134941AB894D2A49EB86DD28D32843EFD50684411E8408DF057EDDC559D453F1BD7B88E73A715666BA2366FEA7AA23E7ACEB7B9786A853C45D926F0E752E7A2948482E78A29",
            "3C73C54156108B6F387DA16AC4661C6FAEC960EC220F76AB53676A6BB3A21DAEA4153534C8D66D2B720D4C188C4775335A19AEDDF483FE496A3F798011AFD47FCB6EC1EF1C7A65D7CCA625D5895E9B1248F8A182F9D802B9887DDBB83BAF6A05BD104388F55BCE204B6776DCE1D96FEB32E23B5D806A824E16BEE48C79DCF732DF35F21EBA06E3DBAEE3530CB5450BFD5EC664B125067CDE8F944D17249C4F74980806F72C8B6F4FB9796D5C728833998E2598BF81652A0E5DF48CD83EB85BF2018B6E3A4780F710FE6065685B8E4B515A70024DE2CFF4C434E78BA4159E01B7DCB8D34C71A288DB64CFB8DD737C80B66038AD00C56383971374318765E890FD71AF8F6A4255E990F828364396DF3C24C403D71B1E5403B19CACF3806451F1BCAA15FFA1F47C5310489DA69ECB97B5632BA7EC5363EC101F83ABB287211AEF5D16068EF2990CBFC2FEC95B66D2DCC32D70CDF8A98435114A36EBC4037EC40EF771901866F355E4D8A43BC30701CB139FB52377AFAFB58352DAC5157E81CACFD1")]
        [TestCase("0100000001",
            "C4D2728AC513E73D818071CD4264F881D9D66220B4CF8036B334610BDE7AB774792089EE2329580F6C833B6BE182C4D1D023DBC41C5CA7612E6C4EB7BE3FB2CED20D463EF6A8B23E20DFC3B8BB4A850967E78977C2A591D022C59FED8FFE741DF0BC32FA173FB7696109E66837FC98E8D75715B5B422A3B82E47DF0B1669999B8066AB300130C49FD1D13B24935A26267DCF7DEDA84DCEDC1882BE5C982BC0F7D82F92F1213D39B48C022B21310B6DB20AC1237A55D6C0CF41F05D842E40F42D6D0EAEFBB2CFBF4270DB5F1F4A79BD21F4856B07B893B5DEA6A053F18194003FFE2C9117E7CF75D826E26077CC34B75362518F6A3F0A3B8DF2D73CD823DCB9AB",
            "DC0BB605093DF12CFD6670B0151AFFE61FC587603C8B05B5AA596C3E66634655DE9AB592E0D920948A8B3A01A26A6A66C51010EE2A2BDA250C6D79C36D67A9484BCC10B641A702BA3912D0713BAF052B99A0E1F524B03200133B42FBBAE02B49B13B2C3B221506B7CBA21A16371ED269E7AD021D06DA9E2C2E1D2CA46325ACE8627287EAE6C13CBDF17D70810FF92C658CBE492AD5E7057A53608FDF8B9ABB98CDDFDEF58387A990201C2B7310BAAD5E344AF1967FD18BEB0C62ECC31BC5328B3E61F2917022DEB0C8A6A7A752744725273DCA4252C804F6FB4ACCCF8F18DE2BFCAF16C80EA54E4542FEBDF92A82757193CB7F237E1CAC68628021B05A294541",
            "A92DDB6BA9F97CFEAB89EA873BB177CD8C147CFBFEBE0E9E821A6B7741682D4FF1A3625B7F79C8007AEF146467C1555A29ADD941910FDDC03CE57E7FF82703B94C945EE3BF71787CE56E0CC63AF70AF306F5C22B72D85D98E0C4CB7059E2DA97BB82974D5E10B04CEC63C0D0D01ABB9588908F58CB95EEA31D995471382D0559CD94033C9E27EE06B1F617CEAF5015FF96991AFB4865C6AC59C534E58ABA4B90D8CA60A68D697FA8F5BF035D96C6C088271EE33513914B064CD1F1DD26E9E9184717711A2885A0653E05977AE25D68D008537DC31BCE18095DF0D24BF807D72EB8BCEAC87A8C88B225B7504C960A3F2CF7A0241CAD7DE359A5664DC10CCEE658B3308B400879A3417190AFC4958275CF803A93624B4A5C802A3B6D940F6F0B6E68DE4D66449F6EC3002B4E7AE4FEB93859EF5950508BCE1B369450B639A50C3CDD7D080001B11C9C7C71C3A9FC958F9294FA7630DEB941B8A162C6B624BC3DB9DB819DF538A03B4ED9F637BA2D111075E6D3CF2E78DBDB254462E478A47DC947D48B37C2169781E8172FFB5744A3FCDE3DB403E2B0BE7CBBCEA115A3053B2DC0230A42F115503DA419A68F74EA3F085986D095D285F86D802BE70445489293B0A3ED06C1C163C65A743F232AAE660A876510F1F0B0308EC8226D0EBBFC38DCB17EF96A78EC9ECBE56FA26324787812042BAF8427687E617BCE74BCBB73793B6B",
            "1E1EBEBAE510AF75223B8B178546C52D8EB1EE172CD18FD8CC7BC5C6449E3B809C79983FA678FCB32EADA15256CC7147C385A6A42118FD90B38F503007F76C39FACAC63D84E7564EA125448D929D3D4135890DE1011F917B4980C51A2B6B0B18B9F065E477A838FA13AA6061E766101377DE6968F5685851AEE5670D610C97D90C3CEF957677F72A7D6FD8AD37DA2CF9AEA635D04C1D0B3ADB1B11DB6B1BFDC90FFF1D3FAA782207531BE52002710C4FFB756477D6E0DE4CDE24D23787E26727F30F6D0E7D9E7BF4B1A4C806B2EBE056D684DC162D62DAF0CF0F80E32084E78C8D0376FD8E4E1AAF2176253286638CA11608BD939C898DB63ACD2ED6B052FA93AB05E2C5AFC201C480700778E25777D19B0E220F6E1EFE458C02ECC0C48731E2CF1642138E59FDD27A077DB28EBDDE7FCE29B5EE67A869260D3666F337E79228074827D3736A1B7DF035036C842DC6EDECC9F9338365D3E9A681F55EE4E0BC0FA8D0A931B349603525ECF50501BFCD6490CE33AA6F29C649C4AEB3F55E4F57A184A23D9F29A2149F14C0A274FD26ABF0BA24AE56762BE5B63B636E5F65B66821E2665A4D54D16D65A5C61B4F14EA4EA7BE5BFEB3A01DE0E568FE7591C50684EAAC4B97328CBAC39C8D213A8F6B799EBEC82EDFA616D5D5278F82A321CD2AFF7C348A9C1F295AFE219A652A38A8251BE30D754258040C4819D8277E0B74C069C1")]
        [TestCase("0100000001",
            "C0DB6FA164F8D21584C434C062C8D4737B46116D2D0614745AE04AB0E8FE455758C83C609A47D171EF9EA9AB5AC5730B6F5D9EC682CEC40EABE084D107ADA53F53497D0B9423DCA191F5824CA05B36E62E1A9C74B7B6B1E595158D8F12E9EB5F9F10842537B2241B96C1F9EEC08C9752EE0F1A7661C3698C969F201543CAB6201BACCF157DF85A69C390D9DF76E093DBD8E9808B176154AF514EB212D58C31CC4B94EDDFB8FD4F87994627A72364CC7F6C6DB61DB27A69E72927215F014D5890F417FC2A705AC507971F80EDC4B2FC499E3F4C178EC02D91BF6B6998E491309F33BC87FD728666E83F01B260470446AEE1A96BED5632882867307F4329556E73",
            "D6ACDCCCC3A22935A0C5FAA08E8A87FED9B8F51EB4C5BDFC942C842C7CCF75E958A46F3ACACCB5ADF5BB9805A53BA308D9140825A14B1E58557F3412EC0BE34AAF58D46851431D6A64F7B02EA9AF5DD0BB3774459342533DD00686015FA12A949F07329698703E5E1F06E5AD941FD0F5000C1299F6016A96165639ECA493C3DEDEAF4557743241EF03FCE8BC0D02A22EA143BCE68E628D258AF45C5A18E6E2636DA97FC84C98BC1C39E522E7E3BFAB14E5EB6808A2987F97A7939A89F96675012E93BB5F3A024F4B61CBE0F539875AB4BDE57005B9FC3087F82D308E02BF90E88B2F835C4FD64CBBF9B4C8E2A7FC42B656FB72BCF14D3523151FE0D6E2F1F305",
            "A1B9A916C104CE1D8DBBCDACCA47B4B50A23EE47A08BC483C99BC26617AD6052CB0134013BB2C9C2ADF9B74998C5DC4346E4B6CCE5A7A520A5C904A3029E002992F344AC94A991AB69D54819EBEBC03A0806E2BF1207E889DC69545C1B34EBE013DB6401190B0E74A611D68D4F24A9C817B514E30C73C6AB99C4D6DBD6C08FE841C7F0AD2CA837794DA18C018049A56DA26A0F785288297069D39449A78A2409D50D3717A7AE6FDC2956EC2B11BD2DA70B1D33A3F44624BDA6249CE2A2EB3C964D527722D724C3C959FDAE099895C7B69852F6E3AA64F4FC813AB15B5B91110353DF8CB89561D2398A6046AF8CDC38C0D05E97CD140FAD3D0B8D60060B822B6A9F27B3DD5E7453B36A3438DA9BA16C127C449495D30974AB47D5491096D97AE0B95B59C38E257E107055705F6C9B01B61E017A3391B2E2685461A5BD03F6AF2B1D0A7D8E2362D488DDBFD59F770AC095E2CEB2054056A211D2BB92609D4F8D5FE4C5CE5963E13F0283038EEA34A606DF7FDA115977B32C97294F9B5068055426E13ACD8056D729A12762FD6591EBB49AD525917858C86B9D62FAA9F758AA6BA4C1F46990C915B8C6A2BBACA99F4FDAA4F3E28694056B0B0511AAE1DEB1EE9F52FF23ECC66B465B99EBA7C7FB8FE9047204C01468BFE727577AF7AFAAC5D92CAFE859F2F8700D7BAD2AC93B66E6BB4C2266C94778EEEB0A2E4272859C66C5513F",
            "0ECD7BFEF1BB030DD56A66F7D5E1CC14DB7FB7CE8A67089BA70F0596BE7C1B9B829472C584BA38663D60EC5148E94CB4A042889D15D74D8E684D4C05D9E367F77FA62A512102911A5E1A729DD9AEDEB058D26A09182E33FF5BAFE006D1723DE634AF9C6E575FA7B0D04C8B45BA4122BC0A56339E92B37F6DA852C0C5CFF91004A1724AC17654D4316B677375267A303639B38734D31DE76D31A3124D34DB5ED10723B25B15301D4196BED94CA3AC7D1827272819B181E701AFAB177F08743A4104C8901972344EDC18C053ED9229B4FF1414CFE9D3F55615A159424C8251A1B9BC9EB1845951C762D4CB898CC08538D316AA4911BF43DB7E86EC9A0EB60F478C44988460CE48300C1FEE00883CE282EE0A350EE6CFEC92A670DC91D3AEF2D05F26D40C8228104279D2DA428BFF8DCFC45CC3AF1FC884EA1C228094C0811BB585B4108BB2D34A9B7E5DD57A2C8B37909402B765CFF1A1F739C1887BB6729431F94DF73828F9F8057C6F85A979433B7C3397B5AF1615AF9AB167136455A79C79248E0EA7F040CB71A14FBB8AA23036A8A0E20DD083E10CEC7A401DCDFDF440A700927A7CA912C7C52F2AD2337D84B2DA0653356C35D38F3C04E05D1BCAD896A585194E608340098F5EAFE508731A0DBE97CFE37AAFF749B9B91BEEF23492F075327980D1868EFC39BF4337D6CC4ACEAF52AE69E30833C1A3D7D0426FDA7D8D69F1")]
        public void ShouldComposeKeyCorrectly(string eHex, string pHex, string qHex, string nHex, string dHex)
        {
            var e = new BitString(eHex).ToPositiveBigInteger();
            var p = new BitString(pHex).ToPositiveBigInteger();
            var q = new BitString(qHex).ToPositiveBigInteger();
            var expectedN = new BitString(nHex).ToPositiveBigInteger();
            var expectedD = new BitString(dHex).ToPositiveBigInteger();

            var subject = new RsaKeyComposer();
            var result = subject.ComposeKey(e, new PrimePair {P = p, Q = q});

            // TODO fix the cast
            Assert.AreEqual(expectedN, result.PubKey.N, "n");
            Assert.AreEqual(expectedD, ((PrivateKey)result.PrivKey).D, "d");
        }
    }
}