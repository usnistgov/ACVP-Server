using System;
using System.Text;
using NIST.CVP.ACVTS.Libraries.Crypto.Common.Hash.CSHAKE;
using NIST.CVP.ACVTS.Libraries.Crypto.Common.MAC;
using NIST.CVP.ACVTS.Libraries.Crypto.Common.MAC.KMAC;
using NIST.CVP.ACVTS.Libraries.Crypto.CSHAKE;
using NIST.CVP.ACVTS.Libraries.Math;
using NIST.CVP.ACVTS.Tests.Core.TestCategoryAttributes;
using NUnit.Framework;

namespace NIST.CVP.ACVTS.Libraries.Crypto.KMAC.Tests
{
    [TestFixture, FastCryptoTest]
    public class KmacTests
    {
        private KmacFactory _kmacFactory;

        [SetUp]
        public void Setup()
        {
            _kmacFactory = new KmacFactory(new CSHAKEWrapper());
        }

        [Test]
        [TestCase(32, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "00010203", "e5780b0d3ea6f7d3a429c5706aa43a00fadbd7d49628839e3187243f456ee14e", "")]
        [TestCase(32, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "00010203", "3b1fba963cd8b0b59e8c1a6d71888b7143651af8ba0a7070c0979e2811324aa5", "My Tagged Application")]
        [TestCase(1600, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7", "1f5b4e6cca02209e0dcb5ca635b89a15e271ecc760071dfd805faa38f9729230", "My Tagged Application")]
        [TestCase(256, 275, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f", "fb89a756507bb94e920943ea56a6ce202512e40cf7f6d79bbe380ba79f759dacd0d005", "My Function")]
        [TestCase(1607, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c748", "83ca4cba3addd49f363bad03da260880fb99ede3926d06b0c20a3db253185b80", "My Function")]
        [TestCase(256, 256, 2407, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d2d3d4d5d6d7d8d9dadbdcdddedfe0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f", "dea457f7eb7469f63f02b018da7400060d6164ef230bdeb7e73ccd8464f38725", "My Function")]
        public void ShouldKMAC128Correctly(int length, int macLength, int keyLen, string key, string inputHex, string outputHex, string customization)
        {
            var message = new BitString(inputHex, length, false);
            var expectedResult = new BitString(outputHex, macLength, false);

            var subject = _kmacFactory.GetKmacInstance(256, false);
            var result = subject.Generate(new BitString(key, keyLen, true), message, customization, macLength);

            Assert.That(result.Success);
            Assert.AreEqual(expectedResult, result.Mac);
        }

        [Test]
        [TestCase(32, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "00010203", "e5780b0d3ea6f7d3a429c5706aa43a00fadbd7d49628839e3187243f456ee14e", "")]
        [TestCase(32, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "00010203", "3b1fba963cd8b0b59e8c1a6d71888b7143651af8ba0a7070c0979e2811324aa5", "4d7920546167676564204170706c69636174696f6e")]
        public void ShouldKMACHexCustomizationCorrectly(int length, int macLength, int keyLen, string key, string inputHex, string outputHex, string customizationHex)
        {
            var message = new BitString(inputHex, length, false);
            var expectedResult = new BitString(outputHex, macLength, false);
            var customization = new BitString(customizationHex);

            var subject = _kmacFactory.GetKmacInstance(256, false);
            var result = subject.Generate(new BitString(key, keyLen, true), message, customization, macLength);

            Assert.That(result.Success);
            Assert.AreEqual(expectedResult.ToHex(), result.Mac.ToHex());
        }

        [Test]
        [TestCase(32, 512, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "00010203", "20c570c31346f703c9ac36c61c03cb64c3970d0cfc787e9b79599d273a68d2f7f69d4cc3de9d104a351689f27cf6f5951f0103f33f4f24871024d9c27773a8dd", "My Tagged Application")]
        [TestCase(1600, 512, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7", "75358cf39e41494e949707927cee0af20a3ff553904c86b08f21cc414bcfd691589d27cf5e15369cbbff8b9a4c2eb17800855d0235ff635da82533ec6b759b69", "")]
        [TestCase(1600, 512, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7", "b58618f71f92e1d56c1b8c55ddd7cd188b97b4ca4d99831eb2699a837da2e4d970fbacfde50033aea585f1a2708510c32d07880801bd182898fe476876fc8965", "My Tagged Application")]
        [TestCase(256, 275, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f", "fd54c330cb49287cc877c859a77153ce4026caae11a9d1fbc07eb922b9b5743b1d3804", "My Function")]
        [TestCase(1607, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c748", "f248f8a2ee78cfdafb49761ce91c06ca5670b00d751eac7dc03c5350ba228faa", "My Function")]
        [TestCase(256, 256, 2407, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d2d3d4d5d6d7d8d9dadbdcdddedfe0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f", "2515394698556660ca02ba53d2f1713b7492b28e8f161686ae982941ec889297", "My Function")]
        public void ShouldKMAC256Correctly(int length, int macLength, int keyLen, string key, string inputHex, string outputHex, string customization)
        {
            var message = new BitString(inputHex, length, false);
            var expectedResult = new BitString(outputHex, macLength, false);

            var subject = _kmacFactory.GetKmacInstance(512, false);
            var result = subject.Generate(new BitString(key, keyLen, true), message, customization, macLength);

            Assert.That(result.Success);
            Assert.AreEqual(expectedResult, result.Mac);
        }

        [Test]
        [TestCase(32, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "00010203", "cd83740bbd92ccc8cf032b1481a0f4460e7ca9dd12b08a0c4031178bacd6ec35", "")]
        [TestCase(32, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "00010203", "31a44527b4ed9f5c6101d11de6d26f0620aa5c341def41299657fe9df1a3b16c", "My Tagged Application")]
        [TestCase(1600, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7", "47026c7cd793084aa0283c253ef658490c0db61438b8326fe9bddf281b83ae0f", "My Tagged Application")]
        [TestCase(32, 128, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "00010203", "cd83740bbd92ccc8cf032b1481a0f446", "")]
        [TestCase(32, 128, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "00010203", "31a44527b4ed9f5c6101d11de6d26f06", "My Tagged Application")]
        [TestCase(1600, 128, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7", "47026c7cd793084aa0283c253ef65849", "My Tagged Application")]
        [TestCase(256, 275, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f", "a989c1c81528a5a7be018962d89d9cbdd1ab82ad5bc35e1a3877cd7d819f5a18409407", "My Function")]
        [TestCase(1607, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c748", "124df5776fff8edde733ce31af9d4010afb2d78782d385ee68130e77a50ae7bd", "My Function")]
        [TestCase(256, 256, 2407, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d2d3d4d5d6d7d8d9dadbdcdddedfe0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f", "f7777da1d234b76441bb7297377be8c85214dd754e68a92beb83f7d397ae209e", "My Function")]
        public void ShouldKMACXOF128Correctly(int length, int macLength, int keyLen, string key, string inputHex, string outputHex, string customization)
        {
            var message = new BitString(inputHex, length, false);
            var expectedResult = new BitString(outputHex, macLength, false);

            var subject = _kmacFactory.GetKmacInstance(256, true);
            var result = subject.Generate(new BitString(key, keyLen, true), message, customization, macLength);

            Assert.That(result.Success);
            Assert.AreEqual(expectedResult, result.Mac);
        }

        [Test]
        [TestCase(32, 512, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "00010203", "1755133f1534752aad0748f2c706fb5c784512cab835cd15676b16c0c6647fa96faa7af634a0bf8ff6df39374fa00fad9a39e322a7c92065a64eb1fb0801eb2b", "My Tagged Application")]
        [TestCase(1600, 512, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7", "ff7b171f1e8a2b24683eed37830ee797538ba8dc563f6da1e667391a75edc02ca633079f81ce12a25f45615ec89972031d18337331d24ceb8f8ca8e6a19fd98b", "")]
        [TestCase(1600, 512, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7", "d5be731c954ed7732846bb59dbe3a8e30f83e77a4bff4459f2f1c2b4ecebb8ce67ba01c62e8ab8578d2d499bd1bb276768781190020a306a97de281dcc30305d", "My Tagged Application")]
        [TestCase(32, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "00010203", "1755133f1534752aad0748f2c706fb5c784512cab835cd15676b16c0c6647fa9", "My Tagged Application")]
        [TestCase(1600, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7", "ff7b171f1e8a2b24683eed37830ee797538ba8dc563f6da1e667391a75edc02c", "")]
        [TestCase(1600, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7", "d5be731c954ed7732846bb59dbe3a8e30f83e77a4bff4459f2f1c2b4ecebb8ce", "My Tagged Application")]
        [TestCase(256, 275, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f", "b68f14ba54d1223a33d1f736b222bc4e38ead147538e7f4d238af16a8bca297f0c7f04", "My Function")]
        [TestCase(1607, 256, 256, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c748", "1111810380347558199d14901fc268304440243262b5e7a6462ccc9f54ff4dc2", "My Function")]
        [TestCase(256, 256, 2407, "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d2d3d4d5d6d7d8d9dadbdcdddedfe0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c", "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f", "df184001f61a4a86efc452cda2486a40a7715a9c866f8bd60d766c88560d51cb", "My Function")]
        public void ShouldKMACXOF256Correctly(int length, int macLength, int keyLen, string key, string inputHex, string outputHex, string customization)
        {
            var message = new BitString(inputHex, length, false);
            var expectedResult = new BitString(outputHex, macLength, false);

            var subject = _kmacFactory.GetKmacInstance(512, true);
            var result = subject.Generate(new BitString(key, keyLen, true), message, customization, macLength);

            Assert.That(result.Success);
            Assert.AreEqual(expectedResult, result.Mac);
        }

        [Test]
        [TestCase("Empties", true, 0, 256, 0, "", "", "3f9259e80b35e0719c26025f7e38a4a38172bf1142a6a9c1930e50df03904312", "")]
        [TestCase("From prompt file passing MVT", true, 336, 32, 128,
            "18753DAE584F703687B3EC1A602C8B59",
            "51A088605D4E46E3930017814E6CF8B51FAE1DD866BC9F84F6B3445D5E4FEDED9511DAEAD0C5E3B0E3AC",
            "ED9C5065",
            "a<HBlti")]
        public void ShouldProduceIntermediateValuesForDebuggingKmac128(string label, bool xof, int length, int macLength, int keyLen, string key, string inputHex, string outputHex, string customizationString)
        {
            var message = new BitString(inputHex, length, false);
            var expectedResult = new BitString(outputHex, macLength, false);
            var customization = new BitString(Encoding.ASCII.GetBytes(customizationString));

            var subject = _kmacFactory.GetKmacInstance(256, xof);
            var result = subject.Generate(new BitString(key, keyLen, true), message, customization, macLength);

            Console.WriteLine(expectedResult.ToHex());

            Assert.That(result.Success);
            Assert.AreEqual(expectedResult.ToHex(), result.Mac.ToHex());
        }

        [TestCase("tcId 3 https://admin.demo.acvts.nist.gov/api/testSessions/vectorSet/342666/json/InternalProjection",
            true, 19288, 1024, 1048,
            "7B3E43EDA8D51EC181D37DDE5B17ECCDD8BE84C268DC6C950070085F48E98EFA97F400260888ED43A0BBAE5E674BD169631D048A22A6EE7B654B769618BE7D2F32E42A2D804FEADD49A6685758D1E17706211DC518C0DFC1228175F36636EA0813062F49C2D88B81E31D4A016711FDDB3FDCCD02C79036612EEC050CD0CDFB94A8CF68",
            "205EF7EBD63E28D5F0C10A68E97CF6B92167D7F682A0FE7D04E9A4DCB707757A289075BBF7E1D692B09D4F22A05D1F6FC86CE1DCAF4120961AEECDADD0D8723FE4ABC508EBBE2602438738A336186BD19675B42A475926EE9861791DE41A19E841853B0C2EB6E47D972835D630B9F7940CB1C8EAC1B3C51FB7F4BFD03CBD2A795D685D2EAC78835F5F75DD0C79DDE25731B5DB0F9477509EB4E784B11544F37435AEB31211294AE7C05D61115179073BA6D4142F325F28117B6E57F65F44BCC0872F868018892C46E50E6FBD88CB0C0BDEE3F6D1047AA4BB2FCC9C3D6F2FF52F1AE9DD5E85E61F9CA619AAD71B58DD17ACC7255574D6AA658E0B673825D25F8FE58A1665E3B8D304396AA8AFE032C79704C210CFBEDBBA304FC11759EA58064EC88A0AE2EFE2D9BC97E4302E07FA26A56452912C212819EF6D0548BC756AE86A98AFA907D82CE996EE31F8D8CB2736977E8CC3D3C39FFE7291E20ED978C8EE8FBCFC563D92A432282654CC1F9AABD27CDFC08464FAA566EEED3BAC0A550FEABA5193839DA3155802F0BE78298EEBAD3DEC64E8628240223F99F953EAA723E79E7D5A0B48E9BFE0C82307A41DE4FFE84026532D3CAE67155DDB6C5C83DE7C0A95DC5D29762CD3911AA097CA989DFEACF67D3167B2B8C3FCA6D1371C7AD9805FEEA0411B90F565718D06E500AB0EE694F7E735043D6AABD7F8EE1EDC9E6197FFA042D97F31F6932B826FD15D8FBBEBC5AED57D12D921A2C71F73122421E8E15E6475BB96D4956A75F90F26DF32CA4A0A1240C57FC0FB755CD8AD149C6B8C3BA84E0328DAC6FD0673553D0E4E7E7A7534107EB05C9030628C4F8194DA08BFB3075EA45AA7FE5B88C39D55AF2288C5DE6C881D5C1F94994DA9AB27354EC1A3C9046096135CE7FE516C9D45F6DED90DB385D0557ED1C4139E710142A550C72508933489303C4AAFC206EE2032320B4FEC5177FD74CA37FD8D90D35E0CAA04408CCF78012DC55E2B824520B5CF51A371D00DECAA9054F58095614E8E67CDF4E2BCBE72D6A4DB5CD8FB08516A4BCC5FDC1E3A2C008DC1FEFEA61CDC8A9E5A33D4AF6B812E2EC2ACFC0E7A6B8E539C9D71ECEDE99BA1A44D3EECA09950D86B526797A406E83E4BC908D6CDA5DBFFEB9F3F6DB5F5F1C1CA79B653C07AF8CA82CAB3556A7AF2DB0B27E1DFAA661B5BA1FE669863D3A21EA8D21197E2F3652DA9B33CE8007CFD5137A34157149994DC10994725A7A17DBFB3B3D168CC297F4C7EF6783F422BF4E9230E39E19355D2793ADDC06140E32321F27F14F56520607085D4ADE713CEB9D1FA8709CAC3703EC7A837882C9A04212BDD8C0DFBFCEF702CD8FC51D11D7BB1C3095A66610F00AE007B11E4D64D386CD7A6CA62C492C32C61E919CB7170B9D98D0DD66507DBC7F63F509FBE28505946A36DC28BF609BE996E6241290640FF9F393A343093DCDA9932C16B832B318EA3121F0B700FF313C23D6A41E275FAB8ABD4CBF0B7F36C65AEDED17F09CBFC04B044B723BEEBD36B2AF1289CF98BB96BB1CB377F2FE1D25A35DEF6447B1E04EADA63CD9BE0AC83E253FBD2894DA144A5224D9D0EB6D6677DDF97CF42CE2767FC7B763E3E31DBB84FD9ED56975FB2F10521C56BE21A7F6118A2FE7799FB5CD0AA93313C3FA7666B8D30B88D17EF0A7B5730CA9F9FD1FA2EB7B5E5A49C69E907660546A2DA0922D0C0653CDD493616FE469AE18203C3D6F0350B45617726D0CA0E01C42EED501538B3CE6276C2303AFC175DCB6C34F7092B3433F2F041D59E23DBFE0E83332D5B1107157A0CEE0A2428FC8737164AABC91C85F75C49621D4E2DDB5181E65836834E731518FE148E23907D550D8F0279755CE567B9B77BCF2620138E9B119BA17D09163990BF08AE843EAED818893D62BB76631C88D6409A8703D421AD98CDD16896DE4BF1BEF0D8796D3DF95103D3FB41C12668E304385B5508F78198821CC13800DBEC847E23E2DF4721C03295A27F846CA3C95A05D2448263C914A0D0209A2D708FF4835868E48A816EB648BABF1F1D9852B81C4A32C8F45F44ED63AD634EFD6A7BF1B4C018D725C0138CCDC7A3C7502DC2041F1D04A96144B49B2F8EA49E0D3C7DEC820F4CDF9D71D621F3930CA9FA737B084B718B7A56FD0001A0B648FCE10720D9709E3ACB360E76AB985BA662455451778A86A52D16ED8BBDDB82ED141C6F7C9AF651FE4CEB068FF19FA268E2BADC848ECA656B5EA1162B6EEB26D1C5FF164D013D613EC9E21CDDF6E54744425C76E3AD48ED2A6A70BAFC341BE168C9FC7438E3E4C5589E89CC7BF5CFDC199E4A464F53EFCE3937FA31C696FFC7965E11ADD3FEE58E89ACC9D37B8124259C3750FBFCB13F7976CF721D726D712271044E9F1A6C14699947F88FCD669EAB556D9F37B871CCE4FE2B19E7687FD6813B9739192D7A923B6E096CC9963DA590B6DA9D48EFACB9AB1E7B1AACA7827306108FCC72F65486F2B58EE4721CEA6018D7C16ADB86E6110709306EB36C47CA537B89B4F7557C5121B5232F00B4C3DB8C2F86F471D5EF90C48722EF47753B15E58F9835F777909ECB3240CA16AB982AF877E4EF822D59EBB1812B88F44884618039DA99DEBC53701E0921CBC1A011F00F1737CBD7BB4FBF2977F24AE8AEA7EDFE016B279BA8413043BBABD1EC8263A3CB13369C358262EB61754220EC962CC9DA0D4D2544DD0346B36D4D39A7B0356B98DFE1147882FA4C27AF049EEEF59D91F5528221EDFB82AD28AF1F30CE8A9A651430158A27211C5C2F3B20C78A2BF6D39D1CC44215499CAD69093595DF2A8847778ECAE4C83BADB994976B8AA9ECB65D44FF5A56D212F4DF15DEC5D5DAB0F49AC6CAB440893AD2F87296540A29B28C2FDE1045D4C54E122BCF541F9B331F4FE8A1943C351B956E8AD41FA4E43DC3343579F9F52A99962E0200CFD6F8C5A618177A91CD5DE80528D33ADF6BF35112FBA54CE5414B36CA7A6FF1243B4469A86A3F13F5F73869811BBB452CF4130620273B143FA02FE62B0C71CA36DE03C16D002FF37214784E0FE4ED152877433B44A6CF28FCB269D75DB1286E45474D6E31E3BC703058ADF04F38C6A8788D98547BB711844D34A42A705F4B1F04C887D58D66A3C0CBBFF3562B1D5CA1DCD937A9D12D36CC1DDBD5D4A3882F23AED80DACD9A381AF366981B2842F5F220848B39F82F9F7127561780E16D9294D7177858B3F65E99078BAA3C83FAC2D96E9EBADCDD6A09A33634D12C333FA6AD932C15EB1C5490DB616893F1D2D5B5F8724AC0980B35C0ECF294AD44D1BFF19B8D8D0249F335242F36C602AE46FC47E389A2EC34CB342AA56609104073D7917406DAFE2AC93F9B5E8F9BCC25DB36E612D5212C733408768BA7DB899E93A3BB02EBEDD53D1F1D14A616104D41BFC270FF9",
            "8506FC9B1CF4B1DE588507B4AB8C5E9C4B1E09D4940B0F84C5F54368566E12978D4070908B4A7BE2F07A7C781F3E3D697E88AB6AC03673A7A3AF854C816ED2DC6F113D35FEA0C4A100300FA22F5017AE37E685E2FD3A187362A37AF6227D96F3B7A42D8F1B82C628927C10F2524CC4898BB2707832B4B3694566C26D5414E5B5",
            "km}zS=U8={k/T m")]
        [TestCase("tcId 3 w/o customization https://admin.demo.acvts.nist.gov/api/testSessions/vectorSet/342666/json/InternalProjection",
            true, 19288, 1024, 1048,
            "7B3E43EDA8D51EC181D37DDE5B17ECCDD8BE84C268DC6C950070085F48E98EFA97F400260888ED43A0BBAE5E674BD169631D048A22A6EE7B654B769618BE7D2F32E42A2D804FEADD49A6685758D1E17706211DC518C0DFC1228175F36636EA0813062F49C2D88B81E31D4A016711FDDB3FDCCD02C79036612EEC050CD0CDFB94A8CF68",
            "205EF7EBD63E28D5F0C10A68E97CF6B92167D7F682A0FE7D04E9A4DCB707757A289075BBF7E1D692B09D4F22A05D1F6FC86CE1DCAF4120961AEECDADD0D8723FE4ABC508EBBE2602438738A336186BD19675B42A475926EE9861791DE41A19E841853B0C2EB6E47D972835D630B9F7940CB1C8EAC1B3C51FB7F4BFD03CBD2A795D685D2EAC78835F5F75DD0C79DDE25731B5DB0F9477509EB4E784B11544F37435AEB31211294AE7C05D61115179073BA6D4142F325F28117B6E57F65F44BCC0872F868018892C46E50E6FBD88CB0C0BDEE3F6D1047AA4BB2FCC9C3D6F2FF52F1AE9DD5E85E61F9CA619AAD71B58DD17ACC7255574D6AA658E0B673825D25F8FE58A1665E3B8D304396AA8AFE032C79704C210CFBEDBBA304FC11759EA58064EC88A0AE2EFE2D9BC97E4302E07FA26A56452912C212819EF6D0548BC756AE86A98AFA907D82CE996EE31F8D8CB2736977E8CC3D3C39FFE7291E20ED978C8EE8FBCFC563D92A432282654CC1F9AABD27CDFC08464FAA566EEED3BAC0A550FEABA5193839DA3155802F0BE78298EEBAD3DEC64E8628240223F99F953EAA723E79E7D5A0B48E9BFE0C82307A41DE4FFE84026532D3CAE67155DDB6C5C83DE7C0A95DC5D29762CD3911AA097CA989DFEACF67D3167B2B8C3FCA6D1371C7AD9805FEEA0411B90F565718D06E500AB0EE694F7E735043D6AABD7F8EE1EDC9E6197FFA042D97F31F6932B826FD15D8FBBEBC5AED57D12D921A2C71F73122421E8E15E6475BB96D4956A75F90F26DF32CA4A0A1240C57FC0FB755CD8AD149C6B8C3BA84E0328DAC6FD0673553D0E4E7E7A7534107EB05C9030628C4F8194DA08BFB3075EA45AA7FE5B88C39D55AF2288C5DE6C881D5C1F94994DA9AB27354EC1A3C9046096135CE7FE516C9D45F6DED90DB385D0557ED1C4139E710142A550C72508933489303C4AAFC206EE2032320B4FEC5177FD74CA37FD8D90D35E0CAA04408CCF78012DC55E2B824520B5CF51A371D00DECAA9054F58095614E8E67CDF4E2BCBE72D6A4DB5CD8FB08516A4BCC5FDC1E3A2C008DC1FEFEA61CDC8A9E5A33D4AF6B812E2EC2ACFC0E7A6B8E539C9D71ECEDE99BA1A44D3EECA09950D86B526797A406E83E4BC908D6CDA5DBFFEB9F3F6DB5F5F1C1CA79B653C07AF8CA82CAB3556A7AF2DB0B27E1DFAA661B5BA1FE669863D3A21EA8D21197E2F3652DA9B33CE8007CFD5137A34157149994DC10994725A7A17DBFB3B3D168CC297F4C7EF6783F422BF4E9230E39E19355D2793ADDC06140E32321F27F14F56520607085D4ADE713CEB9D1FA8709CAC3703EC7A837882C9A04212BDD8C0DFBFCEF702CD8FC51D11D7BB1C3095A66610F00AE007B11E4D64D386CD7A6CA62C492C32C61E919CB7170B9D98D0DD66507DBC7F63F509FBE28505946A36DC28BF609BE996E6241290640FF9F393A343093DCDA9932C16B832B318EA3121F0B700FF313C23D6A41E275FAB8ABD4CBF0B7F36C65AEDED17F09CBFC04B044B723BEEBD36B2AF1289CF98BB96BB1CB377F2FE1D25A35DEF6447B1E04EADA63CD9BE0AC83E253FBD2894DA144A5224D9D0EB6D6677DDF97CF42CE2767FC7B763E3E31DBB84FD9ED56975FB2F10521C56BE21A7F6118A2FE7799FB5CD0AA93313C3FA7666B8D30B88D17EF0A7B5730CA9F9FD1FA2EB7B5E5A49C69E907660546A2DA0922D0C0653CDD493616FE469AE18203C3D6F0350B45617726D0CA0E01C42EED501538B3CE6276C2303AFC175DCB6C34F7092B3433F2F041D59E23DBFE0E83332D5B1107157A0CEE0A2428FC8737164AABC91C85F75C49621D4E2DDB5181E65836834E731518FE148E23907D550D8F0279755CE567B9B77BCF2620138E9B119BA17D09163990BF08AE843EAED818893D62BB76631C88D6409A8703D421AD98CDD16896DE4BF1BEF0D8796D3DF95103D3FB41C12668E304385B5508F78198821CC13800DBEC847E23E2DF4721C03295A27F846CA3C95A05D2448263C914A0D0209A2D708FF4835868E48A816EB648BABF1F1D9852B81C4A32C8F45F44ED63AD634EFD6A7BF1B4C018D725C0138CCDC7A3C7502DC2041F1D04A96144B49B2F8EA49E0D3C7DEC820F4CDF9D71D621F3930CA9FA737B084B718B7A56FD0001A0B648FCE10720D9709E3ACB360E76AB985BA662455451778A86A52D16ED8BBDDB82ED141C6F7C9AF651FE4CEB068FF19FA268E2BADC848ECA656B5EA1162B6EEB26D1C5FF164D013D613EC9E21CDDF6E54744425C76E3AD48ED2A6A70BAFC341BE168C9FC7438E3E4C5589E89CC7BF5CFDC199E4A464F53EFCE3937FA31C696FFC7965E11ADD3FEE58E89ACC9D37B8124259C3750FBFCB13F7976CF721D726D712271044E9F1A6C14699947F88FCD669EAB556D9F37B871CCE4FE2B19E7687FD6813B9739192D7A923B6E096CC9963DA590B6DA9D48EFACB9AB1E7B1AACA7827306108FCC72F65486F2B58EE4721CEA6018D7C16ADB86E6110709306EB36C47CA537B89B4F7557C5121B5232F00B4C3DB8C2F86F471D5EF90C48722EF47753B15E58F9835F777909ECB3240CA16AB982AF877E4EF822D59EBB1812B88F44884618039DA99DEBC53701E0921CBC1A011F00F1737CBD7BB4FBF2977F24AE8AEA7EDFE016B279BA8413043BBABD1EC8263A3CB13369C358262EB61754220EC962CC9DA0D4D2544DD0346B36D4D39A7B0356B98DFE1147882FA4C27AF049EEEF59D91F5528221EDFB82AD28AF1F30CE8A9A651430158A27211C5C2F3B20C78A2BF6D39D1CC44215499CAD69093595DF2A8847778ECAE4C83BADB994976B8AA9ECB65D44FF5A56D212F4DF15DEC5D5DAB0F49AC6CAB440893AD2F87296540A29B28C2FDE1045D4C54E122BCF541F9B331F4FE8A1943C351B956E8AD41FA4E43DC3343579F9F52A99962E0200CFD6F8C5A618177A91CD5DE80528D33ADF6BF35112FBA54CE5414B36CA7A6FF1243B4469A86A3F13F5F73869811BBB452CF4130620273B143FA02FE62B0C71CA36DE03C16D002FF37214784E0FE4ED152877433B44A6CF28FCB269D75DB1286E45474D6E31E3BC703058ADF04F38C6A8788D98547BB711844D34A42A705F4B1F04C887D58D66A3C0CBBFF3562B1D5CA1DCD937A9D12D36CC1DDBD5D4A3882F23AED80DACD9A381AF366981B2842F5F220848B39F82F9F7127561780E16D9294D7177858B3F65E99078BAA3C83FAC2D96E9EBADCDD6A09A33634D12C333FA6AD932C15EB1C5490DB616893F1D2D5B5F8724AC0980B35C0ECF294AD44D1BFF19B8D8D0249F335242F36C602AE46FC47E389A2EC34CB342AA56609104073D7917406DAFE2AC93F9B5E8F9BCC25DB36E612D5212C733408768BA7DB899E93A3BB02EBEDD53D1F1D14A616104D41BFC270FF9",
            "168851349BDA1E6800651F3086C2E74B1D4090767E9CE9334FF7D9BD0D15E137263971F78396FEEDF5299B8D0CB12EB6E0D424B03A14D3313E7B2DE169B5863438EC9BD5A23C54E48C9F4349D5810FC954243E60127D330E905289B9FECC3D273A91649BBE0301CE95A5C48308B4F5D51A6540B81170616B356655E64A7382CB",
            "")]
        [TestCase("tcId 165 https://admin.demo.acvts.nist.gov/api/testSessions/vectorSet/342666/json/InternalProjection",
            false, 11616, 3592, 1048,
            "228033A97FFD99A38FA82BF650077A155965BA1DC2A631E27F757D41611F41365C6C695EAE9D69851117AF01081D81F54665CC718681258BDEE146E882ABBB3EA93314D2FCC17A26D6419FE73210C4C65E00EC1C5DEB6A713E651F29C33FC6B0FFE112CCE3E0F532822A5CF0F263F0FE0A0A28495BBA20BB00F8B2F1F3FD503231924B",
            "CF02078AD9205AD49580FF776E70411C475FA2D7BB388F7B011140A9525A13ABE4A932BA4F6C482914A9A9F6E25DCA98CF273A4A3ACD7202BD56F621496F7E3F76E2D53808114381AADCA42D3A4CD2F8338A19D0998A8DB9E23BCB92EDF205B9D6E443B455FD22E8F8D4D4C786543D88E9E4144F295423BA962A362BFA3B557EA32B8178D5BBDC47D94225BD4424E31866C5CE4371A9E4585C19703245FC2B1E9119EB6A6CA44EB82785F80DAD7FD3075D7B27255AE6988F95EE1C247404CDD250D33D182B41938EEA282A09397A47793DE53612CF7BF1CE3117AB003339E0528F3188F4F910EC948EF7A04BB5C9A741EE4F5D55565C04D8C8362918D521868B74DFD3E0BC35C99A3A8D6FD453B9045A308121B9C455316212442AC2AB2621FDCBF305B924D7C2100922AA87BF171DF2F8D43FF61F517F7999F8B77F46D2BDE4152EEB71ACFD2F6F77410A44CFCA5ACAC47195690B372CB665B2B753463A51136679521AE1E1648D3D4A2D4B07E42C504BFEB998E5245E6749CC52108B6DBAA58C1128FB1AA6C87D097B8D699E7582B8C342C101E0DE258F746DC1A95F6D08CBB4CCC0899CEF920DFF9A770BB3D2D40A76B27E94386F724D9BC5EAADB4C8188086403C737FF86A41D6F970532CC1545E1A757278EE8F0CF14040820730690770EDA3CC0831EF7FE82A6C234460B38D1ECC1A17BB39062452486D63FEE095AEFA3ED106BADF21793230AB7E12E2555FA43E639CDE644541F45DAB29AA22AF93A97E069AC057CC8169F97B007AFA81FE721885AD743E2C00D8915E86608B72AE31267993E1C7782AECD8DB0B651ED252E40CB41DD0E0B92212E7613881B9594504E01F4D4D650B2636568E2E603FE73AC9DF40BAD0778F5073C6F9ECEEAE807A063C4B4C589C3224C784945F312DE90CD44FE6023460814F2D78EA7F8AD2ABCAB6BF5C4A4CBB89B0E2741A51C6BDC95E4684BF9979373A63869708E24C1498E2D65B1DFA8B2F9094E960396EC308E6365B369422B58126D3BAE87ADC4F73101BE2DE59ADF32495DAA7751BA00AF44B007458555D2F7BC13009101F210A3709040044630F085B8FB194C49E76B230E4D90984145977105F46EE620983D6299F45EBCED0EFCE558588B2CD6D8FC1B0931294F54AA97DF4D2D03332658EE3417F01536026454378CF532E914E4AE1927854F1EDC4552AF2A5121313679EA9B41A00184F223A0484FF584B759C2207E6E49AD00E42FE419750769A2ACA43D11AC8CBB45531C52D486333EB06ED7B69403DDE5638B8727FCF554914508367B8EB5F38F1056344C53BD38981C2CD96E165C61E92832E3053BAD11799F60101D1E4F6B99DCEE12F5ECF6185690C2C50E6EE401651554BAFA4FC06D235C11426C03D95AD13B485217C1873DE32D32D598C06D9AD1DC13E6791096D23EF5D48D1AD93589665B957C09C5DD790BCDDB8111FF6307E93C2BA19D4FB666A74227E53A92FBBEAE54D50BD856D6FD7DA1262F874E1456EB1F101697E3DE4B676DC2D0C34B2A31ED52DF36564E26F952B3856B8B1DD47A12EB3064C4E9118D9B2B49FF4029B1031CB13D5BC837421B83E4FFA9616966A16D12FA745E46E32ABE977D9869AADE426CF6D4E1BF419D1D6F8EBBB813D02508B3B3AA2E7C1E09F1A2FCAD6554A1AA3F9D037986722A5517416692584896275C0CC23A13EA7B55E68D571C1458EE83F1E6F44E3B2C21DAFDC794A9C2048748BF10F643D8A39133DB4EA5B85D181CABEB38A6EF8145385250AAEDA52E46A49C35A4343104D9BC98D68583738E7285EB6CB2E07690CCECE3520B2D954C67C96EB2343AD2F3896EDBAF37BC7E288A6D7E302A1CE7B556D0707737CA63A56BD08303BC0DEBF0B605899AA5CD613D641B1C6ED2F12CEACD2AB0202B99090309717CA8E9E243A6CC413146F7B4D016F09C0030DD6D26D8897CE60FA4B841F75C815F75E461D9745BE9DBF9D9A667B32A64E86D80658458F7510AC356AF90984B0AFD5F680A7BD90980A661B62E3994304CAF35508D0259E0B770504AD2F5024B8",
            "862A244101CC888EA95F6FCCF70F051D5B991CC15B22837D955AD1E7F52B529D83254A7BD092ED145699D97237E8B6E08F0F4B49C65031A010A746CC27CA40C7E21F2874FDB1C3F65E8C2803514AE0AD7324A2CEB788FB790400DC92B6F632AD06C3541084A2578884938FA72C073DDA72329AAFF22559DA4916118BE96F800453A71C945F822183717EF6B9BE543D1CF3E05C29CF0403EC9B73D34D4CC9E489C6FB01B7B59D54B7CEBA7B71F21CE4F4F072076DA0FA2E9C68BB5636120DEE9D101E12CF707BBB18D568499D3DEAA8C5FE24EF104A57C0A2723070FEF33A1ADEE839ABFF5029F5D1F532EE4B1E5956DE37E1E70A887C391C1FCC95A1B6D5B7CAAF9CC7CD37B1B91033C6FF88666E595074A87C24414590AECD42E15278BF391C981DFF78C64A55F6FE4CB79C511BC0E29665339D38733AD6BF40B0E6B7D6E2835AE14A616A7200AB1B0F64014B5DECA909D3F2A47971835B41ED738E0A2FB1D46A94FE14296F1BF672B0216A0076F9BF380B5E0CAA3BC71C55335F2F2E0A19473F60DC93456A092B618FC0C08C9FD57A09B931561D5947C5F0B36410477AAFA2D34990A36B62DA6C7A5A781312AE7F8962A904BD31038F4D93FFF73FD27E4D639B",
            "lXi29gHF=B496:m5,up,L,")]
        public void ShouldProduceIntermediateValuesForDebuggingKmac256(string label, bool xof, int length, int macLength, int keyLen, string key, string inputHex, string outputHex, string customizationString)
        {
            var message = new BitString(inputHex, length, false);
            var expectedResult = new BitString(outputHex, macLength, false);
            var customization = new BitString(Encoding.ASCII.GetBytes(customizationString));

            var subject = _kmacFactory.GetKmacInstance(512, xof);
            var result = subject.Generate(new BitString(key, keyLen, true), message, customization, macLength);

            Console.WriteLine(expectedResult.ToHex());
            Console.WriteLine(result.Mac.ToHex());

            Assert.That(result.Success);
            Assert.AreEqual(expectedResult.ToHex(), result.Mac.ToHex());
        }

        [Test]
        [TestCase("tcId 113 https://admin.demo.acvts.nist.gov/api/testSessions/vectorSet/344479/json/InternalProjection",
            true, 496, 3560, 2176,
            "DEB2E497870DBDAE128E4E6F34AC201279E46502AFF0CB6389474245420D00230FC30B6086B8B2DCDA0A9C796C4932D8888714F87A7BD2EA136B4F3AEA98B9AF08BAB96784A8998DDCE07E82DADFCFD9812CDEFCBC09DEC82B900920468FBD588D77593B22B4046683D0015943FE7A1D8B96C9A7F1462662F6DC1C880F1D5EDE39C18054FC5A704BD3CF42E36BD4A44718183EA56EF61A0ECB569692FFD836C6B36C2EE8459335C93B379E0C54F2B88C6F1C6045E4124B67AAC6E73224AB8372DB97D523611363795E22B7B95EC4D4B388BA3E834A125E89908FFBA90C93ECF3F1FDD029A64047AD9FAB58429BDBF7A56FF4C6109F746FACC07B64A8C10224B6645395566A44A84ECBDEF7B9BF1F04F4",
            "BAB00C8681CC817E726F57B896E55366E145AF4916DDCD72EB0F96A011197FF2C0358894FA71D59F8E5F40743FCE77D75BACAD08BFEB95424406F8566B0F",
            "1b1800b1035ccb42bb058485317b5c191fe09177c5b2012428acb7815d27100d777d0cfdfa1ec1c907c881c1fa1fdeee9699c78c6f8e49d1515c786631568b591ddf9103cee7fb624b79f3602e282d133be145a6d32dd198eff51057d4ada3a8e47cb30673abc656f2c40b97dfbd1695d8fd6f0d7e0d0d0f75b9527e17b60bf50cad4f7e52426cc1bc7cb8f58e7e8903c3e11fc414a81926f24fadb77e51c65cddc8fed1512ccb20d0a43210364dbf0f769128ed870146e5e67e6afba9a597a13117a197eeb0e80c8769c53a25fd0813634b6d37ca53817a67738369d56fd9c5525bcc5a126223a7f586cbd73a94610ace67885240d5ec6c2a15b62434b5f6049fbdf1211e0cf5b1561196880625a788e3c9037a603a2edc550d486b2585d3e4cfdc300949086507319a478ba4557ad020a12d907e52e9bee64e7319dd6c5e2cc1aaf466aac025ca86ba4b1c88ca82ad3a302bc789ec099c4838c2a7acd20eaa83e12237015cea302b4027155abf0caec7b7aa0e072b7abb5e063777fd5a4b4e5c6e6995ffe6174344ebc90bf180c44169879449d5ddc305b3caf1f4bbfceb97cbaed8408f190a7b0a3bf8637e833a62ecd13abf77079bc86e0ee86e28",
            "6741BA9B9489CD2A60")]
        [TestCase("tcId 102 submit result https://admin.demo.acvts.nist.gov/api/testSessions/vectorSet/344479/json/InternalProjection",
            true, 304, 952, 2352,
            "650CF430C32EBAD40B284B9D0FE3D631412EA94DB5DB7E9C46513C6CAF5D7F3D3E4EAA5789AF2DCCC5BA1B03FBA66F3024BAEC9FC3808A0F647DE0F0FB7F8F272C46437F14FBEB2ECD6CCD40EBE21A264237EB3E84AB8482CDBE5374DDFA3992FB06E615CCB16810F8714B470358CEB7F1BDEB35128A2D125C10307D0CE49F18B4D098B99A0BE42D6DFEC8B2BEE193FE3B5F587C13EE6393C08121B0DFD50FC1230A2996560A174A3AFE23761DEE947EC110521BA5C222DE67EEC4B1561E2C9075E6A0535F540E8E7AFE3F35CCCB81843377CF0B6684A7C45D89EA649991487A34F0419F72C7F6911CB99F4D877F6751525D439E996080B685131A56E62A48194BC7B5331DD4E27616696BE73A2DD878DFD08FE1AB9442E9245E73553E0CFA88A0DA7A5FF746",
            "0E240A787671A8158E0DB1DB5157F2A13EC681586DFE2278053F855E601DF4B80A8E1F85423C",
            "82bb9e22c34a846f5efe008ee2ed98a2f1d88a9ab8be54261d18ad763175b92c6cfca58a0da68b87eda97197601bde64c5c2c11c03f0899f48d8d5a9a5f1216942e6f1c379234d4591bca30158ec8dc68541ccdc3b610c6ec208360a747e42dd30b52890a38cfdb97918b6945f53bce67c011230407340",
            "E1D26B20")]
        // [TestCase("tcId 102 internal projection https://admin.demo.acvts.nist.gov/api/testSessions/vectorSet/344479/json/InternalProjection", 
        //     true, 304, 952, 2352, 
        //     "650CF430C32EBAD40B284B9D0FE3D631412EA94DB5DB7E9C46513C6CAF5D7F3D3E4EAA5789AF2DCCC5BA1B03FBA66F3024BAEC9FC3808A0F647DE0F0FB7F8F272C46437F14FBEB2ECD6CCD40EBE21A264237EB3E84AB8482CDBE5374DDFA3992FB06E615CCB16810F8714B470358CEB7F1BDEB35128A2D125C10307D0CE49F18B4D098B99A0BE42D6DFEC8B2BEE193FE3B5F587C13EE6393C08121B0DFD50FC1230A2996560A174A3AFE23761DEE947EC110521BA5C222DE67EEC4B1561E2C9075E6A0535F540E8E7AFE3F35CCCB81843377CF0B6684A7C45D89EA649991487A34F0419F72C7F6911CB99F4D877F6751525D439E996080B685131A56E62A48194BC7B5331DD4E27616696BE73A2DD878DFD08FE1AB9442E9245E73553E0CFA88A0DA7A5FF746", 
        //     "0E240A787671A8158E0DB1DB5157F2A13EC681586DFE2278053F855E601DF4B80A8E1F85423C", 
        //     "E65F71A1BB1DCE6CB653105CC208383B19E9C7910C3B1D738639B5A8CA61A809E5EBFCDD19D51246B518D7DE3F067CBA78EF37AD126CE0A6C001CBC79D43580936B2941850318EFD690629359EBB9152E46CEE7C7F05C6BDC76F8456651DE6536022EE2BF688950A42FB0AB7F11D5BDB5AF133E48AE531", 
        //     "E1D26B20")]
        public void ShouldProduceIntermediateValuesForDebuggingHexCustomizationKmac256(string label, bool xof, int length, int macLength, int keyLen, string key, string inputHex, string outputHex, string customizationString)
        {
            var message = new BitString(inputHex, length, false);
            var expectedResult = new BitString(outputHex, macLength, false);
            var customization = new BitString(customizationString);

            var subject = _kmacFactory.GetKmacInstance(512, xof);
            var result = subject.Generate(new BitString(key, keyLen, true), message, customization, macLength);

            Console.WriteLine(expectedResult.ToHex());
            Console.WriteLine(result.Mac.ToHex());

            Assert.That(result.Success);
            Assert.AreEqual(expectedResult.ToHex(), result.Mac.ToHex());
        }

        [Test]
        [TestCase("tcId 102 internal projection https://admin.demo.acvts.nist.gov/api/testSessions/vectorSet/344479/json/InternalProjection",
            true, 304, 952, 2352,
            "650CF430C32EBAD40B284B9D0FE3D631412EA94DB5DB7E9C46513C6CAF5D7F3D3E4EAA5789AF2DCCC5BA1B03FBA66F3024BAEC9FC3808A0F647DE0F0FB7F8F272C46437F14FBEB2ECD6CCD40EBE21A264237EB3E84AB8482CDBE5374DDFA3992FB06E615CCB16810F8714B470358CEB7F1BDEB35128A2D125C10307D0CE49F18B4D098B99A0BE42D6DFEC8B2BEE193FE3B5F587C13EE6393C08121B0DFD50FC1230A2996560A174A3AFE23761DEE947EC110521BA5C222DE67EEC4B1561E2C9075E6A0535F540E8E7AFE3F35CCCB81843377CF0B6684A7C45D89EA649991487A34F0419F72C7F6911CB99F4D877F6751525D439E996080B685131A56E62A48194BC7B5331DD4E27616696BE73A2DD878DFD08FE1AB9442E9245E73553E0CFA88A0DA7A5FF746",
            "0E240A787671A8158E0DB1DB5157F2A13EC681586DFE2278053F855E601DF4B80A8E1F85423C",
            "E65F71A1BB1DCE6CB653105CC208383B19E9C7910C3B1D738639B5A8CA61A809E5EBFCDD19D51246B518D7DE3F067CBA78EF37AD126CE0A6C001CBC79D43580936B2941850318EFD690629359EBB9152E46CEE7C7F05C6BDC76F8456651DE6536022EE2BF688950A42FB0AB7F11D5BDB5AF133E48AE531",
            "E1D26B20")]
        public void DebuggingIssueOnKmacTestingWithHexCustomization(string label, bool xof, int length, int macLength, int keyLen, string key, string inputHex, string outputHex, string customizationString)
        {
            var message = new BitString(inputHex, length, false);
            var expectedResult = new BitString(outputHex, macLength, false);

            /*
                So... this means that we were generating *non* byte bound customizations to use.
                    When the customization was padded for transmission in a file, but no length was included
                    (as byte bound is assumed), the IUT did not arrive at the same value, neither do we when
                    running those same values through a crypto test.
                    
                This test is used to demonstrate the issue, the customization was actually 28 bits long,
                not 32 as the test case would lead you to believe.
             */
            var customization = new BitString(customizationString, 28);

            var subject = _kmacFactory.GetKmacInstance(512, xof);
            var result = subject.Generate(new BitString(key, keyLen, true), message, customization, macLength);

            Console.WriteLine(expectedResult.ToHex());
            Console.WriteLine(result.Mac.ToHex());

            Assert.That(result.Success);
            Assert.AreEqual(expectedResult.ToHex(), result.Mac.ToHex());
        }
    }
}
