using NIST.CVP.ACVTS.Libraries.Crypto.Common.Symmetric.BlockModes.XTS;
using NIST.CVP.ACVTS.Libraries.Crypto.Common.Symmetric.Enums;
using NIST.CVP.ACVTS.Libraries.Crypto.Common.Symmetric.Helpers;
using NIST.CVP.ACVTS.Libraries.Crypto.Symmetric.BlockModes.XTS;
using NIST.CVP.ACVTS.Libraries.Crypto.Symmetric.Engines;
using NIST.CVP.ACVTS.Libraries.Math;
using NIST.CVP.ACVTS.Tests.Core.TestCategoryAttributes;
using NUnit.Framework;

namespace NIST.CVP.ACVTS.Libraries.Crypto.AES_XTS.Tests
{
    [TestFixture, FastCryptoTest]
    public class AesXtsTests
    {
        [Test]
        #region SingleBlockTests
        [TestCase("37b440eab641d16e920b4c5ad8c40e61ea0f800fe24d874f6f60827d9d414980",
            "5d0d8af3fa74c3f907cb519ccc00ec0e", "cb88b7cb5e3a7a9b65cd28ad7f7325de", "e9fe018c6e3e71edc125a377098e5c74",
            TestName = "Single block XTS - 0")]
        [TestCase("b69b76a927522817113b2fbd116e7fd7e133866bc74ba526aff7e7969bcf9d57",
            "1f740d4cf3efd8d0dc676f517fdadb9e", "2282f88cb7da6accd9b8450e9c2f0a65", "c2d8bc1e37bee598e3e621dfdf742fe4",
            TestName = "Single block XTS - 1")]
        [TestCase("4e5a1f9497ab55051fd7dda2f08a310caacf6d93c1213aa7499ba21b9bab8f15",
            "00d40b0e05ab773c9d75cb5c6a6f3e38", "7c926d5e0d44237bdbcc8251b1624a3e", "5008b6c645c7b7dd46dddad11e4bb445",
            TestName = "Single block XTS - 2")]
        [TestCase("c84d64f0893c945b657f3c011ae4c92c309d639dc5a86d5b8a4674b40535418b",
            "f6d863114117107af884dd218bf322ae", "e5c3cabc8197f069b8fe17601fcfce65", "1fe85d2393ffd60e0515c8a4239dc315",
            TestName = "Single block XTS - 3")]
        [TestCase("ca6444e0dd983067fbb4c893789f6a7c048c3e45611d39f231dda20c132cb7ec",
            "3e359839d9da0923e60789fe0ae7bd32", "a7bcbbec878495fa9c366360f080bf07", "a91eaa466b1f6aeed8fd45a1c01fce4f",
            TestName = "Single block XTS - 4")]
        [TestCase("c50c0468d2bd86d00374f999d56e27f63b3dacfe1e4a4db9dda9adb01e7406c8",
            "2d996728fa24814f270833bcce329c70", "6d01d986b44055ec1f66f627c74e6da0", "543a019a45f6d9a82b11d1fd06895403",
            TestName = "Single block XTS - 5")]
        [TestCase("0eac54295fbf48e1eeeb4db977f014b12921b5bff42489ed58e1da663f053931",
            "2d35b7c8f2bd725795361e58386cccdc", "760443b548372b20adc0be7cb4402289", "f94be01b944e70b96d06e04a651d3673",
            TestName = "Single block XTS - 6")]
        [TestCase("f165458f12a7406b0247e71ef4c277ac0731c6c1d19bd72a7db94ab9e3f7b723",
            "174dff892e91068a11724abb2982013c", "ffef866c05f383f271da17119211f8a3", "66aa2f37f731ff7f7355376d9fb8ddce",
            TestName = "Single block XTS - 7")]
        [TestCase("89be412001266fa668978f420e9c2860e0f4d61993e66c585aba4443ad60594a",
            "cd59b19048685cfe3a61933a2376070f", "9007dbd41bee6c0d27a28c71c5858916", "39f1b2508741c6df7c3ceadb967fc844",
            TestName = "Single block XTS - 8")]
        [TestCase("30b1de583a5fd6f7a6e8be9c7029e19f66b389ebe31e686dd4a01c48a32299a4",
            "8bca30d89551a84ab2b40d0d5e712222", "cb6f416f20f4ef49c81feed4483f8980", "1909611cf2194293871d5a120b671acb",
            TestName = "Single block XTS - 9")]
        #endregion SingleBlockTests
        public void ShouldEncryptDecryptSingleBlockCorrectly(string keyHex, string iHex, string ptHex, string ctHex)
        {
            var key = new BitString(keyHex);
            var tweak = new BitString(iHex);
            var pt = new BitString(ptHex);
            var ct = new BitString(ctHex);

            var subject = new XtsBlockCipher(new AesEngine());

            var encryptResult = subject.ProcessPayload(new XtsModeBlockCipherParameters(BlockCipherDirections.Encrypt, tweak, key, pt, pt.BitLength));

            Assert.IsTrue(encryptResult.Success, $"encryption failed, {encryptResult.ErrorMessage}");
            Assert.AreEqual(ct.ToHex(), encryptResult.Result.ToHex(), "encrypt comparison");

            var decryptResult = subject.ProcessPayload(new XtsModeBlockCipherParameters(BlockCipherDirections.Decrypt, tweak, key, ct, ct.BitLength));

            Assert.IsTrue(decryptResult.Success, $"decryption failed, {decryptResult.ErrorMessage}");
            Assert.AreEqual(pt.ToHex(), decryptResult.Result.ToHex(), "decrypt comparison");
        }

        [Test]
        #region MultiBlockTests
        [TestCase("6851e6e96d95e9b6aa0d618e2d1b137e5abc993c205e637fd9b1ae3a9c1f643fdb88609a4613d1d5ae6cf55897685169b6e7624bf6024d9cda5e552c216e65fa",
            "ccba276675874bca5a0bfb4a6a2f9565",
            "6ece7a13fd1a0f17bde5f6df569bd23a697eca70da73d374fa3afdb232d808c9553b3bfaf1be58f132b37164d0379db4d755fa1d565ec09658c801767d7c00e9",
            "88ebdb00cd4d746477152486fc12ca163ce6f0716e2db2e3a0b93730b9fa897c1d58887ad382bf49649c83ac8640463da6d4ea99cbb2f439e5ac1c136eff98a7",
            TestName = "Multi Block XTS 0")]
        [TestCase("41add793d6b3e0cb3904ec88ad1f845ffab89a75993a1751625ff744f5fe833e80e2e17d05260eb332f1b660fbc50de3c96b3be2444c77c161e3016794bc1821",
            "021d5b0691a46a498e2dbc0617679b46",
            "f91bf593614ab9be81caa38de1ec399bbf74f7647ca3231a68e4fd79d5118ee4cf41bca5085627649b6f0680c5a44a93f84802d37781dbf47bd9ad28cb586205",
            "5f35c96c564aa4b65b46e36930c7a0594bf045a83b840518f8936362f616c0ebe956b9613b0f81ac4f4a32a65323baae5ffb97d03016102ed3cf89b9952a150a",
            TestName = "Multi Block XTS 1")]
        [TestCase("c52b638f3035751b56dab68532dd563fe122ea5079a8945b0a525e29d03da237e3d122727ae056af5ef93f1c653a7320e39e218731a4ed68d4de5a057f81bf89",
            "cbfc81adf247b503bfe083603b9dad8f",
            "04bd868465ae8321ec049eff7e1a37658448d7097a61909361664c9c7c79d38af4fdb85617d7bdb3db231edab3dcfcaf08a18e96a61b17f28d8179a6c0028e4d",
            "dcebd37337271aad508d02f64de1b7552f5cd084e3103aa5426f96a1f6006992133b6a0a76ee6b0737aa1b599f47edd1e6d094e747da1d75e3403fbffc3bb649",
            TestName = "Multi Block XTS 2")]
        [TestCase("ee685bd98df7583d2a73870c88546dbf0cf2230692b89ddd5bce6475f059a6b919af47876f3d193d461e49d8713b431d24d670801da1fd0556e5e7c8b99951f8",
            "392c5a6c6850a83c68e7423644b5a793",
            "2ef74e00fed78c8ba55f567ea4166fcf326e37b689236268d75dbc60181b1db9d8af602df92ffd657dee90e815248f45d19fb8340db8e5f6712d43dae3a32e1e",
            "17690eaae3aeac08e74e382b3dd64281e2182236e3326626bc8bf7875553cc06a50f333138c1210e0966e25b751316e338319de0e91aaf0779db2f97505c7fda",
            TestName = "Multi Block XTS 3")]
        [TestCase("fd799f594e586dc7395f944d7d3ddac6725446254f4bca9c2d3bfab5b8ccd3f769557f13283c9be582ff42ca3db94d70714853db08617f03c83785a24d84cdb8",
            "c340639c1b1d1a09f9112d4753309776",
            "f2720eb54f326697006fba48f1272a4946a893c0767e44b6631b3cda24ca4766697801d762ed7af6e64ec516f40938bb2f9b716217c7bb4596c385d1f6e1ac11",
            "37e1d60befae02bcfbc9528dcbc169ba919fa8225e938cb51916522f39735d1d71300f64d31ce5bf58724a7ce7e2162a0758c62beec7f2acef4522afd4685690",
            TestName = "Multi Block XTS 4")]
        [TestCase("5da20fa5682227c3856753741d1ffbfbd1431eea965d9cc0a38b296458d712a936b10980401283fb77f53b7daf35b8eaf0d3771f5a64bc019fde8cbe851d2b1f",
            "5bff4268f9e4bce0aaf96b09f1346369",
            "bdf33e718f48a6318c8c536bcd25b250112d6859aa8075f9225bffb3ffa872dbb63054b29626b57e7745e144d193eec4400dc023623d75d75977393324dea15014dd85e4d19ee8a6383765692cf993dd68a289d1eeffe152363e1b374b4d8292d5eb483d8449717b61e4c6a4f1b3694a56a5d1414634a63fc1c0abf88ef5b0883dfc41e5f3111da638ed9479cbecb87676b47b62399addb1662b575fc3562286f3892bb548a9cd04d2ae04663b76eacc05d65e6315fa5d7b8c43d4d996c0feb2e4b39d7b062c9c8776221cc138d754b10657041a9df9d10fabd673edde9de126315a5db4a166753bf6f6c64a36eb85e1b3a3d4892d8aad0fef6137f4861606d61b2e848744d332aa5c5cd2aa852794a79dbd3abdd85814226d108172f602523db045275394991a23bdc74640fd03c50379b6a2e94068e8aade290ae43e88765762ab8abb84cd66cd03241350fd02c1fe1e7d6fd5f9d9cdd75c9d32816a59220cc6b8125ebcfc2a0fd56b1d8bde101cae1ac8903ea6a0d6d00aeee9542ab2f75d014f0180954d72189026c658ca8d898a40ef6a9c1266b59bcae9cf472ddde972370ad65ee0531a08f1d78a7a6ad9d5ddc2651debefeacb4b5ea1562d3d82d29a0ff7b4cb630f00199da3fe8560e28accee7858706ee1238c3b7ba1198adae64d882abbe5bfe81f51bee60e189de008f0fe0bb9b3e8ace213a5c8cf6aeb0cc2e15896c037183def12c61cfee107137bb0c5d9b8624bd9218f087fa48e19d5d562945abb85899fe030d54d64d6df30a5b68bea39d349bc48f26aa3c4afca07e73abdce1346267753f2393f28af639c1f61f57d8dc10a354d61f23172440e37fe466361a5e09b904c5fd9d074a0a4de80c148022882b474517b41a8ee36e91106b17235530ce2300a64b027e50e9c459be4da2cc44ce557e605275d441c4a450829953b3ba57308872c3df830d4a40a70e0d4597e037e650065b26d99d64cc7346c005cbf9ffee91e38956cbdeaa9d33bfbb314ffd157ff3a41fd706399d877edd5429a41a69dbc702ac0304c06c68bd1a04f96c652ae8b95083cd74d229c6f4afe8b3d30ef6cd25a0dcfba67b38fb4488796941f4df401710faa234716aaab8f369168092515e1e3c00be6c4bf4f0bdddda8899f908a5c2a9c41029b2b86247157196a9f48e28dceee1d93c930aa92efaecc571b396c12dfdaf4871bb9f13e709f061f46d4e29ee822badca5cd2b12b0579817e2361aad8164fb088723cd8f599e9ec1159ca3c018677e256e844dddf4a55ef2af771d44f443ed62e8e67593713041d54588fda7f66cc3db28d6aadd2d2f3a1f004ff6104e13f7757002d3c9343de619cdef4643343477b876038c60ded282ed1a7462b871571a17c62c6ca9cafcb3640759b2fdf4c83568ea848ba9e522f9f70febf5504a4c66d0213eab9438eaf3143fb32802afd33d69e357b71d908ce8beb41efd13622cbdf44e2b91a788b161b83f984838d3413e9306d62b270c8789049e81bef1db43bd142f770fb37b1e87195f355b2c428597e10d52108fbdc92001e7dbe973c7be02810750ae3dcb7978f51af9f5fc29f0aba1ccf2f3e3a753a5b8ec3c7ffa74e17344f851f7cec4827bc8e807061894d14f1330f34ee8fcce116efda698375a12210b6dd4ba3a742c9dc1a8b71485f9bb5a81d0ab4f8574cc6dc25756a3d980d6e3a6b760a517b7c2bb725c6746472749b75d0877c1eba9b8e439be60fc710add557b8fc0311f39020217e5b4f008765c5f9a52055e53579e9e06e4c9a53e82580fae4294d2d078e53d2256615ab676c44a68236adee52032e3e854d9f95f392d3bf8e16da2448f5570b3743efc70c566616c1ea6f696d4c79a83ce3ca772db1420cc22a53593d46a692773470efea7d92b60503c51451905a7c137a9f048b29cf5cdff8cb0b969bfafe688c7161bf1fa98f86cbc355ab267cc2b95d0ff8fba8c10609fab169a9deb1b863e140291df4f9acb2eef216514055482aaded472a3dbd3ecc39e7cc0e44ff24102dcf94a28001f32fbdf46a6e4f2772e99e3ecf12e9f474882c5965c8864ca2ad1a2e4330ec70482f8303a6daf9e262bca537268794ae4ec8e2d3c2abdb6d590c20613cca0ed88ec468e3ece187f973c4769cef3893ca05bd6009e2ee37108734f6bcc2b9b91af1be12f24250f054446abaaac69f9e8c27a6c2daf74e56def0f65143339bed720eb0f2864455ef85e7c3505ee557b0cd08b007435a6e808cf73d63b3800c03d3b9e00d253e4a17cf16f8815b746e6cba1a237a4746aba33053a4e6e74ebd6c3c8945df1ab649ff0c358c17777d32af4f937cdf7830f6b4f4fd1064ee7377246bfe88bc6a17c3b8c688b2992f01aef902791f1361943c15876a77f1b954d06b8d370dfbd470adec4c199d77503b30dbff1b4abf3e0c9bf667e54f20b477d4b04dec5e772be41b4c5d481ee517c66838dcc5f28f0b53c8e5f1301e6fe3a60b46175bf4f114917138455a408ab41313294082abcdf534c39e0453bd3b46341bb20990f4c71c45c2f5e5f36f5db6c5ee50defd97d476d8d0a1a715c558449c19d552c1f75a9307dd7fa6d4cf21d48cf4d35687c012f0750e4521fb89a934ffea4942a4a9540f1a1553199114e1cb4e01a318eb823b769ad153c04c884e06900a47d88b22f89b83081b55a28169fb1b64491ae133cc61e49369cab106f7a08ead849804f978807a9465fa98ab0f2955bb65a6f789aa11f510f792dfcf4133cd9f2724ec1337f6828ab0f3a438179d0a74fbb98ea34cd000057f13a245c29ab5c6f1483769cd7046e878db521b30ce0fadaae9f55bb3252a8dc9e52c56b0e084e4c15dfa80e92ab7297294e648353c03791034527e647b9ef3c52949b6a6d790954fa2b7201302d3bdb4ee8d0d6c4ad63f646847c478378d9bdbe7db1c91a7c640ec4cdfd26a5c9334d4bb3bb082392fd584de0d220a802498851b2da109adebc41aac275ab35dbd98c8f73d1815cfacacd7637e1d6acc01d5e5e088e0f47a9b5ed5fb8ccdbb4ff180e300fec4e22a0423cc4dff302c997d25809ce0763bfcac68be332236e1ed5fb8d1eb5ad43f97445b09e919835bf6c43d3412ff8df387cf0703e9c5ee756bad47b63c281f4641d800b1731768b5eae1c2babaaca9e866e964227f34cccdecb35f9fca5e6290dabce1d2091baff73c25d9bf00898755fb810e9b96afe3e689f19047041373e70c75b6bafd4475552600848f3f062660427b9c44e4ce639de8795d0a95e0c6e3e8310ed82ac59d5b61c2b333692cf45ab8d427b1ed31afaa3f470a35bf56a00a5468d60c4c4e8514aa39ef0af220e98a54c6d8b02e6cfe833100b4f8d6f1b90a64ad8305a974400ebc9f9c2a8d31286364c1909b4472fa9ec59238b07e15c76ac45034d2880096483a27fcffbb931040200c3679f51991dfa17620075e75b47e7319b7a36bcbfba09856e9482cdce241cff64b5b4692719f79df87157b48dc20cd3aca8195843a91f16614a0548675d670489209407a0b464a4100fa72ca94b5e05f5f5ee9df5583c6e86451fe50b117c73e281ef42e33796f672f40853e4cdad895849d7e6401ef6fe281c6c4afd55279f67b88781d9ab5e25148c9e16f0e32b46e0b867c73c1baae51066ce45cbe00b3a55210c4aedad686d7c29f470ed553d5e8ab6a204bac9ad52797fd1568f0636dd23a331e810e7bd1789eafefc73f3ae63d4dfa92d0b9ae2f6170f972385645d29dad457f7899b67600b56e90e328a16cdcbf41efa996d505996d93b9673fec9de30599596ee9b454566427f449d7668eb72d29273d283997738f086d604cd2fa58db19a377a5bf0efdc1db657ed915b332886f144e305f183d3d1eee0a60e03237bbdaf2a4766c459a1bbadf36486962c5f90e939e40c4c9ffb151fda167fd50bb0e8afb4e1b4b4b1654410296f406398735d5177c981e6e53d548b52d6d11a3f46ae69b7144f98b0089861c9566f1d66f067a8951c1aa4ca3430d8d4d3e3e5d1cc4ea38a2888f7086409131fa7c5a9d0d8ccee6ea4ae7762e4a84b39ca551fade22e9923e1c94e24d46e572cd6c846f651b2e6ecc61d8eeaee3afa4ea408a85c3adf0844cc3441d530145269aa11519f5e5578f79e0064caa48a04d0f867ba90ba7b26f36a237f0d3cdc41fbc8a1a65fd797bae0fddd5244c682d7060605447f25e187e4b5badf5173af5187ffab9e624f97924056f22e5d10d6caeff7485f544b0ae6ffa9e5d8f5945f80423d05d4a94b6ebb7b365b1826c2c71309940c8c779cc6df6795c88aa20dc33ba9ca7ef791e1b2b7aae16c2129c923effe9f7b0634e9adfb37e2243b4d1582d600eccf0479ed90f292460a9c462282d5cf9d7de27da80c53eb1dd3015d01d198bf28f4af6557609c7d22adbe7f9fb7cffeb055f9cb825f60d3f118b04614d4e868c0fba563764b65c8d89268b91285b866d4b13d712b3720e1fb26dd0c8654f15be4630238133d2058516aaffd5b96b4f03c2b86db595b96faab70d9e91fc5e21009fe2633e4c430e4345189cd03025d0b5bb66e21db8cb11b82ced1eba74faecea5ef5a7d8d8e8a470a6219a2ef370701fd07a2e45cd129dde08566ffdecb7cdec63f1e466e33f3c2f1c264c5737af6aca31d17c40ed472b1b3227014b4245003b9399c9985e0fac7bd49f5bdf339b5b337a25743e8e8bafa26d73a6a8e0a311c736190cf8ff442f56e3cbeede10570f6adfb41274354e1cbba8db962008fa82368831c0ec8c0caddce36dd42170f47c2ad9ccd6e07d8691b37178319907ccc3b40b8639f56cc65c1a4a9f7d9310dd53e59bafdca5188be81d0133d24550fe6f3420142c5b8fdc01c755d515bd1c8001e60fc69f6d0531b515fe2a8401e89dc83f4ab7955148d35f379aa04a4dc0126da005ab35f1a2f02a0250bc5252bb065fa093b2cf424e3e2dddf02e4cb4c427ea8a306b62832e36d6414a085f0848ff341edd4ffe7f0dcef3a05bc2fb1ea03df086ce6d811b30096eea5169a5b12dfd60445ecd6170da36ab81913af0354532c15aa5ab3b9ab6350b15c42300c12a5705b1b603c609ba94b76491b519b1943ed32e86d25e048aba0aa233490faca9955c5ebf04d5d70f4bc8cc26c4a9569db5b6269ee20f275841c9046ef869d42b73c2ecc5154907e93ebae212d36b7719e1ef2f985965b9048e7a72cdbbb1389fb893b7ef0de17e1a5fa610987e9768141f6c945f1bbc26bc8987c9f955af6bd3357220a20a2b5beaeb36adae248ccfe79bafe926ed2cd80e7814d6f5bff88f85132e0d6b6f729160d3af65a03e1faea25961f8281144a07f0e50fae7a203b03ee9565c13415913eb64148fb479863f65aa352e85e99b33f95de9cf7e0b2c4fceaa12645cc20016e894c9cc96b31258551d9f50c46980f8a52ec9ce61293e507cd6afd0f999e3631718196a164c812b6ffac58cc99092ce1f5a0cfa68d9fd87419e46cefc2fb434519b66aae2fd607cb5deb5c795f5d1431262103518adba73235759293fb0e857948ff7aacef4645db7867bcb9fecf3518af0bfef4c375d984d0a4b89caf7ffe86d33b1e2c3e40ae5fad8d63bf2067ed57df0e817109f10270b08b80344d7c20fa9ed1e0b0488f6a70930fd197f757deea16daeea54891fc5f92e1d4db5e7e13b23dbbf1162827f72d8a612f95bbe1eca2e723eb7fb9e6d4859ee90bbc31c5a8c13eb72a289bb3b5e397afcec609046870aa66e00689f550f42841e22be0903514caf08a53b96beb08d7c38ef28fa4228956d8888ebec74ed3238fdeec7e89869dd4571fe634b4c2c0e7fb3d42790709f80fb8cfd1f5ba33754ef4cc46324ff76109be0f92bfe2ebb5aee8ba291c4ceaf24d9bda4fbb703cb80ccdcbee9a17754d98f04b41c07c206d9f4e2c506e523191b93a6e4da300eea8ddd475a260d97ae92c5c9cf063a4616acdf383c6480d4a6588e4d8d08495e2fde9ab1d384a5c54feb25831f66152447bbe4eec9331f1112a21c3152fc6ae5d3ca6672f5f106c59fbd594450b21b5c8b3fb529faaf6a452e1287ec82e0bd8d7368ce658b1679b5cf295983bb9d01e416e9e7e13cb5319edaf76253ffd2b003eda822195f8c45c6f8255d2f8fb4e8162be323d82021f8df04a69fb9bf1482857a302e74bf3791be2af18e395cd9da3ec0dd5cb5a0ed7ebd35b4d37b479b1f00087695a74315c234346750673f52a04417bf37754a6ed3b7713654148cb4bc1afa53810c7a7f8de667caed23c770edf7c1bf1700f818a8590f0a2499eb89f1b43f82508bd61f7f9def08990f4cf6e6705188bb98136863d6342457a04d40dff20f34dab5e211faf5d9fd15a4687e6a8c27b3894ca9ca4b83b075b60d430aeae159fde3f7ad12964f82866351203c0b76062584aff1d7be38e17216ed1306b373ba1ee0f654dea4416e1e17f72380d363fba9624c5d835a054dc6e71e6c79052c780289cc5f3a4df99ecc8800e94e52ae189e2be15a857ed1b63ceced99630d28bd0482c49d298b755fad004fee268fdfd2d8a50073f7e99bcfcc8bc45e372b069f493a955cbd0d8b504cce5c15a477ee4613ab203ed958e791e4bf62d1837f5736d0da3a8a530fd0f78a223733dfbb806aeffa6152d9a621a17fe932bd83741f73811b4a790454b893592d86a376e933ab397f9a51b29d6f24cb6c1726c27c2339e1ddd53b7235a89cccd43de86aa2933bed2dc9ef5aadcd21a8ff65c3bd808e993a96da651ccde5206a0ae47a75832c870ea8fb6e7626a2762f1eaa6f1a2e0086b4779942b556fc492368521b4acc1f1ec9c37cadd9bab407b9aa0c57597ef03a97b1c540e05b969cae6c810d591d882100fa86e7bbaf2bd18d472244ef2a03e4a265e4b73aea7a99c6b0c5ba8f18b15ef908c24cb2645285646c75504f3d1efb56f38e671026f0e8f7668f025cc57b2d3aacd1d51aa79088b4d708213025e9aa3faa5b21086443049bc23e9261f61f49327881c8253a851eb3ba51c7356c666064a4810e755a8676a806e01a47686902575ed73bf2067a5dfaf3faa1a74fce274e9f7c8929a4ec6cb747ad373ce572f31965b19d6690cf1cc7117a0a7da920a60d96ad9d7b0316a4d3ae03eab309cc726db0227b56d33c880cc44176e96834d546ef28e91f53e93535097c203f6aa437454782668848f941b17d39f3837c366d651f751bc4455fd3f66d7f5e4c4c55c120b5ae1bfe02df1ed5ae30adffda58f6d81dd37c90664cad35addd8dea65d61af80912ed003064fec9e513fe96d75a8898c812b2c3433c9640b3c73ee6345cc6017716fb124a059eb1a8a711427c6c2753007e598aaf9626ae006db26a27cd7bc040c813996ccd7b222e44f2a10974f61c55abaeca0194bbb5482a5f57a2ef292d3f59fd772328cdb8ba77cd61b57e6b0fae6e7da4f2e5e5a7037ff45c832ac4545b53f88892a585f7ac8800d6de727f1ae7fae2a23d0e1f55930b1e9c358f80acf7f7fcef939df86da00f7cc5df6706a5587b42880965b7a1eb2588ad52aa25996794ffe41951415a3b35ed50c4ab248d84ce30b702c1f485230dc79f52e56b520fde0b5c7d84a3e61ffa58d4229cd6931ac37d49f1bb9abd1f0e3e144a8b0614437a66052f3d28e333e871b87244a95e59b364a0ef185241832ccb3ac8778d9a79d9f4315e63b3699a3c751b0fabf18b5d94c57779a3914b0b18406fcdee41f701f3c6cee455c328734dda7369a4cc90085e9146349eacb3fe980db19c94bdef9a952cf2073f00a7bd2aee520d4173813a471018a299c365d909b17b627bef6249462e096fbc87b73c05e39de8d681b5124695ba97e069f4dfee15eca7147cf52970b0c47b3ff36487e574b13bba53743969ba5651e747848c5ba098347e89f2851634c7d54e2b756836b236ec553459dd0af88011d991cd1544cbb2b3a51eaac96bd3c474ea9e0d5893f4f8414ee91dbc7e8213365ed1b9fe1352ca0bc182ee6848fb48761f7c7dee8ebb830a01a20e741c809fca303ed42ab770fe8cb0852dc42eb2ad6ec184aa3313e3b4b26b18f3af49fd06856691ad9655cd68e079aa2f0a4dbfadcd9d8b9cfd12abfc63c9aac4010d18c2f83ad03fd7e4d4e4889dde296902b999e6438d5816e8aad5879910057d054bc1a13d4e1b26f64858949de90a06517c167aa7250a6b8c4cc61213bafc319c26cb5880968f6a34c61d8200650e59cc7b07630aadcfc16d0f4d39821ab6db64d1bb8b5f1c6bb542793e3dba69e610ad88ade1c4d57493e7699598bccfe81f57d5de7897c04aa031422b21be3766d9de280f5f297bba62d9c836078722c4746c4785691a9ff80d480da30900c0aecfadb48fbf5672fa260d50db9129abd4f3e3954fdd642423bae21fc51abfa7bf58da914a7199fe7b329ed852c647ba92931e29946d13de35c75aec404f12db48f4631bbf67dd5773098ec2623508371234d216c4d69459ca18be741f0143be8970b4d824e383247f19c76001bd6daa0d58152b6c1348931d63199c5aa1012b26451d034d78015038b90dd0fbb631aebc595b84eee3433ef5e911344d875b48c7e1523212f8fb48fe8c94b13e6e0e1ab151780a16bfdbc70d1a6e7823bbc961819b39cba14f7a076c19256ca975186ae343be423b250169552932165314cc1c16281ec8900fe7b7263e5a17a8274435b0c4931adc3e3d27d303809cb0c7247eabcc5441e92007a12c661282b55b516395c9418c4da7fbd73bb9087124b139d0a9c535ab4ad9922a8741bf0b8b2baa027d1d4e12661a629f6afdca67449624b1efe9c601c8c25ba0f9151c2a998d204d21abe008c0428e52afb1a357d18ec2d2c283bbffd1f3eeacd1b894b2880b5dfe66c0242f6540e0af33bdc4f04b364a7ec81ceb630840c15ce6d08833b26b6bde2c7de32aedca1e9298321081122b0e7a94ef9d2690ffe8d8ff3b2b199bceec51aed1475333f1278498012854fbdebff14a48222461f0ff6e7571df354591e96874888179b192377ea136cd8d3af561edcb5acd600762ec4a660f62818ff88893200c01d426345c5c10c1bfac4aaec509b33b47dc661e74ed8035ff4858ea05fe3851d88e1e2343c1fa02eec06ad04515d933eb77455a4b219701d4b8b74d76b17d0c6627f11956be4d74a80a4a4d1035f665c987756de96cde8395920030d190029963e03757a6c6a3466ab9ee7f234eb8c5ad43c52a9ecfb3470f6973653bcfebb50fbe14c003ada78ccfe57aeb686f0b3f337327c34e4b5879b6dfe374e1b452efe0c7a1809912496198e4a335e8bda9cf90d02d21332cf86aab85307a5b5fe5bc7a55598b7e4046843f65cec4f1ac80a43bf909d9434df5d5c7351d05c4bd2d9af257178fe55e2b427577c5ea774f33e3c1e95b30e925a3e07fad1f7d09114361a38492999a41ef6ca892cf34df64b9cf7acdd64c39df7b1561993f2eb9ee81e52802a94201dd80175d7a24467ecfa2661b91f5c777f56c5affa2509867fc11ee42a1441f9e662bb37a68a84a3bf9c25b0ec329d10c00729fb4486d23a70dfbff0f7266512d20098eb33ec516ef5f6562219775a656954f2af512fff939ff82a419ac43031f703481055a42b63de81ba5bd6401e07087742a616929d9d3ac948e0c1094929df43675184d7e81e908235efe2366bdb3285e9943950944c6e55937d9fd62674971e1f77183134d20c2cd19009584c79f14646575c94be27a136ee3f92ac4dc7766b28ddc3d7cb81ea75e346b79ce4d79f3ab91b2f08cfff832cafce2f9536777cfce33969ab12194e51e48d13cc846142a52dfb1cc9850ea14452b00c40c260874faf36cd9927e2c1542391d442a5b9b027509a4eec6e097a50236d0efc74801ce9fbd679d4832c78a74da78309af24875c5e15f90c7add6a473e18055986794aba824edbc91f626df379597cc07d46f6a455ddbb0f6c7b306f15fe29b7b73ffe691bd7ca1d6c979758c84bb2d2d50c46ad4c82e3d1f60914dec39d05127c5aa5fb8801f88a7f03b0a739dceb8948f9e50dea2da0115da14ba751a2e084059fcfeead81392555f2f85393386b7e80849eddc01b346e1f8aa6eeb4a2ed53a800659413f5369f78daf4a51aa8d9d6c118d205bdddb8baadf01ad97cfde4037cb26e102e1b09c0237a8a3fb5263125c3923a0b31e16350e0ecd9bf4fdf490bf792e8436d50834e0a674f69a41b4812675be916387fea8f0e23362402bb79168e1c67bff416f865b2c21ffd877ed15d1406b1f6b81cae936d2dbbf298e66b7e2e7c8b3280a6a58fae5c70e53438f2337f0158210e69684f21e92143d0395ad2a7c400c55829fdf1c47ed7475edcde4e83a96027ce79a9dc73516eb0fc5b475dff6cc0096c99ce16c5f8813c800fdab5509bbebc43a2b9c092fc6b880431ec30c534de334cdf2d89d9ff34887e51746a366ab383e84dcd8f689cf00765e7f03f32daab334364ba5bf4d220de8ec49d9137e06ce80e2074381bee0d6dbcad8e3b5892641f6df153858ae9b56393989b71c6cf095afc7a7d197b20a9d94efcc24f3066815924d3d4728e38e2f9fe8dedcdf1cfb2b300faef85eeec23d6e4796213dba180b9c7614c3ec3e926afb94618bec91a4ac9b3bf14baf92f74c7b9c8fe3961d8a2c1c5a5c9fb77007e8d00ce328443cf4b825ee246e85bf4903e8610e50c3b9b3641fe1d9ec6d3ff817d8a06ff4c5cd4499fbdbe405bb70c68745c088bd57c4ed3201c5735b77dbf9cd532e87916af64ee67a089b9a6680bf4cbaeb8678dc1701ead0f67fe3bfbf556979131643098d0f5db4bfcce9d83ed5022ad8ac25e7b8a89db39c5a728a5e529d9bf1b33e46893efb922ba08ba07f33fcb54d17f8a61079b2bc9cb362237bbdd9afc55ecdb0e2b8d314e0098dce1a841df1c99c7a507646b8b896fdb0ba73c7419db279b4bf502212e1289a2a24740a72b15bd48d5e2146d1c5b01dfc71faf1ebbb4f59eff913af3ff182ffe3a0bfba56969c0caa6cd5192d50df65d73fcdc54e3e27812fe23a4a10418175512d233becda786f80570796b40d057ed3eb2e0172e1b428f8b8e7dcf590f36fb6e4a099125f72c3d6eb1a1e481e49ffe79fb5ac8e306a558563e4f2214ac8c515f7042a41d96d45e95afd3d58ab3e40c7dbcc235c2891fc356d80fd4693a24dbad9af8be16f4838e9f1e3f4c0c0d1477f176d08450f176c82b870ec9d318043971d2ead2cb7539367c3c082a0298ce4ec7650eeb06b08a20bf1e73bac378896214946b37101569d87828eddc3f1d9f0fca411b2c8465ca4eed43425101ca31fe4ce1a38984f4e99483f74398575673d2ab1ce32103be983696c30a9c23f6e9bc8eb748e58c7d1dfa432c63eb78c5bc1b9e3d3b867c1953df44bdf6f4d820e3422066f402ca7030959f744adc23d3917db7d0e50d749374f8ec1c26ba03beffded0f5c4ec79674f4830d0f64f252b3cdb6a5bad7af9d4c5fb687d7f0925a5e4544c1df9577828e36f12c09a2e53d53e6d23f53ff119d814656d110866509531a271c0222d7c078bda316b2f6911ca7a8611e8b9b77750a3",
            "602d2e02d32f4acd5d0b2981d8e78a9887dd9960eaf6516fd702e7d74579d37959454cc83961c599043eec664a302109b7d191b43bb22ff4a34ef3d46b084c67ab075e5e8a0d7b31a20037e3ec087a1ab3588d4d481c04e2fa8e127ff1482a29dd093775fa985d9f982f5010ea20cbb5ed6e922bddd78fa9b396668a24946605f65c454aa0a3be54ee09393e6b9fcb5498a0d5968fe286264450fa62aebb92731e73557f121142fc727a9af666d6035ef0f5deac8e28a12bfe7ca0f24c2b6732baf3b230ffdfd7169daa4b25a71437ce4226e5c51336801dcd34f8cd744287f117f302dafefcf20894dc7cf4fb2498802554be03b412a4e51c5c9f4f2e72cffa008c6adb976d0d41a94a67b95dbe32371cd2cb75dd2d9f12824ee36b21bcb38a84e2a37111568d83af79ca4566d15055cbb576bc3b8c530b6c37e469c40925549178ce7ca8bc38f98a06e309e5fbccf858c9db726e9e00e11f4d3e375c68c3bcd7b40a2e17d50ecc6591584afc58b4c4693869a260b9eaf0e435555c57a9958f80aab3e64ab8c6b9990ef893209cdf10a8f64ce139dee93efe09fafbfa4c60713edcfaeeed7e45ac2af3f16ca05158c7226b936bea7234e4af415baa2d0fb5298a731a1cffc0fe90a055357936467de928ae61d0daf438836f58fb946c954004ff244faae15132dc36130b89a79a44d22ef7c199ad7b180d88ecdf47ad34be1de3b63081c61ecf68ee75b98e75a5fdcda3b3643a4eea0d774779166c099d277ed6d09b9cdbfbfc74bb44ca37d4e3df4b6693f6f616b4d2ed42009b9df122ccd175b1476fad5c2a03a1481a64f90e44a276dde08f0fa348d4fe0a8d35096e39942ed8858a095aa74e34bd0793cbc8bb654ef3d8cac1ceeb2089eb651a0daa6b662a23ea6c9f0c2b6b401e5d6e1e021715a71a6e0e089ef6176a52f591970bda8bbd6173468a970f17404d5a2dff54170bc4195d17cbb6abcd97439dbe8caa603d87ae0a6e78de5cb7b8a4eac0ebf2649f88b0ad1b261527e679fa8e919eab8faee976a3bd27107cf5eb1c7456078e38440395aba319881cebac27c71440b9ca1bf17b81edfd9d345c748a0ca609fe1e2b8b613226872dddbf25248a54fb50480b9cb0b368c62617502003021328c0a02e429a402ffb859ae3c6e5956713e05d24d050c0483fd836370f709032d090eabb867f98b6684db9101f45c44f7b0d238633f0013a7cd9c39cf753de1325f2e881a494cb14662c0f6651f23d484f07b87f39b9866bdd51de5a6d6799a6e5515f26c016453215f4d92dcfc543e7eadf245e3560ab9a00ddb82ebbef6834e2af8633e904aff2ecaebcfd5e9d11d0140d548e75331ad9a2fe8c5d79d9dde07452753276fe98a845b294d5ea5d07a98f89dc031ab1687770c56c1cf9c98dc21fd8374616a73609b5a2a314133a9a025669945dd03e20999ced765230d420e83755f96ea777aa31f8f22771d46053de64f0374154d96793fea867aa716e36085ac1fe3a8b246355b97ca47c9e30e997fee3c77b00159e14c46a6230818dbd63fde8ddfb3064b73ec217d1acb2de2cf35e87813baa39f4f6fb6b2462a4fc25e509a980d0caff9cfd670973d6e1fbf297b7e3fb3ba1c046dba558d16eacc5a085317fc486dc1c0f81b74155563f3059daa3e266141dbfdc6540eaf18f67c4ab32e03760e67c3abee1e5d0c8f52c289f048e8ae4badc56bcbe2b6c92aea53f61a655fde4b0c2491f2d83508a896730d9e0b6a0ff69603ecfd05eb387021e7657d5aa06307f8abdfdc10d22ffbf2244f84e3458241d98eef7a394f6303caeacda2b595b94e3f050faa09cc1b3adaca2dbea0bbca7f61ca9d74bde5f1201fa9519c6b94e2a80f6c0883d9d13455af7abbe04daa66990885a3670d0a79d59c12e62c4c54ce763cc4d426f4262873f0db0c02fa3c0ba56e4e64ba1491fe101b2ff4bf59d279a5747454c27c13ca0e2b741f8eb3cfeef6334a0febe48bf731c5846d8961b7c1078d6e5882aa25e530d997bbeb644a56190978ba619104d159de06edce3d33bb079b091b92f70ee2a58dea21b909a69b07543d1e1b7891841526b9990ac4ef0b9da37f9d002b361039e155083939d543f0a45f7d60426c3bcb51de17c3f63814fb7e3c9b7f722cedb10faee3bb4a30f7c6254747ca3ff1e92b2766e639902f1d368a6bd9227f73667a62b4e0a4e0aef2d0338aa6093f40711ac70acb420aa8b05de487533a78c14e479271bd77cb6b79a7313d20b64ce5a979407b89228765319289baaa320fe87f3680948d258efcfa0796866d8840e628e294b820e4bc23bc1eafa512d2bad4fe9f106b4ee0fbdd8701a1a1a932045635afd0987fd3046d47073cc07a0f6952321cc6a147ff653c1e36dc73c7a77d964ece438334d57fd7c471156a0e094c38c65f7ccc4befff759a6d7fc91dfd8a96a01083e92382dc5162d7b547ce65b97136443eb00d18a85f9f700933990fc2552e9386cc3aa406d79fe642ef9af118fc3dd785517e5eefc68899b21cf861d1abeed0366ac6a6a86bd0cd74e604ba14042755f61c86a7eaa43ccb088dcf7b358c2084cbe7eb5be55e16419088043f587b53c9abe1e2099d5283a76fd7016c3d86b4651e9d0cd4fcd94aa57256240d7cd3c1fa24e9e14bd33750516c17285bd27bcdca25b0e3470571134f99405fd39b1a36d32138c4a31335bed4cb4466b49fc72c7b228b8b1978f1e3442a3aafaa2ed41e286999ea87ac7879809ed003e570d33cb070aeca84113b9e3ced5f4bd47bb628cbdf28df97477e0c9684418550c86b6ae195feddc7ee89dabecdfa6ba05325f477b248cf46c3009c12344acb5b58b88052885fb3bcea850ff42e86843fa97e63efa52fca09c535bcbbe87f8cce64ef88acdd676b1acd997df60fd85178e22154fd8fe50918b0f43803325646f2f6bb85159118e2d55fea6361a4f10ddefa8403f37f0e14692227b403fe61e385873cee3365cb7869b776fda40a5691fb4df4fd3c0693a252e54ff48ed3183f30055e4f1dff2503d3e1e34b357f8f483ed64310dae6520b713376b6bc770b0785ebdce47bcf463628af7173ab55a2857cec8010229aebec7127c09777c463af8899437d26572d3318aec4a80a3d6fb9082d91ddee3f845066fc9c64c0e0ca29d3cca6b6890ec7c8c822922e23f9f09093bed3a39ae048eff34179cb3584fb10b3fdaec30f6f32641c7db272fb945c19b6811000f15cef4c4b602f8eb644b54a83a57e39b77da19ea901693a832c953aef9cff699adbb39e7c24c0c5c8c57f1d7de9bb79f9fd664565f9c5435a322c3fa69e025c35890d4fdfeb5473ba2f5d424a1f2b0472f3bd32d35ca5a7f0a2c4723a5ad3fbc215a26faaabb6aa4ef5851588c4f1dda664a6f079d47a44aa122aba034ca17b41d51a3d4d965456537e8839ad8ddc3b0425d47bb4ac15861dfa696291908604cffc980b27e9371516665374a47206d2d97ce343269c4165cbc1d7a1e16abb9041b5157bda5f10b83acdfc2ca4885fbf092cd3a7985fe0bd3d49deb15f8586246ac10fcd97d7e5de1aa09d11eb33f55b9db3cb931e74d90393012146191f44568e4b14543293406e395f9412d5c307c9da48e407a45883b7de4c0cd64d34f68c1f8b148c92808ef33c5f8a3e9340ba0fb2665f419a7e2d052142663ae6f41c1bd4fd3e8bf1e6fa6adf337bcb16aaefeeba2e28ec8dab4d0dfc9d8f53eb0b430d65d3471f56bac22a340cb17329be6699415a9e4c5e3b663def46ef13c251fa41d73a3de23169a53ace94a06030c83465cd0e49068fd77145ba6a632317a85206f8f1a335b3d05bba34c1be0aeee6cc0d7d0a384f32fa6fd59fac16c9de01f93847fe7144671f69047184694e842f6f551fcbef6ae8137895d014c5a7630beee100034950df49ba8c7d148b7248529b89bbba035499259b49e5519caf4666a8b571ffaccced3541c976670059e18ba87fe831c2493167c4012509daeebab2d91011e5e2d8032108ab46467b1c54d12aa17af155530ffc7207f91f9168966ec20f59b02079f1d325c80ef9bcfa2efa32068d005b8db3261faced75a8055f97b32557769d1fcabbe2a969539e8383e74aa0429326973a40ddf03d0ffcd93fa743eae2c5b539bd8a187a682860f3087fd76725a12a124d6ca93d34543126e9b3ff9d8467d416b23e94c80ccbdafbdccae304167df02e6a40adcdd085f652f1d0d34b58650736a52799341db9e6b7893c0f3bc52e4d5e5227185377e08ed208acfb1e1a62fcc987c4c9928742cd2cbfe5347763246129a83360aeca6cd748c2fb801d10adc39fb8969d073c698f2191c6d35ab517f70b0be4874d12784cffd0511b46115f6b257a483b779d4972261db50490359894d0ecffa078d34341d3c93edc0fec9fa282d18b4c7e08c07fb7cc8bc6033e2ce129c62fe0e383613cde1e4ecb16436fe110060002ad199eb5a05511d01e448c8204ee8332d9ba565725736b94c0a818e16e0d309179a0eb742be7e1cf5fdd12f78841ac7bba46a0f07a8eb1df4b03d89d86b57c88f19e7d4b5015dc2ef87853a2a01e4b6b4c0a1860905defa9c445bd29528cb98bfaf5327ce66998028077655dd9a1b7edb6889276598d871acc3f934a61428bcdabfc6109909ec2848b3e9713ecdf165f9595a302bd6818f7de6d2af91eaaba592611afa1f05a170689565bb01da6a15c01f00f2569e946191df50f937c729cba15bde9746ec1998bed2aa2d69deac2268dc970c4073da7c8b6252295f421a863d45aa56e788eac9ba95b97fd1a3bcc6feadd680440eacf4a628eb1a2b8eea534319f0717f7f5655b60b53c74ab0be87fa34939b954cd92069a12ec8b529fd2eedebb4f82dc08ea644ab0bac4e4a897702fbde87e45e247b17cc7dcba7bc52aa6fa6bdcc1f70bf557301f1ceae090e0a000bfae2a4e5e52024b91396596768cc6e2287857465163ef899a21375fb1635bff4c3beae4352e076206fac22a15e1ed077d69d218c666984f5489df137cbe0e5dde3259a744fa455fed6d14d90ccc6363dfec588a0a1e1c9daeb5e5c751a58f1a902295507b73d3a0a8745f9fadd9529d328a67f51aa7896311e159a64ad0a1dba72523a2d222d69131462e036bb10307ca53e73088734cbcc8d125451777ecab16757369856bb25a6866748815598479fcd206bf0f81e7335a4d34f29f22b3bb026793663568bc99a18b464041048b14b0283794d45328f8c5a22e87bad3ce1977a461c4d0392897116ef5fb987fb0d4abf20e3f7be113fe06a5355b82495f3468544bbbd320dd2a10833b206ccca5444aae8b0d662991c528dd652eae7de6d08f2d7dbcdd61613689561650605826b36cba90057154bcd28f2929aa787e13a82d5a4cb0c1049aab4a9f45f0e8b1980db1d17b00c2dde3f50f88030b3783fdb4e0c85f733972cbb62b8ff742bbf734a18feedaa08f48a39d71736614053bf8f2565275d6a60aebb4b51629ac3cfb6cc242e2120f89cd9edb52b358af91f90543f9ef57fc68a130f96ac2cecdb7a5c888540c63a927eccdfdf1696a2115fc975f312dfcd182708ea35826d237ef52ea6728cb8a748578a8e3ac113bc6b9a3bd17d1665178276586a248336deafd51eb1b166fd1ab62e9349c980ce899a4c4b98c4b712335134647d4ddec18ce0a2bc8bea68da8f09752041c58e364783b2d7ff146c15012da04084749e0815fe7fd57779e38506e10384b24701ef0cc01aadbf2b94fc75a5557ffdb8a21af5185e90ea6a9818792ebb19ef69965be32e11832cde1cb89ad795e2cb58417a41df8ec8cee6efd6c81727cf7f235fb77d1008e45e78bec094f9d000297583c7a9fbf677d59395776868e8a72f8f96f1792dc0b48db9b3ddcbe2d9608bbc1784b2b8e68fcc71fcacaf7702bcab868524dc2cc8b4e2df2f4a88f9803ce2395bbb073a0f2d53367b9ff9a207a672bc5461ebce9bba668c8083ad92c2787ed05dcb0a96a45aef5e21f7893a655f2e0c688489f81e877460fc04cac12fbf32592937ce7203edd336cebe22f42b5faf52866ba8b0a24840398a04ead4baed6a523d5c551c823e1e5de680d1449910df289e3ec1deed58591ae4a63cad97186f5f45ec519719390cac0fc293ceaea2aead27e1884793cce3b631aabe57b1975ca52bf095922d2c2b5426e596aec4cd50b454d9e8aef66acaa417711104279c661f062e65139c3f49ce44774d0a90235e11583bb7c3f1aa5cb87f9d78a71bace6a5c19121743e21da45946ebc6c517917e6e2db87de55449ab202be0d0648a1176370257b24e860e7a52d5600cb629b9ad3e0c5f7712baa26daafe11449989c0f425564cba5b639a325d263f49b356f7784d4360d73af25e6c06111846e96521fe696561c586e5c85a06125a748214efa15db2dd4ba6281eaeebaa3e3b2cd234a053383a4d7b689facf4eb072330ecd585e993f0491c08a54996798d28e8a3c06c1631d47097a1765c5ac3d2a5eb5c3904ee3f75c1d780419e8028b4cd1edf6d4770a4dfb04eb1295ae8293812d7e6378538766661ea546c7abdc41f061be9b56a5b16fd98384580ec5229493d3f8497b73c4b554460034aa547591be95a380460e847d252674e893693cf4517235ee07da2a218f66931d25975c4674ac3c56b248ac3b643252869cbc4eca476ba48d918edd1ad81378404a8aabdb6cb383acbc175f18e15e117e712bf2b8c0ce8182d3a32fc0ba7e726c4dbb6b02cfa81f1e795cc80453c404451e3ff7633387aa7ad3c4bd9aa9fe4f82767e74a77eb6e694cb12cb2b3e83295880ffd72c7a0d5ebc1714778347b8cbcf35cec77000a3233aa4c38af6f4fce93555d56ac5fd84ba6906e63b951cb2e100531a5e320e63d0322b5acda1770e418d7ef3e722e412d999595605c5555a64c620fc36b0fab71d2a68019bd5230ca1f12de846605fd84bba587d0e997131016f5866f5795945e54502d1188bce534ffc7cb258063ba9a7e34fb687665436aa9b3b9420096262b02ddaea86740cab106ec6f1114ae59d07878ec1171e246759198d3f915c17969593f031ab89daf26586708cde34a9219f9b4b04d94d4d76c4130cfd54979a61ba8a8acb79ce21c09a82c88748a518e4c776b6d8a098c9d8549223291d19023b2d421318b3b7847590beefb5ec664d73e501022a03661035616f7412ad426ba275da3f21f5674705145bebdd958a4e7da45f33727059dac054291d82a0d7378beb9b0270fff0e151544bffe52299b11f970755c2423e7822fdfde7aea71904e60a7a38c85837aeb3c7c8b0923bb745f4d517a028cae8a0575509a525ae5138afde70111820ecffb5e865b8347f4f8cf678508677927ba1662e6d6cce5287e7418bb35a0daae3c61ecdf1f2b3252ae438e9b219c24a0c95dd4c9e103513b16f121f7cd3b0a876c05e9882de9b99a6ca3856b13c2d2ba6697a32ca67aea2bd3eb32415d774f6106461d84d09e3e55040fb7eac82e4dfd5643dea015dcfe7b57f4d3d8fe0286b2bc060b39d7b80b8cb30a813726a2f36ffb85a63992358f8fa18ccf11deb8b967602b0c9f5d15df47e3eda8292cf78ae3082be5fc52870a711c6c953fc9a9b1052e633cb90ba830e4c7a988f494b9c97db319a6b76c096640a78f9c17daa89b46fa9bdf79be62ea4c9231dc9b4386b53f877168d3a93c69dcb6bf22b3287ae89ec49125cd96080bfa65297af1134bb65dea347597210174ab572bd467a74463f730edc01897e2f8ecff14c1b85697aadf841f249676782c3652543110c5e6bbd680e412357aaf38ad5422a0e4b55c54e38840eecb5503bf186ddf3897d74ca347f33a1c8403b2dfac5330a89ec6c6f8381449527a992acbc27e7223a173d6fef29fa95c470dd1a3b426a761254573d84306dbd849aabc70a3f9634c60bf75dfc522912f1514f7fe5d5e4e46086efe783c4befc17103613ae40e4d06d34bdaf7f72d777db956ab188f8a1c646981d6841ff1baceaecdefeaaf8fd7d307a836c25a1b90db0c3131ce38f1d503f4adb722d5a2e3ba85826d09636f4c5645b4ac334de3bda64549be6e0f10c3149bfbd1bf90e9b14734fae291a6713bc5a5fa093e02b99456aaf00f02c4ed861356e1019278d83c9ae2c4b3c5f7bbbcd5892cdc37f8d41506baba9c1e793f0bb94e053507d0a74fa696a4beb7090e3f5742b8bb4c7031a7188862b207798226a10bcd16d890aaaa2bc5d20409daacab092b243b241750579844758c785c3768cd05651cdad63de7c707324c33805f3c7ed02b15fc766842860c3f6f8d214be04b9f57f8efbc901ebf602fbd8f97123fcc662ab411ad578ce5b257952aeb7e5c462e2a4bbea74cdb28cd4d996c83ac4b17c8f84665efd590db5a4fa920e81982e8a9152e7bad018f47aa709a131db5926d055e81e9569fa5e848878d4aad3b9ff42731499312d20e87ad1c6e03a19e14f5110921f0045f73ca5b31e29bd6bbae773295212cbf28ab80e6783c534b4c07700e0061d27d4b5c3caf6d7cf11f2ea6761524a904d11f171a512211dc8e18f80c52a1d439263d2f5628d8523a486844fd94dd3622384adf8a438ddf99f6dc76c425c3995785e22225b5c31d2a681e7f3ffaf67b250f9e8f2c0046f8099a8b9cfaeb29b18a5f5cd42a503e69bfe7f4365326347ee13c728e654c3c87a381e45957be0cc9c3f6bbb849b3525c21c90986a676ec0b9d92f4a3cfde739340149c8ff374c0033df17da11d6a2678f323124ac1f0115d0f97df165ac946141fbb2a632c2705cf4326907e8f9c5f49464d181defca236f243dbffbf849b20e7db104be00845a064a1faa1a1ba46b7b1b6c29c6032b47b313476b738141fb157190232617821ab27fdbe00b7844556151e3c6ce6854048e7b89498d1d59e1fc94355fd84607e60a164b9970fe18c96462098455a4276a3d43e7352081313587142554e83db9b322384723ef80efa3251ddcd0a2269460768cd8c25fb58d8bf27f4bf7c8a461331574f6e5c729ab13634d172b1235dcedea6bb199a1ea4c92cc3f8805eafb1a3956d8435aef722d6a8be651551978e9267cad8a4ab110c2005261365227efd190acd820ce5a940bab7b769889b36b80effca3f51da727911f2d1c086c24220b7293000902ad169173af1cf48a1a8f58c4edaf1bdb1d1aa4640f4181272282cef523695b4f01d166432f7d637f2291957618d92a9e009f741fd082b36134a20dc6de76a8441c3bd8b46b0c2aea44fc22a3a10e27daabe62ef832af3438ed5aa00125d7495bd27e5ee0549a4a990bf05d005206dd2820ebaff0c6a443ee73fc33d01cc741887eb4ccbcc245949a99e3a62621d3733bcf7f4332caad62c45a18259d745e26a2141fdcd04e20ffc4ea88515820272dcb65e1ea7edf9310ad5f6208b1d75d7f254d47de08167712e7284b3b99d86cc74f25bd19eec3299c7b9fe2c28447a915ffc7f93be556d6554282c70db903988aaa549b9d68fc87986eb9db0021277159ef223f59b42cb89518798a2179d655245f6c41e77b89a46898dd4fb80e43e754fc96a1b0259827bac1a668174b48fde7a3620e99cdcef2566120d2f88a65bfdccbd88cecb50fce5f94b34c3caf797fbec4c352e62de4899d342b28cfc8f23afb231a33f506c1ba34a53c3e53c9a599e82598e00d829a8947ece07f395d664157b3563569fef8dd76a8eb3e81c5f4d48dfaab1fb87653a6e73fa9d4a2b33f686751f76398146f743d4fd6773ce8f36b6ae26ffe9941bbf0fb07f7068e907565fa054a0fb4fb4357deb1109f57523eff0c7e3f37b94f6682054678b3243ad76d4f8bf1383f5c18ab14496ebf2aed97aee7d951161671112790124b31c485d8e7f65725d8364139456d176d24b65561a6732d9538c8f29d1c22db980b9ab8d8f5af5411ebb7471181aeb72b47cf6888aa47108bfa11be2bbccee1d345bd2e268bf80141f58f70504f96570dfbd52c3fb9940bf8c7ea70358408c708c99d5b68271a4a6bcf009c9d915cfdca5d9045686900dee024ea7c34273e4093f9cee5c9b671dc9f484babc1bb78628e723cb6be52e4356cad3f82ecc7666abedf60918555f49fa524273d33d19fbc1cf42901a99e3ff9e2540fff0eeaa8e760a2e4680cdc1bddc476551324bcbe0167a0790020788217dfe382690f8e17f3df4dbb286f677ee2238678a19f45ec398998a28308e689c61de4ae01c7679427b86bf6295b006c114147249984cdef6c77a73ed0a49bbaa155cbc88387c14b8a884a6050664a8535f8d5b4506ff448b2ef0a6da5db7938c93f1e27d46f0a3a1ddb6d2885ed1d826e6285bc89c03050d84f8ef8e6c8b58566fd7225566420addcbc7b62718b9d966d97efe6edad9134aee9b23e66a97ce3e730cacd873026a2fe0fe7f236cd395b5a9e02e4730187d942ffb970fe8dc869c681b21efcd1852b78802f1f6ff898405abf137a6bf5896e291096c1bcd0e36587f257f41c32945d83f4d907f83d6be509d83a34cd4dd7783a5a6e8ededd60d216580bdd913c660ab09447fe44eb3300e063b0ced4e328b3442a934ef873cf532175ff5039b48922520535ba5d518a1647a7cc1258c3162cdd9458a8ccb95d4d2fb93a2de53292fabd3f39da0f692bb2c99a3be50c4b06ec7267a272dbadc26b2db80c00bc47c2dc7a0d21f908759edff0cb9cfef92c1791a5618f5e4184ea4ada0844802de0847bbc4050da6be08542b49bde852fa196f2f8a05c9b3a09e67e1f03efdcf80a6862b5176d454649af05a5e9843f95baf3535101fc95db886f8d4c75deffad4d19a80ba40b0385d1f2da0496ccb06c21d303f047f2134dec3cb7845dec81037c5b68abc296e2e6538983122b7a3c3a7b940f2def7108cfac9ecfd9f1b28620acc72993f57ec7b9aa76265164c7cff05e997f9b3ed73de443af66ebd95b279e000b2810b22b63706bc4cea3a39fd21746cd8ee70d7f058e4d01e0697739519eaee06036ff64e48c4dc5f397f099bdd4517b71c564822b5832175ba40324f09a46c026937acc4b21383e2051a34c58a31c32d72bd6d05e24ebbde68b71d488287b232be865f5bee913a8f25a46384d0fd3a3ced15cfc4ee2ec71645c3087d241912738dacd5447c91de43a8a6b5e89c77f04f1ee8c44daa83c3ea0b06782c7690304e5c943203fe3569086139abf9f9435067611bb7582e5ecf83cca5e20e8dbf80268b4ac2f50c00e3990fd3b86a347026557bf2851021064a44246e56678d40b0b8b2c8fd6c64e9e2f7e3ee4b4882627bea3e4a32a2b031aff89349ba08582a1a45661ca7fcc2e663113190fd31473d1d92cc9a8e26eeab6e01bda6ae06447ea0d6b3617cd5e9c98cd889530cf245f1c3edd706ff7e5af558f5d695ef0d370a62901d95f3097558412c79333a33adaff7a354e53eef48b69d6c2333123f37e1b1df49aff7386ba403e5aa0bdae78d93c8001c0331da05d591a5f1fbf4d28e1281fa49a2aa0b6821e89a44845bdcf1a0fc9c925e95eb5383ddce36ff63bc3d8a6f940c634651a0c4d09898953a3a7ca2ca32",
            TestName = "Multi Block XTS Really Long")]
        #endregion MultiBlockTests
        public void ShouldEncryptDecryptMultipleBlocksCorrectly(string keyHex, string iHex, string ptHex, string ctHex)
        {
            var key = new BitString(keyHex);
            var tweak = new BitString(iHex);
            var pt = new BitString(ptHex);
            var ct = new BitString(ctHex);

            var subject = new XtsBlockCipher(new AesEngine());

            var encryptResult = subject.ProcessPayload(new XtsModeBlockCipherParameters(BlockCipherDirections.Encrypt, tweak, key, pt, pt.BitLength));

            Assert.IsTrue(encryptResult.Success, $"encryption failed, {encryptResult.ErrorMessage}");
            Assert.AreEqual(ct.ToHex(), encryptResult.Result.ToHex(), "encrypt comparison");

            var decryptResult = subject.ProcessPayload(new XtsModeBlockCipherParameters(BlockCipherDirections.Decrypt, tweak, key, ct, ct.BitLength));

            Assert.IsTrue(decryptResult.Success, $"decryption failed, {decryptResult.ErrorMessage}");
            Assert.AreEqual(pt.ToHex(), decryptResult.Result.ToHex(), "decrypt comparison");
        }

        [Test]
        #region OddBlockTests
        [TestCase("e8f03700d0591345c690bb22f6dfb09829754fdf31a07d5520eb182408c3e8eb3ac1743f285a7df5348a51df6cf5543cea81804605a553f412cca040feba8fb5",
            "78b48983f9f13fcc9063607144c1cc95",
            "1701961164b41aae6a97c0a2009cd357207c3bceeb12378aca",
            "a63aa7bb83f3cf3998922ea5c9bc1b721e010706fbef1d3b53",
            TestName = "Odd Block XTS - 0")]
        [TestCase("169a73bbe90caf78a1e962792c8d7ca5c8e43e8f29bdcd7d5e9a6e1f34d521461ae8820748ae408b38522ef9283e32ef078e01918b0f939af99eddc67921ce1e",
            "44facf038d9f7096268e4d4b5735bbdd",
            "b23aa1b202be7f39f8b54693d49e4a015271c48c56d0daf64d",
            "c3b7c05b12a2fd67b13d9ccb753072f1c592979a9c99aef5a4",
            TestName = "Odd Block XTS - 1")]
        [TestCase("bfc8b9589e85601cd787c0841493d19a93076b036c4e346e577fd626826fbbc776e316f39b363a15965d2edf07a384e476c13446906656e2cf63d41f13df6f0d",
            "2deef414e545d45042c928d1d25d5010",
            "b9e9c1abb0d9c6b0184cd3af51979d3c8bf21b8c73ad01affc",
            "a9e0e5ae8e9f7bbdc01ff5bfe7d3dc94f3ad77caed5078c2d6",
            TestName = "Odd Block XTS - 2")]
        [TestCase("1a00cdf00fe47aef4cc3d6127fc8ab1e3b96d1dc9e99efafe59330b643648feec0ddccf7f79a9235758a77be99944a97dc3f813bca95d3e6bed442935e058217",
            "18a3cbccd5c1923bab635a2dcb9cf3b5",
            "937f6105b6bed5670d928e32757efbf144804139861b383e1b",
            "782c41e1c06ab484e7340971d35d6a838ca7a8d69272f10379",
            TestName = "Odd Block XTS - 3")]
        [TestCase("6c5697b24b9c48d344c8f3b41a068ff2c33f38ace3bc07810a3f1c0d8c5843ffb4fb058a1d9d3624b257d26f2f292b0a6585625b24294c657bcff9411cd6c6b7",
            "3527d3c6cf95a6b534a2d71ed773caa1",
            "348260dbf1d0b0fb00c2b64c64fe248f6b77536d1c9fe3d7b2cff5367aa88b3beda37d050f958ead21a5d4f8216870ddcae2",
            "b8b24bd4a34ac8e946ae36279f4de1862d4a6252fe7c8f5bdacc4b8e6f301bdb4ab8022c138ca3dee0857421c236c92def8f",
            TestName = "Odd Block XTS - 4")]
        [TestCase("c33016c12d19ab2f245168803bd412a22adf02a87c3c93df5926a1f30f4be07806ac29d492017627cf9a06a12a77a50669a379055246b7510c84f0024637baaf",
            "41483c9eb3514fd014b36fe3d49a4643",
            "5737463852e781ec55920d8adbc6c6c9720b0df4cd2d4ac42c5a22fa9acec09fe12980e00753486c3153711f59cfffdb236c",
            "0681c38cbc48f41034bdae1dea015c0dce3d4811d450899941a0bf4bb0b3ba8058029c172d8c84f7fa5b9305f4f080bb74ef",
            TestName = "Odd Block XTS - 5")]
        [TestCase("e469bf9fda58513a49065d15a4f3a22d2bfc40b7cb1cbb6b99dd5022770343701b313f7ec8c2ebe4f038233b3dc40b89a3357c0a49e38765916dcd9a0185a57c",
            "a11019f859758207582cc55ed8159143",
            "cc5fbc974fb9e10959e22212912c87e82b3fc4b12319606da2d0a1b2ddae678332f65ecd92c0885b50d53062d5a866ce8bab",
            "5b9147e63b3408dda96ed5d083312693413570428faa22d5c7357459c76f129641465ad724f36030c361f72070b32d581a58",
            TestName = "Odd Block XTS - 6")]
        [TestCase("e9e5d5fa368017f2c3e2d2dc4d0d4535b403f592709ff87824610972467e94dba47fa55b361f058472fe6664484c6361a134ead56337cc2f1d91271c3b444697",
            "62cf1ffa7813334d1f29221cb123e512",
            "4105609edb8e4fb63e7124c3d3b1c4460eb5f0f09372572f37f9c778e8dd284a9f0c85c3827b73907785fcd2ea702f30c1bc",
            "f1e4dcd57231af36b9347a7758930fc7a1715ae248056674ddba294c5c750f43867d171732145579d054ae98eeb5ce9cc132",
            TestName = "Odd Block XTS - 7")]
        #endregion OddBlockTests
        public void ShouldEncryptDecryptIncompleteBlocks(string keyHex, string iHex, string ptHex, string ctHex)
        {
            var key = new BitString(keyHex);
            var tweak = new BitString(iHex);
            var pt = new BitString(ptHex);
            var ct = new BitString(ctHex);

            var subject = new XtsBlockCipher(new AesEngine());

            var encryptResult = subject.ProcessPayload(new XtsModeBlockCipherParameters(BlockCipherDirections.Encrypt, tweak, key, pt, pt.BitLength));

            Assert.IsTrue(encryptResult.Success, $"encryption failed, {encryptResult.ErrorMessage}");
            Assert.AreEqual(ct.ToHex(), encryptResult.Result.ToHex(), "encrypt comparison");

            var decryptResult = subject.ProcessPayload(new XtsModeBlockCipherParameters(BlockCipherDirections.Decrypt, tweak, key, ct, ct.BitLength));

            Assert.IsTrue(decryptResult.Success, $"decryption failed, {decryptResult.ErrorMessage}");
            Assert.AreEqual(pt.ToHex(), decryptResult.Result.ToHex(), "decrypt comparison");
        }

        [Test]
        [TestCase(240, "f0000000000000000000000000000000")]
        [TestCase(149, "95000000000000000000000000000000")]
        [TestCase(49, "31000000000000000000000000000000")]
        public void ShouldComputeProperIValueFromInteger(int dataUnitSeqNumber, string hex)
        {
            var expectedBitString = new BitString(hex);

            var result = XtsHelper.GetIFromInteger(dataUnitSeqNumber);

            Assert.AreEqual(expectedBitString, result);
        }

        [Test]
        [TestCase(129,
            "0bd647666a2de8eb9b0acc4c17a80e4980",
            "bde59de7a8cab6780f510048daa74a889061d9468d17a9b9f1bb4f3641e0e974",
            22,
            "cedbec745b96e714d77371005bc1e6a600")]
        public void ShouldGetCAVSFileRight(int length, string ptHex, string keyHex, int seqNum, string ctHex)
        {
            var key = new BitString(keyHex);
            var tweak = XtsHelper.GetIFromInteger(seqNum);
            var pt = new BitString(ptHex, length);
            var ct = new BitString(ctHex, length);

            var subject = new XtsBlockCipher(new AesEngine());

            var encryptResult = subject.ProcessPayload(new XtsModeBlockCipherParameters(BlockCipherDirections.Encrypt, tweak, key, pt, pt.BitLength));

            Assert.IsTrue(encryptResult.Success, $"encryption failed, {encryptResult.ErrorMessage}");
            Assert.AreEqual(ct.ToHex(), encryptResult.Result.ToHex(), "encrypt comparison");

            var decryptResult = subject.ProcessPayload(new XtsModeBlockCipherParameters(BlockCipherDirections.Decrypt, tweak, key, ct, ct.BitLength));

            Assert.IsTrue(decryptResult.Success, $"decryption failed, {decryptResult.ErrorMessage}");
            Assert.AreEqual(pt.ToHex(), decryptResult.Result.ToHex(), "decrypt comparison");
        }
    }
}
