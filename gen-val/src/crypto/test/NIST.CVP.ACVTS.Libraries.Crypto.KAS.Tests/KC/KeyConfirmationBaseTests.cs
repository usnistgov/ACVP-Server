using System;
using NIST.CVP.ACVTS.Libraries.Crypto.Common.KAS.Enums;
using NIST.CVP.ACVTS.Libraries.Crypto.Common.KAS.KC;
using NIST.CVP.ACVTS.Libraries.Crypto.KAS.KC;
using NIST.CVP.ACVTS.Libraries.Math;
using NIST.CVP.ACVTS.Tests.Core.TestCategoryAttributes;
using NUnit.Framework;

namespace NIST.CVP.ACVTS.Libraries.Crypto.KAS.Tests.KC
{
    [TestFixture, FastCryptoTest]
    public class KeyConfirmationBaseTests
    {
        private class FakeKeyConfirmationBase : KeyConfirmationBase
        {
            public FakeKeyConfirmationBase(IKeyConfirmationMacDataCreator macDataCreator, IKeyConfirmationParameters keyConfirmationParameters)
                : base(macDataCreator, keyConfirmationParameters)
            {

            }

            public BitString GetMacData()
            {
                return _macDataCreator.GetMacData(_keyConfirmationParameters);
            }

            protected override BitString Mac(BitString macData)
            {
                throw new NotImplementedException();
            }
        }

        private FakeKeyConfirmationBase _subject;

        private static object[] _macTestData = new object[]
        {
            new object[]
            {
                "test 1 - Initiator, provider, unilateral",
                // thisKaRole
                KeyAgreementRole.InitiatorPartyU,
                // thisKcRole
                KeyConfirmationRole.Provider,
                // thisKcType
                KeyConfirmationDirection.Unilateral,
                // thisId
                new BitString("a1b2c3d4e5"), 
                // otherId
                new BitString("434156536964"),
                // thisPublicKey
                new BitString("a9eb0737d3f461e919f8d2b6488254320830055cbe5e20dfc477f889adaf147ca4acca0ba2c3fb9027ff6edca59b342eaf5c5efd4adba9bbacb804d3d4fc6f4be48b467a32a2e06749034f2c7fa3a8286bcdeb33a50452f077e2bb30917cf475f7518e0dd9f00ecfe07436c75a5f6687a1ca30cfbdacfd27908bb8b97bb70070726b5ffc1e2c471b8fe43b24c307e09fb209122df36bd0bd9751df1c2159d9405d91b4e6be6e80303bb8dc1363e24a20732351d57447c57002b80be889fe0a7f3ae110181f7f872a4eca4a05ca05c20b5ef795ef44a4f3791d96869a8cf39a6b1e527b76dd0fe167fd6a3e7a5190701f392d746e30509d447ebbf6ce9abcebcd"), 
                // otherPublicKey
                new BitString("22e443250896b4670eb92fb89c9df10456fd4c583f1b1889edcb25eba5cb770e0b76cc839a8dece28e914a8d20f002276e6f8c7fa6b2eba4a508e5d1ed6714f82bfb26bad9c62eeb027e03cf62760f4e441ca60e56b68fa0a11c0733793c274e17852b7233cfa9c439e36ae030a117ed618c126e17e32391845030dfa046be7751175fc5e9f9a0eb9237d3e1245bfbc76e4555b864e5e7ea6ee8c7945f66ee71620528d84645acf842505c2d3b74892cfad261caec52dbf3c21e8c5ade00027e7b5789a44d49a8ab68b2e03e880061f7eebbdbe324228ee23f8d736a75148dd6ea882b556fb74c2fe4f0fd3d8e4846c5de821a79e0f3985742d7c8a9c2e3f497"),
                // expectedMacData
                new BitString("4b435f315f55a1b2c3d4e5434156536964a9eb0737d3f461e919f8d2b6488254320830055cbe5e20dfc477f889adaf147ca4acca0ba2c3fb9027ff6edca59b342eaf5c5efd4adba9bbacb804d3d4fc6f4be48b467a32a2e06749034f2c7fa3a8286bcdeb33a50452f077e2bb30917cf475f7518e0dd9f00ecfe07436c75a5f6687a1ca30cfbdacfd27908bb8b97bb70070726b5ffc1e2c471b8fe43b24c307e09fb209122df36bd0bd9751df1c2159d9405d91b4e6be6e80303bb8dc1363e24a20732351d57447c57002b80be889fe0a7f3ae110181f7f872a4eca4a05ca05c20b5ef795ef44a4f3791d96869a8cf39a6b1e527b76dd0fe167fd6a3e7a5190701f392d746e30509d447ebbf6ce9abcebcd22e443250896b4670eb92fb89c9df10456fd4c583f1b1889edcb25eba5cb770e0b76cc839a8dece28e914a8d20f002276e6f8c7fa6b2eba4a508e5d1ed6714f82bfb26bad9c62eeb027e03cf62760f4e441ca60e56b68fa0a11c0733793c274e17852b7233cfa9c439e36ae030a117ed618c126e17e32391845030dfa046be7751175fc5e9f9a0eb9237d3e1245bfbc76e4555b864e5e7ea6ee8c7945f66ee71620528d84645acf842505c2d3b74892cfad261caec52dbf3c21e8c5ade00027e7b5789a44d49a8ab68b2e03e880061f7eebbdbe324228ee23f8d736a75148dd6ea882b556fb74c2fe4f0fd3d8e4846c5de821a79e0f3985742d7c8a9c2e3f497")
            },
            new object[]
            {
                "test 2 - test 1 inverse",
                // thisKaRole
                KeyAgreementRole.ResponderPartyV,
                // thisKcRole
                KeyConfirmationRole.Recipient,
                // thisKcType
                KeyConfirmationDirection.Unilateral,
                // thisId
                new BitString("434156536964"),
                // otherId
                new BitString("a1b2c3d4e5"),                 
                // thisPublicKey
                new BitString("22e443250896b4670eb92fb89c9df10456fd4c583f1b1889edcb25eba5cb770e0b76cc839a8dece28e914a8d20f002276e6f8c7fa6b2eba4a508e5d1ed6714f82bfb26bad9c62eeb027e03cf62760f4e441ca60e56b68fa0a11c0733793c274e17852b7233cfa9c439e36ae030a117ed618c126e17e32391845030dfa046be7751175fc5e9f9a0eb9237d3e1245bfbc76e4555b864e5e7ea6ee8c7945f66ee71620528d84645acf842505c2d3b74892cfad261caec52dbf3c21e8c5ade00027e7b5789a44d49a8ab68b2e03e880061f7eebbdbe324228ee23f8d736a75148dd6ea882b556fb74c2fe4f0fd3d8e4846c5de821a79e0f3985742d7c8a9c2e3f497"), 
                // otherPublicKey
                new BitString("a9eb0737d3f461e919f8d2b6488254320830055cbe5e20dfc477f889adaf147ca4acca0ba2c3fb9027ff6edca59b342eaf5c5efd4adba9bbacb804d3d4fc6f4be48b467a32a2e06749034f2c7fa3a8286bcdeb33a50452f077e2bb30917cf475f7518e0dd9f00ecfe07436c75a5f6687a1ca30cfbdacfd27908bb8b97bb70070726b5ffc1e2c471b8fe43b24c307e09fb209122df36bd0bd9751df1c2159d9405d91b4e6be6e80303bb8dc1363e24a20732351d57447c57002b80be889fe0a7f3ae110181f7f872a4eca4a05ca05c20b5ef795ef44a4f3791d96869a8cf39a6b1e527b76dd0fe167fd6a3e7a5190701f392d746e30509d447ebbf6ce9abcebcd"),
                // expectedMacData
                new BitString("4b435f315f55a1b2c3d4e5434156536964a9eb0737d3f461e919f8d2b6488254320830055cbe5e20dfc477f889adaf147ca4acca0ba2c3fb9027ff6edca59b342eaf5c5efd4adba9bbacb804d3d4fc6f4be48b467a32a2e06749034f2c7fa3a8286bcdeb33a50452f077e2bb30917cf475f7518e0dd9f00ecfe07436c75a5f6687a1ca30cfbdacfd27908bb8b97bb70070726b5ffc1e2c471b8fe43b24c307e09fb209122df36bd0bd9751df1c2159d9405d91b4e6be6e80303bb8dc1363e24a20732351d57447c57002b80be889fe0a7f3ae110181f7f872a4eca4a05ca05c20b5ef795ef44a4f3791d96869a8cf39a6b1e527b76dd0fe167fd6a3e7a5190701f392d746e30509d447ebbf6ce9abcebcd22e443250896b4670eb92fb89c9df10456fd4c583f1b1889edcb25eba5cb770e0b76cc839a8dece28e914a8d20f002276e6f8c7fa6b2eba4a508e5d1ed6714f82bfb26bad9c62eeb027e03cf62760f4e441ca60e56b68fa0a11c0733793c274e17852b7233cfa9c439e36ae030a117ed618c126e17e32391845030dfa046be7751175fc5e9f9a0eb9237d3e1245bfbc76e4555b864e5e7ea6ee8c7945f66ee71620528d84645acf842505c2d3b74892cfad261caec52dbf3c21e8c5ade00027e7b5789a44d49a8ab68b2e03e880061f7eebbdbe324228ee23f8d736a75148dd6ea882b556fb74c2fe4f0fd3d8e4846c5de821a79e0f3985742d7c8a9c2e3f497")
            },
            new object[]
            {
                "test 3 - Initiator, recipient, unilateral",
                // thisKaRole
                KeyAgreementRole.InitiatorPartyU,
                // thisKcRole
                KeyConfirmationRole.Recipient,
                // thisKcType
                KeyConfirmationDirection.Unilateral,
                // thisId
                new BitString("a1b2c3d4e5"),
                // otherId
                new BitString("434156536964"),                 
                // thisPublicKey
                new BitString("95cab865be9af364440fe0ffb7005db6290ce42ea2c368aa0769f37e68045e1435d11a341a53f885ffc026f3c4b459f3014dac4a89933f07a1921f57a551284ea3d2960f5aae476adf1637d36c6c75a3ce0ecfcb9724680ea56652095df25dde77d3c083ea6e14d3bc06ddda52ac768963cd8bc0a7f30f015fcac6648e38a10e82cfaa2a6e27c0adae0618de331feb6b9ca2c370f6c3966d332cf6cb2dfc9bd290ee7934e15aa4caff4f2d0cc7cbf5e85e453290dace2b769112f192b7b569f9a21f51112ccf23abc581ec97fd4a36c2ebc968848d77e4b2b7632086c04a03f9ebb9eeba9b9af4efd6ffe0dc8b43e6af15d9978d0b541818a6b9d8bd6ef85f6b"), 
                // otherPublicKey
                new BitString("598d7dad107b6619a132a8062cf829373806208064e5717dedb1c91ea92b80bfa15f3872a844ac31862744991bcad49b260e7f6705a31545fd0ff6ef8cb2663580d3f12a4e8a14876ad53c0b900cdc009ac0905e1d5d504c8b5b47256b4c2b98bad5188492496096486b473177f920f1bd64cd573cf344400e72ae7b22c73a53e2d062015bfb6f6ab3e17199b7dd6581310969c6104413e41872d806593b26f76981eefeb3387eb1ea2dc0de23a1036eea3e2d6f262f51e0cfab48d5675863d1615bfc0e71ecfb675a59860369bf1cade2c354dd14bb5af13faed5b1ef835c88733941a36ba90973699f0b13ba6ed9dc8f1bab2c4e860bcb1f412d633b5ef20c"),
                // expectedMacData
                new BitString("4b435f315f56434156536964a1b2c3d4e5598d7dad107b6619a132a8062cf829373806208064e5717dedb1c91ea92b80bfa15f3872a844ac31862744991bcad49b260e7f6705a31545fd0ff6ef8cb2663580d3f12a4e8a14876ad53c0b900cdc009ac0905e1d5d504c8b5b47256b4c2b98bad5188492496096486b473177f920f1bd64cd573cf344400e72ae7b22c73a53e2d062015bfb6f6ab3e17199b7dd6581310969c6104413e41872d806593b26f76981eefeb3387eb1ea2dc0de23a1036eea3e2d6f262f51e0cfab48d5675863d1615bfc0e71ecfb675a59860369bf1cade2c354dd14bb5af13faed5b1ef835c88733941a36ba90973699f0b13ba6ed9dc8f1bab2c4e860bcb1f412d633b5ef20c95cab865be9af364440fe0ffb7005db6290ce42ea2c368aa0769f37e68045e1435d11a341a53f885ffc026f3c4b459f3014dac4a89933f07a1921f57a551284ea3d2960f5aae476adf1637d36c6c75a3ce0ecfcb9724680ea56652095df25dde77d3c083ea6e14d3bc06ddda52ac768963cd8bc0a7f30f015fcac6648e38a10e82cfaa2a6e27c0adae0618de331feb6b9ca2c370f6c3966d332cf6cb2dfc9bd290ee7934e15aa4caff4f2d0cc7cbf5e85e453290dace2b769112f192b7b569f9a21f51112ccf23abc581ec97fd4a36c2ebc968848d77e4b2b7632086c04a03f9ebb9eeba9b9af4efd6ffe0dc8b43e6af15d9978d0b541818a6b9d8bd6ef85f6b")
            },
            new object[]
            {
                "test 4 - test 3 inverse",
                // thisKaRole
                KeyAgreementRole.ResponderPartyV,
                // thisKcRole
                KeyConfirmationRole.Provider,
                // thisKcType
                KeyConfirmationDirection.Unilateral,
                // thisId
                new BitString("434156536964"),
                // otherId
                new BitString("a1b2c3d4e5"),                 
                // thisPublicKey
                new BitString("598d7dad107b6619a132a8062cf829373806208064e5717dedb1c91ea92b80bfa15f3872a844ac31862744991bcad49b260e7f6705a31545fd0ff6ef8cb2663580d3f12a4e8a14876ad53c0b900cdc009ac0905e1d5d504c8b5b47256b4c2b98bad5188492496096486b473177f920f1bd64cd573cf344400e72ae7b22c73a53e2d062015bfb6f6ab3e17199b7dd6581310969c6104413e41872d806593b26f76981eefeb3387eb1ea2dc0de23a1036eea3e2d6f262f51e0cfab48d5675863d1615bfc0e71ecfb675a59860369bf1cade2c354dd14bb5af13faed5b1ef835c88733941a36ba90973699f0b13ba6ed9dc8f1bab2c4e860bcb1f412d633b5ef20c"), 
                // otherPublicKey
                new BitString("95cab865be9af364440fe0ffb7005db6290ce42ea2c368aa0769f37e68045e1435d11a341a53f885ffc026f3c4b459f3014dac4a89933f07a1921f57a551284ea3d2960f5aae476adf1637d36c6c75a3ce0ecfcb9724680ea56652095df25dde77d3c083ea6e14d3bc06ddda52ac768963cd8bc0a7f30f015fcac6648e38a10e82cfaa2a6e27c0adae0618de331feb6b9ca2c370f6c3966d332cf6cb2dfc9bd290ee7934e15aa4caff4f2d0cc7cbf5e85e453290dace2b769112f192b7b569f9a21f51112ccf23abc581ec97fd4a36c2ebc968848d77e4b2b7632086c04a03f9ebb9eeba9b9af4efd6ffe0dc8b43e6af15d9978d0b541818a6b9d8bd6ef85f6b"),
                // expectedMacData
                new BitString("4b435f315f56434156536964a1b2c3d4e5598d7dad107b6619a132a8062cf829373806208064e5717dedb1c91ea92b80bfa15f3872a844ac31862744991bcad49b260e7f6705a31545fd0ff6ef8cb2663580d3f12a4e8a14876ad53c0b900cdc009ac0905e1d5d504c8b5b47256b4c2b98bad5188492496096486b473177f920f1bd64cd573cf344400e72ae7b22c73a53e2d062015bfb6f6ab3e17199b7dd6581310969c6104413e41872d806593b26f76981eefeb3387eb1ea2dc0de23a1036eea3e2d6f262f51e0cfab48d5675863d1615bfc0e71ecfb675a59860369bf1cade2c354dd14bb5af13faed5b1ef835c88733941a36ba90973699f0b13ba6ed9dc8f1bab2c4e860bcb1f412d633b5ef20c95cab865be9af364440fe0ffb7005db6290ce42ea2c368aa0769f37e68045e1435d11a341a53f885ffc026f3c4b459f3014dac4a89933f07a1921f57a551284ea3d2960f5aae476adf1637d36c6c75a3ce0ecfcb9724680ea56652095df25dde77d3c083ea6e14d3bc06ddda52ac768963cd8bc0a7f30f015fcac6648e38a10e82cfaa2a6e27c0adae0618de331feb6b9ca2c370f6c3966d332cf6cb2dfc9bd290ee7934e15aa4caff4f2d0cc7cbf5e85e453290dace2b769112f192b7b569f9a21f51112ccf23abc581ec97fd4a36c2ebc968848d77e4b2b7632086c04a03f9ebb9eeba9b9af4efd6ffe0dc8b43e6af15d9978d0b541818a6b9d8bd6ef85f6b")
            },
            new object[]
            {
                "test 5 - responder, provider, unilateral",
                // thisKaRole
                KeyAgreementRole.ResponderPartyV,
                // thisKcRole
                KeyConfirmationRole.Provider,
                // thisKcType
                KeyConfirmationDirection.Unilateral,
                // thisId
                new BitString("a1b2c3d4e5"),
                // otherId
                new BitString("434156536964"),
                // thisPublicKey
                new BitString("72042195a0f94e760e85dba5d53c31a67159788f8e7b3324061a219346bc866327e97d93ba8c7a93399c9aa75a821c20f53d67b3d1b25e5658468c76cc4206153fbabbf8692ca099e60be0c741a31a2016e10af0d8a2244edb3749ded5edd16f09db6222232289dca1df0e8b61623284c0e1b615611401dd47d8094fcbc0fea96e0f0e1ffed6a7f4f21ae7bb6ecaedeb5f82f16c069bab3f82cbf00ff2d5abce4f5811559f7b4f5dd4e2c3af5b354eafb919bb92def9b8f367995592ab110711eeee746d457b236e152db927aa38998546c2b5b661c341525e39eb8292ab888d223f02e3c1414c73c86b5998d022376e4b7b231c779bf21620f2d3b1f79f8d58"), 
                // otherPublicKey
                new BitString("0c1135385fe82348cc02b40e7be3810e77570356eb81a9cef188a6a11fbee832b4ad3872922f765dd92382aee20863bde6082056e69edfd82a5144850b015782689a64b0f3056ef0f50af2d231083673bbc78e24d7d96af5ef2ca471bd387168b2769907b7cb45aa7d8c3f6a10f881c490667d482847ec8d1660d9781a0db698127b9708242db9fed29f78dcc1782d1881f4e3e3c83eda5f29b54e4bca613306fd6c5be3519ba6ee85f86d6f8602f9335f74540d9591dce8012720f21cb14de28c4b44bd6874abbf258e9857bb507da1420d6e8aa5a44ee1d907808f3c3421698dcf2cd76aa51fab733849657fab6dfe5dfbd4013f85822e7929fa435117ec06"),
                // expectedMacData
                new BitString("4b435f315f56a1b2c3d4e543415653696472042195a0f94e760e85dba5d53c31a67159788f8e7b3324061a219346bc866327e97d93ba8c7a93399c9aa75a821c20f53d67b3d1b25e5658468c76cc4206153fbabbf8692ca099e60be0c741a31a2016e10af0d8a2244edb3749ded5edd16f09db6222232289dca1df0e8b61623284c0e1b615611401dd47d8094fcbc0fea96e0f0e1ffed6a7f4f21ae7bb6ecaedeb5f82f16c069bab3f82cbf00ff2d5abce4f5811559f7b4f5dd4e2c3af5b354eafb919bb92def9b8f367995592ab110711eeee746d457b236e152db927aa38998546c2b5b661c341525e39eb8292ab888d223f02e3c1414c73c86b5998d022376e4b7b231c779bf21620f2d3b1f79f8d580c1135385fe82348cc02b40e7be3810e77570356eb81a9cef188a6a11fbee832b4ad3872922f765dd92382aee20863bde6082056e69edfd82a5144850b015782689a64b0f3056ef0f50af2d231083673bbc78e24d7d96af5ef2ca471bd387168b2769907b7cb45aa7d8c3f6a10f881c490667d482847ec8d1660d9781a0db698127b9708242db9fed29f78dcc1782d1881f4e3e3c83eda5f29b54e4bca613306fd6c5be3519ba6ee85f86d6f8602f9335f74540d9591dce8012720f21cb14de28c4b44bd6874abbf258e9857bb507da1420d6e8aa5a44ee1d907808f3c3421698dcf2cd76aa51fab733849657fab6dfe5dfbd4013f85822e7929fa435117ec06")
            },
            new object[]
            {
                "test 6 - test 5 inverse",
                // thisKaRole
                KeyAgreementRole.InitiatorPartyU,
                // thisKcRole
                KeyConfirmationRole.Recipient,
                // thisKcType
                KeyConfirmationDirection.Unilateral,
                // thisId
                new BitString("434156536964"),
                // otherId
                new BitString("a1b2c3d4e5"),
                // thisPublicKey
                new BitString("0c1135385fe82348cc02b40e7be3810e77570356eb81a9cef188a6a11fbee832b4ad3872922f765dd92382aee20863bde6082056e69edfd82a5144850b015782689a64b0f3056ef0f50af2d231083673bbc78e24d7d96af5ef2ca471bd387168b2769907b7cb45aa7d8c3f6a10f881c490667d482847ec8d1660d9781a0db698127b9708242db9fed29f78dcc1782d1881f4e3e3c83eda5f29b54e4bca613306fd6c5be3519ba6ee85f86d6f8602f9335f74540d9591dce8012720f21cb14de28c4b44bd6874abbf258e9857bb507da1420d6e8aa5a44ee1d907808f3c3421698dcf2cd76aa51fab733849657fab6dfe5dfbd4013f85822e7929fa435117ec06"), 
                // otherPublicKey
                new BitString("72042195a0f94e760e85dba5d53c31a67159788f8e7b3324061a219346bc866327e97d93ba8c7a93399c9aa75a821c20f53d67b3d1b25e5658468c76cc4206153fbabbf8692ca099e60be0c741a31a2016e10af0d8a2244edb3749ded5edd16f09db6222232289dca1df0e8b61623284c0e1b615611401dd47d8094fcbc0fea96e0f0e1ffed6a7f4f21ae7bb6ecaedeb5f82f16c069bab3f82cbf00ff2d5abce4f5811559f7b4f5dd4e2c3af5b354eafb919bb92def9b8f367995592ab110711eeee746d457b236e152db927aa38998546c2b5b661c341525e39eb8292ab888d223f02e3c1414c73c86b5998d022376e4b7b231c779bf21620f2d3b1f79f8d58"),
                // expectedMacData
                new BitString("4b435f315f56a1b2c3d4e543415653696472042195a0f94e760e85dba5d53c31a67159788f8e7b3324061a219346bc866327e97d93ba8c7a93399c9aa75a821c20f53d67b3d1b25e5658468c76cc4206153fbabbf8692ca099e60be0c741a31a2016e10af0d8a2244edb3749ded5edd16f09db6222232289dca1df0e8b61623284c0e1b615611401dd47d8094fcbc0fea96e0f0e1ffed6a7f4f21ae7bb6ecaedeb5f82f16c069bab3f82cbf00ff2d5abce4f5811559f7b4f5dd4e2c3af5b354eafb919bb92def9b8f367995592ab110711eeee746d457b236e152db927aa38998546c2b5b661c341525e39eb8292ab888d223f02e3c1414c73c86b5998d022376e4b7b231c779bf21620f2d3b1f79f8d580c1135385fe82348cc02b40e7be3810e77570356eb81a9cef188a6a11fbee832b4ad3872922f765dd92382aee20863bde6082056e69edfd82a5144850b015782689a64b0f3056ef0f50af2d231083673bbc78e24d7d96af5ef2ca471bd387168b2769907b7cb45aa7d8c3f6a10f881c490667d482847ec8d1660d9781a0db698127b9708242db9fed29f78dcc1782d1881f4e3e3c83eda5f29b54e4bca613306fd6c5be3519ba6ee85f86d6f8602f9335f74540d9591dce8012720f21cb14de28c4b44bd6874abbf258e9857bb507da1420d6e8aa5a44ee1d907808f3c3421698dcf2cd76aa51fab733849657fab6dfe5dfbd4013f85822e7929fa435117ec06")
            },
            new object[]
            {
                "test 7 - responser, recipient, unilateral",
                // thisKaRole
                KeyAgreementRole.ResponderPartyV,
                // thisKcRole
                KeyConfirmationRole.Recipient,
                // thisKcType
                KeyConfirmationDirection.Unilateral,
                // thisId
                new BitString("a1b2c3d4e5"),
                // otherId
                new BitString("434156536964"),
                // thisPublicKey
                new BitString("38bc0ca3aca60890e7d75df6f27fa79979ae9be74b8caba74ea3834c4d3cdcfcb747d48246df84889104bdab59de42d99ce99d22e561a17908bb619da1268f49bfa4cf0f79cd3866c73a2d8885acfa7af2968feb69e0d06aa2615e2f673598ffe9e631b26a673db19e41485b127e06b7f873ed3947b81694fda1d5f5a547ad134d5ac132ed876e330df8a73f348b390e60b64c9d58510545cc23d0be734f1614f88cab0a2a397b73a2be664857e5b85f46e76a9275c71bc35d08c9f4f264adc0f494cf05365f3ad9b4e724dab9d45fe607ba1d1077c31b32237424c4ed4c3ed47d39ad6155b92412d9160c5a77982a8ba13a34ca43419b449c02567b57573d73"), 
                // otherPublicKey
                new BitString("a7361662c4524638e876a113b39a75e5dfeee9852b3d7a7b43632a0e3725e459881f4187bd0d93c11191973c0d949824fd4b843439d31897eb876b8b60586f6c72e1290aabb831548b22f37647d5ad211e487e0614daba9ffbe95bc5b6f0d9d7b8e24b93c4f3b02284d7a62167adc5d918e5a1259cfc203662417cdfa6383a18f46a4558f040ccfaaeff99cf5fd2f0c469922ea23ffe2081210380d337fe6c504c50289ab8c3dd579a982e1d290296107b0a4531670ab0aed0d1e468a93cc73e9f24d7db7b0ef78f9b6ce5b619a4990449f67edc7aa41c903caf4eda325ce0fb7ad0187934969e0a97777a72a653ec140492c7d7844baa378191626e5300aac1"),
                // expectedMacData
                new BitString("4b435f315f55434156536964a1b2c3d4e5a7361662c4524638e876a113b39a75e5dfeee9852b3d7a7b43632a0e3725e459881f4187bd0d93c11191973c0d949824fd4b843439d31897eb876b8b60586f6c72e1290aabb831548b22f37647d5ad211e487e0614daba9ffbe95bc5b6f0d9d7b8e24b93c4f3b02284d7a62167adc5d918e5a1259cfc203662417cdfa6383a18f46a4558f040ccfaaeff99cf5fd2f0c469922ea23ffe2081210380d337fe6c504c50289ab8c3dd579a982e1d290296107b0a4531670ab0aed0d1e468a93cc73e9f24d7db7b0ef78f9b6ce5b619a4990449f67edc7aa41c903caf4eda325ce0fb7ad0187934969e0a97777a72a653ec140492c7d7844baa378191626e5300aac138bc0ca3aca60890e7d75df6f27fa79979ae9be74b8caba74ea3834c4d3cdcfcb747d48246df84889104bdab59de42d99ce99d22e561a17908bb619da1268f49bfa4cf0f79cd3866c73a2d8885acfa7af2968feb69e0d06aa2615e2f673598ffe9e631b26a673db19e41485b127e06b7f873ed3947b81694fda1d5f5a547ad134d5ac132ed876e330df8a73f348b390e60b64c9d58510545cc23d0be734f1614f88cab0a2a397b73a2be664857e5b85f46e76a9275c71bc35d08c9f4f264adc0f494cf05365f3ad9b4e724dab9d45fe607ba1d1077c31b32237424c4ed4c3ed47d39ad6155b92412d9160c5a77982a8ba13a34ca43419b449c02567b57573d73")
            },
            new object[]
            {
                "test 8 - test 7 inverse",
                // thisKaRole
                KeyAgreementRole.InitiatorPartyU,
                // thisKcRole
                KeyConfirmationRole.Provider,
                // thisKcType
                KeyConfirmationDirection.Unilateral,
                // thisId
                new BitString("434156536964"),
                // otherId
                new BitString("a1b2c3d4e5"),
                // thisPublicKey
                new BitString("a7361662c4524638e876a113b39a75e5dfeee9852b3d7a7b43632a0e3725e459881f4187bd0d93c11191973c0d949824fd4b843439d31897eb876b8b60586f6c72e1290aabb831548b22f37647d5ad211e487e0614daba9ffbe95bc5b6f0d9d7b8e24b93c4f3b02284d7a62167adc5d918e5a1259cfc203662417cdfa6383a18f46a4558f040ccfaaeff99cf5fd2f0c469922ea23ffe2081210380d337fe6c504c50289ab8c3dd579a982e1d290296107b0a4531670ab0aed0d1e468a93cc73e9f24d7db7b0ef78f9b6ce5b619a4990449f67edc7aa41c903caf4eda325ce0fb7ad0187934969e0a97777a72a653ec140492c7d7844baa378191626e5300aac1"), 
                // otherPublicKey
                new BitString("38bc0ca3aca60890e7d75df6f27fa79979ae9be74b8caba74ea3834c4d3cdcfcb747d48246df84889104bdab59de42d99ce99d22e561a17908bb619da1268f49bfa4cf0f79cd3866c73a2d8885acfa7af2968feb69e0d06aa2615e2f673598ffe9e631b26a673db19e41485b127e06b7f873ed3947b81694fda1d5f5a547ad134d5ac132ed876e330df8a73f348b390e60b64c9d58510545cc23d0be734f1614f88cab0a2a397b73a2be664857e5b85f46e76a9275c71bc35d08c9f4f264adc0f494cf05365f3ad9b4e724dab9d45fe607ba1d1077c31b32237424c4ed4c3ed47d39ad6155b92412d9160c5a77982a8ba13a34ca43419b449c02567b57573d73"),
                // expectedMacData
                new BitString("4b435f315f55434156536964a1b2c3d4e5a7361662c4524638e876a113b39a75e5dfeee9852b3d7a7b43632a0e3725e459881f4187bd0d93c11191973c0d949824fd4b843439d31897eb876b8b60586f6c72e1290aabb831548b22f37647d5ad211e487e0614daba9ffbe95bc5b6f0d9d7b8e24b93c4f3b02284d7a62167adc5d918e5a1259cfc203662417cdfa6383a18f46a4558f040ccfaaeff99cf5fd2f0c469922ea23ffe2081210380d337fe6c504c50289ab8c3dd579a982e1d290296107b0a4531670ab0aed0d1e468a93cc73e9f24d7db7b0ef78f9b6ce5b619a4990449f67edc7aa41c903caf4eda325ce0fb7ad0187934969e0a97777a72a653ec140492c7d7844baa378191626e5300aac138bc0ca3aca60890e7d75df6f27fa79979ae9be74b8caba74ea3834c4d3cdcfcb747d48246df84889104bdab59de42d99ce99d22e561a17908bb619da1268f49bfa4cf0f79cd3866c73a2d8885acfa7af2968feb69e0d06aa2615e2f673598ffe9e631b26a673db19e41485b127e06b7f873ed3947b81694fda1d5f5a547ad134d5ac132ed876e330df8a73f348b390e60b64c9d58510545cc23d0be734f1614f88cab0a2a397b73a2be664857e5b85f46e76a9275c71bc35d08c9f4f264adc0f494cf05365f3ad9b4e724dab9d45fe607ba1d1077c31b32237424c4ed4c3ed47d39ad6155b92412d9160c5a77982a8ba13a34ca43419b449c02567b57573d73")
            },
            new object[]
            {
                "test 8 - initiator, provider, bilateral",
                // thisKaRole
                KeyAgreementRole.InitiatorPartyU,
                // thisKcRole
                KeyConfirmationRole.Provider,
                // thisKcType
                KeyConfirmationDirection.Bilateral,
                // thisId
                new BitString("a1b2c3d4e5"),
                // otherId
                new BitString("434156536964"),
                // thisPublicKey
                new BitString("7b972fd7d27c137db44c7a9ca1b2c5eabb35dae462aad461b494e98ff40450932167a0e1e0fc07a01cdd5eb4d728016e22cfcabf8bd41df6e5400a2898156cc98e2b0d7f96455f9ee1da8b009e52ad7d2de2fdeffaee1769a9333d38bc21560a39e6e7500a533729687cc8b01347b1931906fc9c1fc5f7eaf7dca0d69b913f98a75b78585facfe2cadf5bf134ed11ab9abad55db9e8eb88c03239b9f26beb1d484faa7cb0f57f52d1325b121f82c40cd7d1d575176a85b7b26089657afa164aafd6252ecf6765ce8179f5c47399044745c6955d9ac932d79de9b0c65ac216f9b93fc69135bba802ecbf2a664e689e74c2d5bce4b75c471387c5a77dd5b683b7f"), 
                // otherPublicKey
                new BitString("26db8b651d4a96eb432363bee05128f1f379ed208ff354ba810adc005aeef9c04c4be883b1a7c8c52e4a53d0481c2817241a7f20c9b194f771f89ce09332ae86530e75769a02e586888363b4f349cebd74040132241a4bfdc3e949b12ec41cdf62e5e20f1ace05818aba2fbd88bac1faa11f0b273b49e04111e5df5cf00720567379c6383ebdb14303e97fd2ce8f2e10fb4607f2f4dfcf165ac45a1e418d6e308150e415ba4eeea7d1da795a645dbf7758d712b340ff9811c3324541fe500268adff284457c1d936f824557f82eef8fc3ef519bda6822c7425a40283d3c70c745db96daea117b90a8cc10d2421f600e2bc9775e37b591e232f6fe644f37821a3"),
                // expectedMacData
                new BitString("4b435f325f55a1b2c3d4e54341565369647b972fd7d27c137db44c7a9ca1b2c5eabb35dae462aad461b494e98ff40450932167a0e1e0fc07a01cdd5eb4d728016e22cfcabf8bd41df6e5400a2898156cc98e2b0d7f96455f9ee1da8b009e52ad7d2de2fdeffaee1769a9333d38bc21560a39e6e7500a533729687cc8b01347b1931906fc9c1fc5f7eaf7dca0d69b913f98a75b78585facfe2cadf5bf134ed11ab9abad55db9e8eb88c03239b9f26beb1d484faa7cb0f57f52d1325b121f82c40cd7d1d575176a85b7b26089657afa164aafd6252ecf6765ce8179f5c47399044745c6955d9ac932d79de9b0c65ac216f9b93fc69135bba802ecbf2a664e689e74c2d5bce4b75c471387c5a77dd5b683b7f26db8b651d4a96eb432363bee05128f1f379ed208ff354ba810adc005aeef9c04c4be883b1a7c8c52e4a53d0481c2817241a7f20c9b194f771f89ce09332ae86530e75769a02e586888363b4f349cebd74040132241a4bfdc3e949b12ec41cdf62e5e20f1ace05818aba2fbd88bac1faa11f0b273b49e04111e5df5cf00720567379c6383ebdb14303e97fd2ce8f2e10fb4607f2f4dfcf165ac45a1e418d6e308150e415ba4eeea7d1da795a645dbf7758d712b340ff9811c3324541fe500268adff284457c1d936f824557f82eef8fc3ef519bda6822c7425a40283d3c70c745db96daea117b90a8cc10d2421f600e2bc9775e37b591e232f6fe644f37821a3")
            },
            new object[]
            {
                "test 9 - test 8 inverse",
                // thisKaRole
                KeyAgreementRole.ResponderPartyV,
                // thisKcRole
                KeyConfirmationRole.Recipient,
                // thisKcType
                KeyConfirmationDirection.Bilateral,
                // thisId
                new BitString("434156536964"),
                // otherId
                new BitString("a1b2c3d4e5"),
                // thisPublicKey
                new BitString("26db8b651d4a96eb432363bee05128f1f379ed208ff354ba810adc005aeef9c04c4be883b1a7c8c52e4a53d0481c2817241a7f20c9b194f771f89ce09332ae86530e75769a02e586888363b4f349cebd74040132241a4bfdc3e949b12ec41cdf62e5e20f1ace05818aba2fbd88bac1faa11f0b273b49e04111e5df5cf00720567379c6383ebdb14303e97fd2ce8f2e10fb4607f2f4dfcf165ac45a1e418d6e308150e415ba4eeea7d1da795a645dbf7758d712b340ff9811c3324541fe500268adff284457c1d936f824557f82eef8fc3ef519bda6822c7425a40283d3c70c745db96daea117b90a8cc10d2421f600e2bc9775e37b591e232f6fe644f37821a3"), 
                // otherPublicKey
                new BitString("7b972fd7d27c137db44c7a9ca1b2c5eabb35dae462aad461b494e98ff40450932167a0e1e0fc07a01cdd5eb4d728016e22cfcabf8bd41df6e5400a2898156cc98e2b0d7f96455f9ee1da8b009e52ad7d2de2fdeffaee1769a9333d38bc21560a39e6e7500a533729687cc8b01347b1931906fc9c1fc5f7eaf7dca0d69b913f98a75b78585facfe2cadf5bf134ed11ab9abad55db9e8eb88c03239b9f26beb1d484faa7cb0f57f52d1325b121f82c40cd7d1d575176a85b7b26089657afa164aafd6252ecf6765ce8179f5c47399044745c6955d9ac932d79de9b0c65ac216f9b93fc69135bba802ecbf2a664e689e74c2d5bce4b75c471387c5a77dd5b683b7f"),
                // expectedMacData
                new BitString("4b435f325f55a1b2c3d4e54341565369647b972fd7d27c137db44c7a9ca1b2c5eabb35dae462aad461b494e98ff40450932167a0e1e0fc07a01cdd5eb4d728016e22cfcabf8bd41df6e5400a2898156cc98e2b0d7f96455f9ee1da8b009e52ad7d2de2fdeffaee1769a9333d38bc21560a39e6e7500a533729687cc8b01347b1931906fc9c1fc5f7eaf7dca0d69b913f98a75b78585facfe2cadf5bf134ed11ab9abad55db9e8eb88c03239b9f26beb1d484faa7cb0f57f52d1325b121f82c40cd7d1d575176a85b7b26089657afa164aafd6252ecf6765ce8179f5c47399044745c6955d9ac932d79de9b0c65ac216f9b93fc69135bba802ecbf2a664e689e74c2d5bce4b75c471387c5a77dd5b683b7f26db8b651d4a96eb432363bee05128f1f379ed208ff354ba810adc005aeef9c04c4be883b1a7c8c52e4a53d0481c2817241a7f20c9b194f771f89ce09332ae86530e75769a02e586888363b4f349cebd74040132241a4bfdc3e949b12ec41cdf62e5e20f1ace05818aba2fbd88bac1faa11f0b273b49e04111e5df5cf00720567379c6383ebdb14303e97fd2ce8f2e10fb4607f2f4dfcf165ac45a1e418d6e308150e415ba4eeea7d1da795a645dbf7758d712b340ff9811c3324541fe500268adff284457c1d936f824557f82eef8fc3ef519bda6822c7425a40283d3c70c745db96daea117b90a8cc10d2421f600e2bc9775e37b591e232f6fe644f37821a3")
            },
            new object[]
            {
                "test 10 - initiator, recipient, bilateral",
                // thisKaRole
                KeyAgreementRole.InitiatorPartyU,
                // thisKcRole
                KeyConfirmationRole.Recipient,
                // thisKcType
                KeyConfirmationDirection.Bilateral,
                // thisId
                new BitString("a1b2c3d4e5"),
                // otherId
                new BitString("434156536964"),
                // thisPublicKey
                new BitString("244cd19c5890ba65b2b1d8278129ed2b2f3ec92d5f6c49860e78ff1554e34a905ebc399c0d45d1e31b819cb54c9472cf686e69cdc4ea5c332d226df0fb877bcbb9969c9eaea9d541900ebff8f716ef1d17e4a6ea54c7536df86094f5d2672e17ef43649ecf3807caa191b47a8403c2dbf7f1e404e34d7da347ca381129c79ee9ede37880a63239d93a4d1d2d204985d3c806529bf822f628168cc7d0add3634ef62c40a20bb18c875e4940784cc304843cd6b605332a3809fca0fcb38e0d8411ac17b3f4f1d4687b59748a08bc6dc1f7dd81f07a647a8af3b6e328fbcbf8b64f4f9b227033e6a1a934f903e9860d379a8e6ceba714b4579b78a099d14bc24001"), 
                // otherPublicKey
                new BitString("d1e097b702bea99cbee10b9b8441182a18cd4f691d45032e0e3cb2422119873dde53542ae7445bf7f7c1d0dca5b4d306df0239f9ae8984d015607b30906ded914155008a5d76c2a062c49e3b32a6d957a809b22565940fdd338da347a3765fc62ed227536d86a253ad2fb374efea3b3d4aac275a5babe789fed2554f1bd77c2982dcf9296969a16aa3150671bf4c70aef8b191cf109b75e42ad7ceaa0fbc8f4f973ac0bba05643805097bb71fd269461e1c2183233ea91a465dc773f3845cde91ef0bcc64c0eea304ecf0219d89a63ef6808b4693d9547f1b766be881e03ef785a3d482bffe72620ffde6e65e69a118636718bb73b4a95d86dfc3abfcff061a5"),
                // expectedMacData
                new BitString("4b435f325f56434156536964a1b2c3d4e5d1e097b702bea99cbee10b9b8441182a18cd4f691d45032e0e3cb2422119873dde53542ae7445bf7f7c1d0dca5b4d306df0239f9ae8984d015607b30906ded914155008a5d76c2a062c49e3b32a6d957a809b22565940fdd338da347a3765fc62ed227536d86a253ad2fb374efea3b3d4aac275a5babe789fed2554f1bd77c2982dcf9296969a16aa3150671bf4c70aef8b191cf109b75e42ad7ceaa0fbc8f4f973ac0bba05643805097bb71fd269461e1c2183233ea91a465dc773f3845cde91ef0bcc64c0eea304ecf0219d89a63ef6808b4693d9547f1b766be881e03ef785a3d482bffe72620ffde6e65e69a118636718bb73b4a95d86dfc3abfcff061a5244cd19c5890ba65b2b1d8278129ed2b2f3ec92d5f6c49860e78ff1554e34a905ebc399c0d45d1e31b819cb54c9472cf686e69cdc4ea5c332d226df0fb877bcbb9969c9eaea9d541900ebff8f716ef1d17e4a6ea54c7536df86094f5d2672e17ef43649ecf3807caa191b47a8403c2dbf7f1e404e34d7da347ca381129c79ee9ede37880a63239d93a4d1d2d204985d3c806529bf822f628168cc7d0add3634ef62c40a20bb18c875e4940784cc304843cd6b605332a3809fca0fcb38e0d8411ac17b3f4f1d4687b59748a08bc6dc1f7dd81f07a647a8af3b6e328fbcbf8b64f4f9b227033e6a1a934f903e9860d379a8e6ceba714b4579b78a099d14bc24001")
            },
            new object[]
            {
                "test 11 - test 10 inverse",
                // thisKaRole
                KeyAgreementRole.ResponderPartyV,
                // thisKcRole
                KeyConfirmationRole.Provider,
                // thisKcType
                KeyConfirmationDirection.Bilateral,
                // thisId
                new BitString("434156536964"),
                // otherId
                new BitString("a1b2c3d4e5"),
                // thisPublicKey
                new BitString("d1e097b702bea99cbee10b9b8441182a18cd4f691d45032e0e3cb2422119873dde53542ae7445bf7f7c1d0dca5b4d306df0239f9ae8984d015607b30906ded914155008a5d76c2a062c49e3b32a6d957a809b22565940fdd338da347a3765fc62ed227536d86a253ad2fb374efea3b3d4aac275a5babe789fed2554f1bd77c2982dcf9296969a16aa3150671bf4c70aef8b191cf109b75e42ad7ceaa0fbc8f4f973ac0bba05643805097bb71fd269461e1c2183233ea91a465dc773f3845cde91ef0bcc64c0eea304ecf0219d89a63ef6808b4693d9547f1b766be881e03ef785a3d482bffe72620ffde6e65e69a118636718bb73b4a95d86dfc3abfcff061a5"), 
                // otherPublicKey
                new BitString("244cd19c5890ba65b2b1d8278129ed2b2f3ec92d5f6c49860e78ff1554e34a905ebc399c0d45d1e31b819cb54c9472cf686e69cdc4ea5c332d226df0fb877bcbb9969c9eaea9d541900ebff8f716ef1d17e4a6ea54c7536df86094f5d2672e17ef43649ecf3807caa191b47a8403c2dbf7f1e404e34d7da347ca381129c79ee9ede37880a63239d93a4d1d2d204985d3c806529bf822f628168cc7d0add3634ef62c40a20bb18c875e4940784cc304843cd6b605332a3809fca0fcb38e0d8411ac17b3f4f1d4687b59748a08bc6dc1f7dd81f07a647a8af3b6e328fbcbf8b64f4f9b227033e6a1a934f903e9860d379a8e6ceba714b4579b78a099d14bc24001"),
                // expectedMacData
                new BitString("4b435f325f56434156536964a1b2c3d4e5d1e097b702bea99cbee10b9b8441182a18cd4f691d45032e0e3cb2422119873dde53542ae7445bf7f7c1d0dca5b4d306df0239f9ae8984d015607b30906ded914155008a5d76c2a062c49e3b32a6d957a809b22565940fdd338da347a3765fc62ed227536d86a253ad2fb374efea3b3d4aac275a5babe789fed2554f1bd77c2982dcf9296969a16aa3150671bf4c70aef8b191cf109b75e42ad7ceaa0fbc8f4f973ac0bba05643805097bb71fd269461e1c2183233ea91a465dc773f3845cde91ef0bcc64c0eea304ecf0219d89a63ef6808b4693d9547f1b766be881e03ef785a3d482bffe72620ffde6e65e69a118636718bb73b4a95d86dfc3abfcff061a5244cd19c5890ba65b2b1d8278129ed2b2f3ec92d5f6c49860e78ff1554e34a905ebc399c0d45d1e31b819cb54c9472cf686e69cdc4ea5c332d226df0fb877bcbb9969c9eaea9d541900ebff8f716ef1d17e4a6ea54c7536df86094f5d2672e17ef43649ecf3807caa191b47a8403c2dbf7f1e404e34d7da347ca381129c79ee9ede37880a63239d93a4d1d2d204985d3c806529bf822f628168cc7d0add3634ef62c40a20bb18c875e4940784cc304843cd6b605332a3809fca0fcb38e0d8411ac17b3f4f1d4687b59748a08bc6dc1f7dd81f07a647a8af3b6e328fbcbf8b64f4f9b227033e6a1a934f903e9860d379a8e6ceba714b4579b78a099d14bc24001")
            },
            new object[]
            {
                "test 12 - responder, provider, bilateral",
                // thisKaRole
                KeyAgreementRole.ResponderPartyV,
                // thisKcRole
                KeyConfirmationRole.Provider,
                // thisKcType
                KeyConfirmationDirection.Bilateral,
                // thisId
                new BitString("a1b2c3d4e5"),
                // otherId
                new BitString("434156536964"),
                // thisPublicKey
                new BitString("38ab008bc747c92e12f856b61c30d40be183932c9b589b99c494008755f00a1855bfcff22c4226f16adfa07b52e63e30a071ea57d1b9b132c1b364a6a0e2b78ac933cd1df637eedb00bde754b34034a28311c03e745b05996f5eb33f8d618464dfe8c41ce6c6376b472ab8db69c594fc1f5a7ddc5506956dfce29dfcd2018cc5dde3c4c4d363b18d4fbd42ee11d7af0a5303a5de36f91cac7eacce8ff7f022b8513fd29f52d347f2732d685c556de5e7f2b1d9e6f7d451bbb5429e53b5669e08fea58bac6aa43949832e8b487a6e22f2d6b5b32c7d52728c9f74204e9febee0de3ccebcd46153a4d2d920154143a6c5a22919b72963b6882ecfe4bce256a39a1"), 
                // otherPublicKey
                new BitString("1584578b5cbd07de80c88044e1cfbd6e6a44c3fbe64a4a2268a0bff90ec818850895dd5d44b771545615354791f87e780aef3fbd8b7f9de3f4f44c4a8db6e29a2ea1ec28c8f2992d00457a44b9c2cee7ed5ae0d5b3058a4e6a1292beaa4876071c8276ac8ccbde9e980c53bd66f9e6d627b3efe7c7c485bcc3256fefcbacb0f47dc844c3b8feac305712c83de4808ae1c4e4935bf279f924de2a7986394274de4a6dacdd356e4e5fcface03b829e146d904613cf70213c418d55f0eba4291432d6fd1d16fc71a73f40bd45fc635a8ec069d80b3f3e795eb025974a6372734591a05cb368c7aa43a60a1b016cb5ef76ff2a0de7c604326969c397d341538c8093"),
                // expectedMacData
                new BitString("4b435f325f56a1b2c3d4e543415653696438ab008bc747c92e12f856b61c30d40be183932c9b589b99c494008755f00a1855bfcff22c4226f16adfa07b52e63e30a071ea57d1b9b132c1b364a6a0e2b78ac933cd1df637eedb00bde754b34034a28311c03e745b05996f5eb33f8d618464dfe8c41ce6c6376b472ab8db69c594fc1f5a7ddc5506956dfce29dfcd2018cc5dde3c4c4d363b18d4fbd42ee11d7af0a5303a5de36f91cac7eacce8ff7f022b8513fd29f52d347f2732d685c556de5e7f2b1d9e6f7d451bbb5429e53b5669e08fea58bac6aa43949832e8b487a6e22f2d6b5b32c7d52728c9f74204e9febee0de3ccebcd46153a4d2d920154143a6c5a22919b72963b6882ecfe4bce256a39a11584578b5cbd07de80c88044e1cfbd6e6a44c3fbe64a4a2268a0bff90ec818850895dd5d44b771545615354791f87e780aef3fbd8b7f9de3f4f44c4a8db6e29a2ea1ec28c8f2992d00457a44b9c2cee7ed5ae0d5b3058a4e6a1292beaa4876071c8276ac8ccbde9e980c53bd66f9e6d627b3efe7c7c485bcc3256fefcbacb0f47dc844c3b8feac305712c83de4808ae1c4e4935bf279f924de2a7986394274de4a6dacdd356e4e5fcface03b829e146d904613cf70213c418d55f0eba4291432d6fd1d16fc71a73f40bd45fc635a8ec069d80b3f3e795eb025974a6372734591a05cb368c7aa43a60a1b016cb5ef76ff2a0de7c604326969c397d341538c8093")
            },
            new object[]
            {
                "test 13 - test 12 inverse",
                // thisKaRole
                KeyAgreementRole.InitiatorPartyU,
                // thisKcRole
                KeyConfirmationRole.Recipient,
                // thisKcType
                KeyConfirmationDirection.Bilateral,
                // thisId
                new BitString("434156536964"),
                // otherId
                new BitString("a1b2c3d4e5"),
                // thisPublicKey
                new BitString("1584578b5cbd07de80c88044e1cfbd6e6a44c3fbe64a4a2268a0bff90ec818850895dd5d44b771545615354791f87e780aef3fbd8b7f9de3f4f44c4a8db6e29a2ea1ec28c8f2992d00457a44b9c2cee7ed5ae0d5b3058a4e6a1292beaa4876071c8276ac8ccbde9e980c53bd66f9e6d627b3efe7c7c485bcc3256fefcbacb0f47dc844c3b8feac305712c83de4808ae1c4e4935bf279f924de2a7986394274de4a6dacdd356e4e5fcface03b829e146d904613cf70213c418d55f0eba4291432d6fd1d16fc71a73f40bd45fc635a8ec069d80b3f3e795eb025974a6372734591a05cb368c7aa43a60a1b016cb5ef76ff2a0de7c604326969c397d341538c8093"), 
                // otherPublicKey
                new BitString("38ab008bc747c92e12f856b61c30d40be183932c9b589b99c494008755f00a1855bfcff22c4226f16adfa07b52e63e30a071ea57d1b9b132c1b364a6a0e2b78ac933cd1df637eedb00bde754b34034a28311c03e745b05996f5eb33f8d618464dfe8c41ce6c6376b472ab8db69c594fc1f5a7ddc5506956dfce29dfcd2018cc5dde3c4c4d363b18d4fbd42ee11d7af0a5303a5de36f91cac7eacce8ff7f022b8513fd29f52d347f2732d685c556de5e7f2b1d9e6f7d451bbb5429e53b5669e08fea58bac6aa43949832e8b487a6e22f2d6b5b32c7d52728c9f74204e9febee0de3ccebcd46153a4d2d920154143a6c5a22919b72963b6882ecfe4bce256a39a1"),
                // expectedMacData
                new BitString("4b435f325f56a1b2c3d4e543415653696438ab008bc747c92e12f856b61c30d40be183932c9b589b99c494008755f00a1855bfcff22c4226f16adfa07b52e63e30a071ea57d1b9b132c1b364a6a0e2b78ac933cd1df637eedb00bde754b34034a28311c03e745b05996f5eb33f8d618464dfe8c41ce6c6376b472ab8db69c594fc1f5a7ddc5506956dfce29dfcd2018cc5dde3c4c4d363b18d4fbd42ee11d7af0a5303a5de36f91cac7eacce8ff7f022b8513fd29f52d347f2732d685c556de5e7f2b1d9e6f7d451bbb5429e53b5669e08fea58bac6aa43949832e8b487a6e22f2d6b5b32c7d52728c9f74204e9febee0de3ccebcd46153a4d2d920154143a6c5a22919b72963b6882ecfe4bce256a39a11584578b5cbd07de80c88044e1cfbd6e6a44c3fbe64a4a2268a0bff90ec818850895dd5d44b771545615354791f87e780aef3fbd8b7f9de3f4f44c4a8db6e29a2ea1ec28c8f2992d00457a44b9c2cee7ed5ae0d5b3058a4e6a1292beaa4876071c8276ac8ccbde9e980c53bd66f9e6d627b3efe7c7c485bcc3256fefcbacb0f47dc844c3b8feac305712c83de4808ae1c4e4935bf279f924de2a7986394274de4a6dacdd356e4e5fcface03b829e146d904613cf70213c418d55f0eba4291432d6fd1d16fc71a73f40bd45fc635a8ec069d80b3f3e795eb025974a6372734591a05cb368c7aa43a60a1b016cb5ef76ff2a0de7c604326969c397d341538c8093")
            },
            new object[]
            {
                "test 14 - responder, recipient, bilateral",
                // thisKaRole
                KeyAgreementRole.ResponderPartyV,
                // thisKcRole
                KeyConfirmationRole.Recipient,
                // thisKcType
                KeyConfirmationDirection.Bilateral,
                // thisId
                new BitString("a1b2c3d4e5"),
                // otherId
                new BitString("434156536964"),
                // thisPublicKey
                new BitString("b823c58362a43c5020257b6fe86515c4c130a84dd0087985d5a82f23f361ad7f68eb4d3d12554fae5afb852d283ca870bb83254762baa474007e334daebeb3c5739494a5bc11230710273d40c9a78707724ab84dc5060e09933238617eaaa254eb908ffce836962be3926b4f1c5a5402b949c9f445942b225e2a6fab8c53cade20faeaa7acfd7f2f98d905ce90f6667c08c41f004f8d64c8efe54bdb2cad6f318373e2e1aff4a8ec1c8eef68f18824d814642cd4bee8c44cf63806ad6d2223d882369d949c080344d2965390471ae155a4e06a966bc3595659f21b98f99e5b495de59e9150afd06df88d4f522a0d90b01e71f3d4096bad305144c13def5a9791"), 
                // otherPublicKey
                new BitString("20beac7edd700671db7baceeb46e146faaeb93e5af8a38c44f11c17df4519e0811dad08aff9d314bf059e5fc9e913c6c7fce93023e88af1a4cc7bf7f04c734d2879df3594c0e83f3f1d085002f6f89a7c54200766458a53dad09c0c8e460884c8f6d86c50055405a4b52de09962a883c2f9b68096ad8df623f5b4f48de716f76a9bade2d6ce86484c56cca67d7cc1a83c34ad772ca1f8a54b201c992e07de812757172b1b69a9e64a64e2ae1829a75e6737831c95cf54f6e3dad04108f458c66a85b0fca3a77004297607b99dd7625bdbd55da6452647ab4cbc960185fd17e0e5f85dcd012c8eef831ffa31dae232150f404350858e2eaea060192dd652cb272"),
                // expectedMacData
                new BitString("4b435f325f55434156536964a1b2c3d4e520beac7edd700671db7baceeb46e146faaeb93e5af8a38c44f11c17df4519e0811dad08aff9d314bf059e5fc9e913c6c7fce93023e88af1a4cc7bf7f04c734d2879df3594c0e83f3f1d085002f6f89a7c54200766458a53dad09c0c8e460884c8f6d86c50055405a4b52de09962a883c2f9b68096ad8df623f5b4f48de716f76a9bade2d6ce86484c56cca67d7cc1a83c34ad772ca1f8a54b201c992e07de812757172b1b69a9e64a64e2ae1829a75e6737831c95cf54f6e3dad04108f458c66a85b0fca3a77004297607b99dd7625bdbd55da6452647ab4cbc960185fd17e0e5f85dcd012c8eef831ffa31dae232150f404350858e2eaea060192dd652cb272b823c58362a43c5020257b6fe86515c4c130a84dd0087985d5a82f23f361ad7f68eb4d3d12554fae5afb852d283ca870bb83254762baa474007e334daebeb3c5739494a5bc11230710273d40c9a78707724ab84dc5060e09933238617eaaa254eb908ffce836962be3926b4f1c5a5402b949c9f445942b225e2a6fab8c53cade20faeaa7acfd7f2f98d905ce90f6667c08c41f004f8d64c8efe54bdb2cad6f318373e2e1aff4a8ec1c8eef68f18824d814642cd4bee8c44cf63806ad6d2223d882369d949c080344d2965390471ae155a4e06a966bc3595659f21b98f99e5b495de59e9150afd06df88d4f522a0d90b01e71f3d4096bad305144c13def5a9791")
            },
            new object[]
            {
                "test 15 - test 14 inverse",
                // thisKaRole
                KeyAgreementRole.InitiatorPartyU,
                // thisKcRole
                KeyConfirmationRole.Provider,
                // thisKcType
                KeyConfirmationDirection.Bilateral,
                // thisId
                new BitString("434156536964"),
                // otherId
                new BitString("a1b2c3d4e5"),
                // thisPublicKey
                new BitString("20beac7edd700671db7baceeb46e146faaeb93e5af8a38c44f11c17df4519e0811dad08aff9d314bf059e5fc9e913c6c7fce93023e88af1a4cc7bf7f04c734d2879df3594c0e83f3f1d085002f6f89a7c54200766458a53dad09c0c8e460884c8f6d86c50055405a4b52de09962a883c2f9b68096ad8df623f5b4f48de716f76a9bade2d6ce86484c56cca67d7cc1a83c34ad772ca1f8a54b201c992e07de812757172b1b69a9e64a64e2ae1829a75e6737831c95cf54f6e3dad04108f458c66a85b0fca3a77004297607b99dd7625bdbd55da6452647ab4cbc960185fd17e0e5f85dcd012c8eef831ffa31dae232150f404350858e2eaea060192dd652cb272"), 
                // otherPublicKey
                new BitString("b823c58362a43c5020257b6fe86515c4c130a84dd0087985d5a82f23f361ad7f68eb4d3d12554fae5afb852d283ca870bb83254762baa474007e334daebeb3c5739494a5bc11230710273d40c9a78707724ab84dc5060e09933238617eaaa254eb908ffce836962be3926b4f1c5a5402b949c9f445942b225e2a6fab8c53cade20faeaa7acfd7f2f98d905ce90f6667c08c41f004f8d64c8efe54bdb2cad6f318373e2e1aff4a8ec1c8eef68f18824d814642cd4bee8c44cf63806ad6d2223d882369d949c080344d2965390471ae155a4e06a966bc3595659f21b98f99e5b495de59e9150afd06df88d4f522a0d90b01e71f3d4096bad305144c13def5a9791"),
                // expectedMacData
                new BitString("4b435f325f55434156536964a1b2c3d4e520beac7edd700671db7baceeb46e146faaeb93e5af8a38c44f11c17df4519e0811dad08aff9d314bf059e5fc9e913c6c7fce93023e88af1a4cc7bf7f04c734d2879df3594c0e83f3f1d085002f6f89a7c54200766458a53dad09c0c8e460884c8f6d86c50055405a4b52de09962a883c2f9b68096ad8df623f5b4f48de716f76a9bade2d6ce86484c56cca67d7cc1a83c34ad772ca1f8a54b201c992e07de812757172b1b69a9e64a64e2ae1829a75e6737831c95cf54f6e3dad04108f458c66a85b0fca3a77004297607b99dd7625bdbd55da6452647ab4cbc960185fd17e0e5f85dcd012c8eef831ffa31dae232150f404350858e2eaea060192dd652cb272b823c58362a43c5020257b6fe86515c4c130a84dd0087985d5a82f23f361ad7f68eb4d3d12554fae5afb852d283ca870bb83254762baa474007e334daebeb3c5739494a5bc11230710273d40c9a78707724ab84dc5060e09933238617eaaa254eb908ffce836962be3926b4f1c5a5402b949c9f445942b225e2a6fab8c53cade20faeaa7acfd7f2f98d905ce90f6667c08c41f004f8d64c8efe54bdb2cad6f318373e2e1aff4a8ec1c8eef68f18824d814642cd4bee8c44cf63806ad6d2223d882369d949c080344d2965390471ae155a4e06a966bc3595659f21b98f99e5b495de59e9150afd06df88d4f522a0d90b01e71f3d4096bad305144c13def5a9791")
            },
            new object[]
            {
                "test 16 - initiator, provider, unilateral, nonce instead of public key",
                // thisKaRole
                KeyAgreementRole.InitiatorPartyU,
                // thisKcRole
                KeyConfirmationRole.Provider,
                // thisKcType
                KeyConfirmationDirection.Unilateral,
                // thisId
                new BitString("a1b2c3d4e5"),
                // otherId
                new BitString("434156536964"),
                // thisPublicKey
                new BitString("7e4710fc503b32d44b01f973d281"), 
                // otherPublicKey
                new BitString("c793b6630a3ca51e850abc952d2f37a7b3a6f63eacc4c982ee10ea4d3d54cbdf27f412d42c7fe25322845d87d8a76753faf3ac413472e4bc9afb5680484c9a4e4559a4e4aee3fe2c104b55b415a9375e63191b59c155a24f7b891ce008624e50eb68737cd78f80131608ac022c5d3030b7bd4b6c99958aa459604657c7bf6e4cdfcc8785f0abf06ffe636b5b64ecd931bd8a456305592421fc28dbcccb8a82acea2be8e54161d7a78e0399a6067ebaca3f2510274dc9f92f2c8ae4265eec13d7d42e9f8612d7bc258f913ecb5a3a5c610339b49fb90e9037b02d684fc60da835657cb24eab352750c8b463b1a8494660d36c3ab29150719f51bb6f2e4b14c92e"),
                // expectedMacData
                new BitString("4b435f315f55a1b2c3d4e54341565369647e4710fc503b32d44b01f973d281c793b6630a3ca51e850abc952d2f37a7b3a6f63eacc4c982ee10ea4d3d54cbdf27f412d42c7fe25322845d87d8a76753faf3ac413472e4bc9afb5680484c9a4e4559a4e4aee3fe2c104b55b415a9375e63191b59c155a24f7b891ce008624e50eb68737cd78f80131608ac022c5d3030b7bd4b6c99958aa459604657c7bf6e4cdfcc8785f0abf06ffe636b5b64ecd931bd8a456305592421fc28dbcccb8a82acea2be8e54161d7a78e0399a6067ebaca3f2510274dc9f92f2c8ae4265eec13d7d42e9f8612d7bc258f913ecb5a3a5c610339b49fb90e9037b02d684fc60da835657cb24eab352750c8b463b1a8494660d36c3ab29150719f51bb6f2e4b14c92e")
            }
        };

        [Test]
        [TestCaseSource(nameof(_macTestData))]
        public void ShouldReturnCorrectMac(
            string label,
            KeyAgreementRole thisKaRole,
            KeyConfirmationRole thisKcRole,
            KeyConfirmationDirection thisKcType,
            BitString thisId,
            BitString otherId,
            BitString thisPublicKey,
            BitString otherPublicKey,
            BitString expectedMacData)
        {
            var p = new KeyConfirmationParameters(
                thisKaRole,
                thisKcRole,
                thisKcType,
                KeyAgreementMacType.CmacAes,
                0,
                0,
                thisId,
                otherId,
                thisPublicKey,
                otherPublicKey,
                new BitString(0)
            );

            _subject = new FakeKeyConfirmationBase(new KeyConfirmationMacDataCreator(), p);
            var result = _subject.GetMacData();

            Assert.That(result.ToHex(), Is.EqualTo(expectedMacData.ToHex()));
        }
    }
}
