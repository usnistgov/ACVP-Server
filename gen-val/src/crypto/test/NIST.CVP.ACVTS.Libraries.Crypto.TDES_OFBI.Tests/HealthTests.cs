using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using NIST.CVP.ACVTS.Libraries.Crypto.Common;
using NIST.CVP.ACVTS.Libraries.Crypto.Common.Symmetric.BlockModes;
using NIST.CVP.ACVTS.Libraries.Crypto.Common.Symmetric.Enums;
using NIST.CVP.ACVTS.Libraries.Crypto.Symmetric.BlockModes;
using NIST.CVP.ACVTS.Libraries.Crypto.Symmetric.Engines;
using NIST.CVP.ACVTS.Libraries.Math;
using NUnit.Framework;

namespace NIST.CVP.ACVTS.Libraries.Crypto.TDES_OFBI.Tests
{
    public class HealthTests
    {
        private readonly OfbiBlockCipher _subject = new OfbiBlockCipher(new TdesEngine());

        [Test]
        [TestCase("c1f758d564dc736719f716f83d9d231a8a8fc2ce6e371543", " 9ea6d79abfb88138", "f3fc2cf0150dd68d", "495182456a632be2", "02ad098e222e1ec6534afadf460074e228d4caa7c86ae500", "01ddf0977d34b46b0c396e5b4f07577fc1e75ab024bb8cf6")]
        [TestCase("fdcd7cc4d5137a8ce5f1ce9bb9d352d34967161a3df84fe3", " bfaf067cd8f8af38", "15045bd22e4e048d", "6a59b12783a359e2", "e3c56bc44bac96e34eca0d4beda68dd76814e624bdaba3a06b79ede37bf6ad43c137f1a26064918b8c6c127e94f7ca87", "77967a6b19e48f0346090d769e829714783d8c27121137da664544a533fad42b8de944f1db841a427b8b7ff3026c94d4")]
        [TestCase("cb38f175ce43cb3e7f806d7ace8f8f831c10c89b20c2b30e", " b771165eccdb18d6", "0cc66bb422306e2b", "621bc1097785c380", "fd9f18fb1d48405ab59b39e20a1790b938bc5a6c2329cb36af02048034942da42cbcc4f62f0434052210aa1eab392412e777cb39608482b7393ebffeac4e9995b70723171190f97e", "0ead6b36125ce9538d41b36473498544f44f0cd94d8a7d74f8fa1694bf3af760c9602054f2b8d3d1c203386c95fb686ea5234b0ea199b8f1683f381ddac4e28c012a4cf321ae7724")]
        [TestCase("98a7671916199831e50ebf16fde319b3a2d69732f84ffec7", " 14c45c4666a286c3", "6a19b19bbbf7dc18", "bf6f06f1114d316d", "803acf7540d98f9ae10329c6b0e2ec9d0d62e5871443a4617c6d4372be83a5a07abafce317ec8efbabe8b85e1a0d337581179607d5381cf6c76ba829eb0506c91a8c74b015cd611e6a2974ae9c30d0897e7197dae08fac826d98be0cd49382e3", "fbac5943ab7fecdb7cc5be5f4e92eb8c3644c8e44608610a2b22fd92d9a674d4347bc1aaa9fb6e33ab7446965c4ecee79d2c41650c029da72663de419b84cac28bf83608abd164b6a0b880c339f1e20deb195de0238bd2e99d7338175815e69b")]
        [TestCase("836146fdd3d5f13461d98f40262af15e70233110fb94ece5", " cd2c2b8a45c1b93a", "228180df9b170e8f", "77d6d634f06c63e4", "be554ca9793f7d86cdbfc87f959403e0771c21a416bd03f3898390e90d0a0899f69f9552eca22421532e72960bfd6acb5a85aea326677450680a9318dd83dd58ffb9b0c933c6c80244a0573e10f8586081622034bfb736f8a4b7641b71f30e44bfebc396b8731233865b9ffe0c4e76a6d4fb9ee04973f2f3", "a94e50441884ed49a970ab1e1be3d5ac932240d5cb44df515ea4885e86eb9447e81131069fdcf920bfd994c2966cbb08925f936aed6ad7482687367895c4ef1a510feaa0a666380bc34c88cf88b1864c3db597be12266d07c4f7dfb2133ae4972e10a4622e353a5862f17189ee6c2dcae499138ab13ec7df")]
        [TestCase("8073a89df867fe3d8fece63738460d62518031528c76a449", " 686b9e82d29cfdcc", "bdc0f3d827f25321", "1316492d7d47a876", "bc6118748caf2f635d9d863b7a95ed5e4cb21f6a862896be9fe0a33a8562bd4590f81a15b4107c2bfce34e1c3354ef97e41b4ea48622b72af02fecb413c47874e7444089a6565b7d398e2312ef4b8c3e75dbb57403e6bd25d309d887d7c1a295ab8bb357c9497363fce82fa417406d5ae63b7d62653a51b830b48f3a3b20e3aec3169a0784b16de42d379a5a11fc3af3", "690e73a8d5e139311e6bdfdfe8c8d04eaaaa5da4f7fd7e57c63dfa556bc96c7ca8fc1ca5dca8c96c71ae7f99505cdf0bc1a1fd769446a920b8db0602efd1c7ba7dca54ac92b0c9e415240ecdf0aee280e4c2c045122d8d7faad593a90417b9599ba0b6fbd18f1ba6b32d8743378585eb7b0de8f0480c2c355d2a9c4c5ab88d4c17e250dabb18bba19233af83ade20fcd")]
        [TestCase("6e623461ef38efc76b8c348076f7852098326443f4ea1fb9", " 360477fb849787af", "8b59cd50d9ecdd04", "e0af22a62f423259", "5faf248b321593964587852b830c7231504fe947d6a385f399441cfc52df3914fa55cdba25bd215f91a80fc8ffa872b34113dbbd9504868331a38c081fa659574b186169db590f48be67fe75885b6c877d37ec16ebde5ad7be6414084e88670f7b7f485efcf44599f44cbbfbc62e48f62b438319823aeb3767101ec6868e4c85b113ea623193ab9a5ae0ac226328ee4674bf0a90ff1f20eb542e110870bfee01165ab03c22402993", "8a867f65243c755f11d81c0bdfd7f990e14ec390e8956a9401934d4e313ef9374adbe9e818b60fa65dd1186db8a4e6498fcfb5d949705153fe56a34f6d15d94b63586a519f6f58519805d6e21c8b4314df3570478e982d02ea4074d453f23d52e16c31894eb1f1e5c7b951669815d2563b4e507d823545ebe413e954bbeecaf4cdf43b7cddf0ab96f26816ca2d8f472ac6f8b6a34ed847db96182ea35d4518277c45fda4a8deb6b9")]
        [TestCase("bf1f1523980b2c803d512619dfec0d7c683467fdf168adc7", " 4dede90b52ac7f0d", "a3433e60a801d462", "f89893b5fd5729b7", "24601f39d962f853dca781f4892b961252a8d76461af64167ef8e5c134f7ce9a2fafe1eae9cbf4be86ebf4dffc3c2a04764bbd47fb1b78d64a75ceeb097f1bfe1f902d395f43032c66cad4c2c685547364d332bc1e29e5ccb161a881da54c392bcaa0d0e82f1af0545ed2a84302f9cc7e2e93fab130132627b647c6aef9d4ec0cea688519bfe7fb1ebfbfd0f82628a69b935eafc23cce7ff6f275190908342ef1c2ba6eaf291fb98209d564a0445a7bfb15e3d9793b28d0a57522fda052e2986", "c7a842d39117c0ad8fb7c4d98785e0ddf471d01daa7c6c49595179d77875aa468fe116b2a40b82ad6a562cadeacf53078c1bea4411d7572055d57fda14659dab058517f52b1abb955b82735c39abe4c94aff39acea66bf452c0cc1d95f12b10b33458ba95342e4c72b69f89ca38abb6db5a9bc99bd9b10e20e7a5d1532b3b601d6c21378efa62f949f32939ff234755b9d6f43fc43b7adb68ddf24a646de33cd71771baa7fb13fba22de14e983dfaf87e95d5d7275ec70ef7d87c33320f3b734")]
        [TestCase("01f88f010220d92aa8dfe0542ff2e0daa2d9914c97b31f8f", " 0fffc5e69be2cbff", "65551b3bf1382154", "baaa7091468d76a9", "4ab256c2a2096e682c36c6fdd83500ea76697d628229cffd417b6da30d1fabacecd0e94568c60a169b7f28228abf85eeb4d6c5e5ea215bfb60d3429105f5ed9810ac80fadbbb4035f548484973e37fd586c4c67d5354768efef009e508e9170ddccf85a7a4eff90f611a903c3ba8d4e815bde8f165cb060043582c68c002115178c05e156b6a1bea087c67c28b176d6f8948930bc98df497569511e2d248c3ac0d07750cd7358f0f12f635a20b3632b20aee2f9127a2299c602f221be9c31668c32d305490573ec6a61063a5620f0bf8be35244c26138c56", "adafa76d130ae8f67239e511c54a06c23617e2fa9c3eb324e97fc483edc2fa8c1978a8b0cbb6ff9f625581118e2f5bd4b433b58cb5e538b39f100c83413ecbe90d9a66f457364086af3303a24e96aecd92352e7213d29a0fc41db2a5e9473b9f51c2995fade8c9861e8c1c56a83a06f905123301d58b8cdc78d5075c836f570473cae56f3e7b8bb7506603188c56b0090a2d43b9f162592dad194196da18dcbeafdc29989a1d00c11efa6c4c2007c579704aee70fb43bded0258f105814200e96ddc928347f7988e4fefe0e168c0599868bf27b49b857d43")]
        [TestCase("8a4f044af275ad406b9ba8cde9b0f775438c6eb58ac1e368", " d1f2c3e436d3329e", "274819398c2887f3", "7c9d6e8ee17ddd48", "5ada1dbaa3dcc6f97dc5e0683ab3e52abd0f6a14db63a119076b23052f6eec6fe1cea7e8b2df2d79e0f5484d36c1bcaa30dd882660a569171049a04b2920f5f9543ffcf85e4b972fe18bbc4d214178ba343b34cd66a5383fdb216ddf761a6788fa54a2506fc80c03c8b0c4d0c2de22410f51f771b40a1679b01c132bde034a031c36235aad0095dddc8be93ee23ec1290a48587a137d0badd66219952983a751020d077de09839a56645b2ff49095d596d48e0504ba620c3961a07871e44855cf400d420cf3b0143ae05a87bbfe8ffb98078155b242c5ca3386c666886ebec0b3a3714ad438ff39ffcf4511a0c82ad31", "cf875b3211c9bc5ef8991b22a19a85267dbd751ef957dc9e37c69b61fe74b5689df4f88579ceb8d67e0c688571f3e3dd525f68562c3075e52c737de2c9b187aae76fa575f6e93f9c1323e88070ac389f1e1ecce64b76227fc3b6c1daa207293c30140a76014f869dbbaf659f075fe2e3ddda3525357b55ab111563bfbb65f95ecb20e7f5e362c8400b3407e1db1b430d15fa579ed120a5a08de8b9c333659b324b9288961c254da8756efe5bb357dfff72fb34545e09481584e7c2f921a2be337f9f98af8f2e6a96f9c47680fb0af6115befc063452bb97b658487c356cdd986f834297f7f3d6dc596813754637aa7c3")]
        public void ShouldEncryptSuccessfully(string _key, string _iv1, string _iv2, string _iv3, string _pt, string _ct)
        {
            var key = new BitString(_key);
            var iv1 = new BitString(_iv1);
            var iv2 = new BitString(_iv2);
            var iv3 = new BitString(_iv3);
            var plainText = new BitString(_pt);
            var cipherText = new BitString(_ct);

            var p = new ModeBlockCipherParameters(
                BlockCipherDirections.Encrypt,
                iv1,
                key,
                plainText
            );
            var result = _subject.ProcessPayload(p);

            Assert.That(result.Result.ToHex(), Is.EqualTo(cipherText.ToHex()));
        }

        [Test]
        [TestCase("972fc2a8f83d407ac15de079b0b5985216e5f4450bfd0d19", " 5d0b1d45a9137fef", "b260729afe68d544", "07b5c7f053be2a99", "9c9d03981529c9db94225cfa11db420a3d22225ceabddc3b", "6628319796f4f41be4b9d91152c113b1c7a2edea07655ea6")]
        [TestCase("fd3108545e34c21085a2b3e60e7cf8e516134a4fb3ea0797", " 8a4e0a2b7b634d19", "dfa35f80d0b8a26e", "34f8b4d6260df7c3", "5fc3ce013c4aa2e84b2de3e636a123b87d99e3154be5ed3640877753abbbed72eb33a7e5d9c543dfa1cf5e3616834ffe", "d85b628a8a94010938450114305141635bcc1c311475e0e43a8182f0849b90f91528663851cfa51fee39e1404e159a6b")]
        [TestCase("40460e9beffedf86c43b7a0ec40701fe5b1cce7c0dc1ec49", " 120cfb4bf45785aa", "676250a149acdaff", "bcb7a5f69f023054", "0b7cbea78ce43fa2b6009b1d7ddaa4d872068165bc7d8586fb6ea954eb6936171b29988eea9781cc6830b87389017f56b4197d27f4107b89cc1c200d98f63010bf60abf7fd3ed3ff", "9178e567f3c6d4497dd5e4a505ae44ffc929c2fbb218342adac216244b9374d70a110b1e5412ab96272cdfad046ed0fbf44d67d6c9e1b220a6528964c18d7121683bc06642f3029f")]
        [TestCase("1602e3c82aba1557527f45fed99d0892e0b34ffd5457a479", " 7ee302f0ba4bb840", "d43858460fa10d95", "298dad9b64f662ea", "7aff8d0d4e2dff8c353727de75b8ce0c2040b967b23e7e9905a2b809dac07cec01c5eb3e509e783f75b66eec312e14d6fe6468778287205b729260279e4d0479bffa1037e4fe9e45dec91372026b983b68bd535d2d62de7fe70c32d9b78b024a", "c4840c478d833c750f20420a920c5c66cdb8889563c5306cadbc0cd5baff456794ffd63ac5b038f91a3a3e38a7f23e080b8871c9f6819c40e8e8f0ea3b412f8f63bf111975b7e6a7e6537cde958b437f0c51af3f030cded326487b4a19ace29f")]
        [TestCase("027cb970b98a49df8c2af758cdd013169867a2a85e0d0e97", " 13375f21617d419b", "688cb476b6d296f0", "bde209cc0c27ec45", "999e564ad8634bafafd1b92722fecc7bdb02ba255e59c727ff5c25d30fe420cb7a5e0df5fed6b019c898543438a488b46479bfe06c99b4d6e2cf37a21a5158f6ebb21a6cc2fb6e98279e499263901547194f5252d56e158c46c60e79fa1383b9e7cad1464d0a07bdbf1c3da5d5948a1ec7050160a86a0af6", "cd3e930af243681c44f0b28a58dbc0341e7e33075cdc10c75b68140be12248895e03d5936a9b18e26ff9f993a3cb796f3ac68b6fd948257f4d3c96837d3f1a989d00ac9ca5ed1bf0020c607c8b262ff4b62bcc5a0cd220c5da800c602a6bfdb5f1ffc12c8a8199ce63f28f4ff736094cfc759fd1ddc22a1e")]
        [TestCase("700d230eefc87c8cb0f4151f2c347ac2cd9d3b2a2a26f725", " 7dde605a984c1a61", "d333b5afeda16fb6", "28890b0542f6c50b", "fa3ee6e2a2a9fcc33cffb62a877fb11cbd280dc2b1e8e2886f89b8c8cfe88bde9ddec9e58afb53fd260ed7ad453a736f341dd657b62bb3b57dcddcb1e28d53b8c8e156664ca980e309a1dfd96fb04b651cc8dcd344aa6a259cb2298d47cbe2309c30798244d0154b0ca3897cfdcc6b196f343b45b8e5505d5abcd67057c3d1b1ece655269ca53913da323da738043381", "e7df1c672ed326d86ca359986456ae8afb8e54f5ec68ff86bca48299f106a0b47ffb1f5483801fed3340aa2c15fc8c7f703065d701f4fcadee20d64300b3082c0c76490eb2dc4ba74a2d4c0e1ce3e83bcf5531ca259201fce5908fff1886416f7796c11c25af530e9ab266c6dfd368c70143df55c00cb67d873cd455a145f485a9a4b00642c1de2a091620ddc894b72a")]
        [TestCase("b3a798978a8ce5f4e0264aec13e63db9624ffbcd4aaed5a2", " 9e8208948b07e114", "f3d75de9e05d3669", "492cb33f35b28bbe", "d2db5c6ed8a8abe84d8f94b9174c3e2abd1184e5d067b66babc8c6cccc982f9db53a5b3c1c8e22ee68bcc2da5946cc4181e93929463100173e42ff585c5c2f0c39d38b4fe112eb085e38d6002f34d15236b9fc320b0a3eef49968f9ca7d98c970aff43760f157dbbade1490923b951f9e96200136c43ce2b2652d1089a00830d18a52d25a5b171236dc675713a206be953843cd106196ae9f2bb11df6b4029266e4b39ee28c13635", "3107faaf16bedb373b50612ff2978ee753156993d7383bab22dcfe911f121375522033766ac9a80916cebd9f1ab47382a2c87500d6614eccae65daa1080efa28f8ee8c1c5f319bacbf23d2214df237c048b416f28aab3aa25dc863e78f6ff5e3c97aeeeb1c801ae7dd578afcb3d74269eee132af1aa068f5d40f83aaddbc6b6c6dcb3f29ca3d8f841873cc7a73edfc453b58b280afc83e8dbe422134197dc48c8de9691f90f16149")]
        [TestCase("ba4c028c1f49dcd3bab0911aa768265758627568fe13cd68", " 26149bc5fa703eee", "7b69f11b4fc59443", "d0bf4670a51ae998", "859639b6b83888348aa85694c9a4bf124a75c4b36f5f12ea9dd49f5d8b580c63a062261e77b1b862000c1472d5a4b750a8464a70192f042e1320c3e953bbacad5d66fa1a0655298cdf52d3cfab1992563ddeb4cf91636b8db191d57527dfa8671eaaa4a852465554ceba5893366be0d67c557bce8b6cac29ad7de753254f876dc760274119f3baf47c39e1d930c869b5d8b1ba35344ac537ff5024f7348ed3d38d0cb44e8161bcadaf13fd5381963716ccabe860ccdfc10454a6cb7830878f17", "b0275971d39f8e3985ac43cafef297987b12bed5eb86547febccf09df4c6fdc6d361c5e25a75cf3556ec6b99c1278b0a389dd468afc5f5796337382e100e562764909078b411fbaeef141c0dd0b4b41c5742dd6479305674172d1c282d923a2b4cfde1bb4a3bbbac386c7db09461bcd5c049014fb38d1f78eff8c415b21b4fdb71f0e13282bdb738193bb70975f8483e5bfa67b3c4a5f88ed3df597c09713d3ebcb0b865c55e96597acbf1a0dc3f035d119c3817144087bcab2903e6995cad5c")]
        [TestCase("9ea7d69bbfb9803802ad088f232f1fc719a8dc3d15d6262c", " 0d683eb848d4ed1c", "62bd940d9e2a4271", "b812e962f37f97c6", "97cac509c11af3a39a34510a665cc5be4357d62faac57f3be959ef71a55dc8c8cd49521b1f7d4f52814a110ae62300950910a6aecfd1d14b57f195ba8d44119e1a87d3886879dfbbad44d2d7b920724fc60ba0c94d5039de4f814ed56927fd7f3149f7915b1113c231ee42cd3eb7470b040fbbe4d64325f4eead9ec3f5f48e96e51756fbfc5c0926b588ec9b9883bf8f4f4cd5c3d77c37131fa0c3e97aa5046399e18795fe56c68b442445d7bb85ea0dbd628172771153d2644c177823e5a172d19be1df161d72159bfc08f7b68f398c1499405c2e4cc013", "a01b87d6a1cc9d5fe2af3cec42bbd045372118400f7f87927b57ebe44dc14c2a815c17307a8a7c758fdd143dc6ccc7e2dfabed6b95dab35f203cc0dcfeea19e3f32942f64f9aa7e56fb13ae586685ce29e350116d9390fdbfdba08bd2fd3e9d4ff6a5251a563e6568a13f50b0bf859ee79a79d6a640565ac19ba09b269e384a4ac078d68064d0371e9ec8ed7dbe284ad7ae9098fbda77b7a7c250de03382b1fc03e93c64f9c0c4dd93224d728090a5c8a8e38dac6c8519ee2fe15a7215183a840af6a66c0724f342909f7a04826886e60b7e71e9fa0909af")]
        [TestCase("25c2b5aec41f2310e5d5d9371025abbce3376da42034921a", " f0aa0baf1ac243c1", "45ff610470179916", "9b54b659c56cee6b", "ca5bd8ccb8028239c1eac076457995db1a92edc3156375c4cc4a6a3fe0ad9607f4ac69bb0a52fa00ec3488edb08129d7087ef36610556017082c9c6f731558cf7925af8854b0d9d09c5cde0effdf34d9e18b68c39995d47b02f2390fa1fc3327c55eb53061ed6bbbd11bd95da27691caea31f095923539ef1537460ebb8eef8eaec6ce12605c5e337f7f42755678defc7e6c607d5c19a311559a3a0af4a0a61fc53780f3ec9727b41718f9b3da10a5fd25537a1922c2fe0aa449a9477dc5f714aee4dd5b4e2ea3bee59e07b47cc4b53b1ab867832b6ae85ea38a0530ee53f4a411956a095c9f84b4c28cc621c590336c", "6fa000b608e15999cb92991fa6f6c9bc8f40205622a6ccf88cb8efcaa7f0e741668ad2937495516e184b8de95c9e78bb6e1356aa46d37b47890056d9ae45ae975fb12c1a22c51a1138cb6a37c56afa823278169dd00f3f99bee32ae00cd20c6a20bd153359973aecf3bb38f02b83d67ba3166a1607819e56f10a74c60ac08822735796c663333b6511c300fed410940c889659fe355222e6eb1c3c75f037ab271e27b5bb86c2a5e6598ac948093abd9fab9feb3ba0a953b274c288d4065efbe1e9d47cfa0b6cfed694b99bb61129d89bd2da29b690afb82054a462cb935e02b99e07f36b3a58d09d8af77e3036046d68")]
        public void ShouldDecryptSuccessfully(string _key, string _iv1, string _iv2, string _iv3, string _pt, string _ct)
        {
            var key = new BitString(_key);
            var iv1 = new BitString(_iv1);
            var iv2 = new BitString(_iv2);
            var iv3 = new BitString(_iv3);
            var plainText = new BitString(_pt);
            var cipherText = new BitString(_ct);

            var p = new ModeBlockCipherParameters(
                BlockCipherDirections.Decrypt,
                iv1,
                key,
                cipherText
            );
            var result = _subject.ProcessPayload(p);

            Assert.That(result.Result.ToHex(), Is.EqualTo(plainText.ToHex()));
        }
    }
}
