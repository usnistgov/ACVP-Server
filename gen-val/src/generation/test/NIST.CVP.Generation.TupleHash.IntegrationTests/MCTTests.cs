using NIST.CVP.Crypto.Common.Hash.TupleHash;
using NIST.CVP.Crypto.TupleHash;
using NIST.CVP.Math;
using NIST.CVP.Math.Domain;
using NIST.CVP.Tests.Core.TestCategoryAttributes;
using NUnit.Framework;
using System;
using System.Collections.Generic;

namespace NIST.CVP.Generation.TupleHash.IntegrationTests
{
    [TestFixture, LongRunningIntegrationTest]
    public class MCTTests
    {
        [Test]
        [TestCase(128, "6dc13301be877363018fbbbddd779b7d8a33acb91ac0a42bb1653fdd3b43ce7e8aa259f3", "9ef0649e6e3ceed0dc666694f79efe24b213312339bde18486d8649f04e1b6534976d0beac96affe913716611830f5ae43823014406c9a23f542ae477c9917473bc13c4f5d169cba70b094531b5432bf5e97ebf511db3f0c600b9fc2e9c9d150588db5205d4ac768c5fc3cd6a67f6350f49e736ce92203c05728f5b01f131d657d750a46846fe4a6fae0ce37f8d64f23a38d27245847fbd95f2d75fe8cbea0d8aef45914a1ada15102f1c74cb8573d4c190340ae893ddcf0b61c7bfc0b4b515ab32fa68c3a72bb41479b6f5155bd54f591fd11e3f5589430a202ec15f4c85c6ed7e70da7fcced93f20e2d4dd7eebb38a80ad08de74afdc8aa3d8b6d235989aab04d4404c1f8f7ec3ff80f2f897a2a2996910a5b5321ff7881a9e2647e6c923f29f57e7f7cbe301604cc90ec07c1428593752f6b5777fa7782ed146dde831f95db83072a544fe5306ebbdc80d57d737c7e62b7a80a23e479dcac7f576e153e999a817f66ab39d3b69675ab4e8e307a158d5b2a6c9b9b1572f68b9632c9c2f95d665e3dd221bd174afb5a39aaec7fdc1433d6221da93af04c9b1fd8c06c557091bcfce76412713d04bbbbbd9e22be37f79eb65e935c0513f4ad166fe79ba513da6a5149d8c64230d74016c2223e2f4f31aba19e7481207457d4278a3b06b0b5d1f884613f359c18fe4280e1d403b21bd223930aaefd620c1b31c4913f3f73ec217fceb76a6033cade14668ca34dcd57969511e23ba093399cd8f3fe024cdc1c057fabd8221b674b7a47ca7715260ea0773c4b7305d728d84a00c26cd0158e80a9ad1404cec821f5afde96140dbc9a2642334653c333f6cacc5567cb50a45e0511b5ac4df9573f9983ec1a619b9d6215e5dc6b4deaf4d85e6fe3750be1ee05b0daf52592817ef80bf64f329d309d5b338a360993686c439ba9bd7c0de88e2bf551615655f22945724245a28a43ef10f1876bb513aec71ee1f3731992621ee47b2603f0ad6af27811478f0dd314c230c42057279970b7fc7d42140c14beac7b3c232c15fb9abe7470cc0a836271e79781dd0acce4cbe94b6e1442c290aa6ba49ae6d1ffe41e7181bca727db8c67c08dc2454f4cd5494274b2b719fac0eb3608cec78e2464e22dc4c7b7ea23ff6b2f8df6139df2ff6d99f83c3228dc34b548d66dbe70ce917c70b47f585b3ea481e72bdbdd6a87b95492d3ad45aacb5be1ba36af595dd9a5d31862d75844c5e950b471bdc831cc7b8fa5162661aafd7178591aa4bcab4d858465ca1a5da42dda63756affa394b1bfb0a933e187fbe5ea73da7c1df0fc9c443772cf30d4af6db96f4ca5103e6eb1cffc43371dc4a0aa4c9eabce6a5144619ee702bf63033c628c6cc3dd1b636125aef670bdcccdb184a82565dd33ec02bd8153edf1f3f61561e091e4af552754778a95e3be983b914800eca34d132e3880d1d4415cfa2ed14ba2133c5ef4944aa732cf4658bde991b5662f87f5c1ec62e408b526a36bf0bf48c317cf30cedd7e2be4286baf583dbc7f041917ec1abc345a6b0ebaed940509da7cd8b72be6a5152b890e074950cc1544952dfebb18afd9ea7c8800da03d6e0218662a71f383e4a89a90a664fb9044fda46ad8441fa3b5e25c8c42c5774cd08606ed94155a1f3b0646025f5380c833f0c25f906456a8fd4758831d1e6df184764ba8f259d0e91285173e68dfe23ee50adf9a160cd91158cd05cc4e8468f1b4ad2efb2a02ec1b7aa1e1f90304f3b78b75c0d3eecf4e8d7ad385a315495e286aaba7e5258be3837eff54066bf1cd81a1bb45df2f80ec70dc80fd35d207297f27ecb62ddda237c9e3f4135697010d32aa700008abdd233d21bcad4abc8c2dbda5ed7501588438cf7ee6cb2bdd6030a07839368329bb7c70757146ff8b4c3829ac4f9fc6d62f99133a94eb17b0176312bf9b9cc8bd32083d4e453985bf3d540f6c144bbefa3dcc18181f25f8468ea519b2b7181659b2d65ee2f0a93415e5cf4fbed916de94bef5a8fa25727de0964a4bef7f50fdfb42cf9520f45ea525cf3cf5b0aefd24938e96ce777c82b3cc7e1b716d798c5aea0ce1be6016cba3316ff8d73a4c08915524f5cc4ad0e9764f6348e98a6adfb1a2f09a3235e2fad3d9b004f3e1cbc48faa9824b0c4ce30dc481304582b02a1931ec90c4fc6dd314f75cbc7f769f0227b787d1a074268750807f5fcf6650d42c459cddcc62222047fcf120a23bcc66eb7772ce21b2e6e9e6c5aa9e8e0df329707b3751c27390b89c0e490dac99e83bf7561ffa800544c144f10b5df9a17c0dbf62964b6164528c2a5729066832681292ba1fd13240591f338cbc7c7feb8325e512b07820a1821b67ac286215b4cdeb3f38ea1930c7ece2d5c1d145e6363996bebb76956205cd1bc051d1da58024caebebc7d7a112164cfaa3878d6121d6eec09215b8c265a58ec35e916603889fe708fd3bca89b4871afe31f48a31860b1d509269157551066a42175cab92380b5c964b33175caf6f80781c57d0d1905135fb4a5a3fb6933b4f98e4727ab03390a353771cbc8713c43c946c12a0708e8ebde2ac781010490c804fb8c0516f02567e5ef7837c5219c9cff6675c93d2430b6455c30038cf9b0087cf11bf289821c2093b5a5725d16febd00980a00ca72cbca7969a8581198501254d0f2189f0f9dc0f2eab9d99f3a1f67a1d0d061a92e9156823bcaded20f341d78e161c6ae945674b867b34e94ca8a6a9092644aba0cf982a059467be3512eb4c9d89a3543ab74950c0be65e9df20588e5d661b06b941d52605a75cb173a117e35fce6e8cc4d1ffb14d33772d6cdb388e73e1899676c750630ca3f1b050b7b545bf69f9940e99adc6aae3f9475fe53003edead02f675e5e4ebb984e83f78e158054fde5acd1df47782d35ca59c198051db19fadf18c2e15a10eb5434955e31be70785cdbacfcf98c5850d17334383ce4c634eefb555c4743f421897ee623850647a249f5084ac959efaec0f50a655e021556f92cfc7bdde11750103c2462ebebf4916c61add55347989843329555e091c6327b619db65231373c596281cc5169506245d86cf6d53e2f90df7ea4f252ac1e388454d24155498a1c598962ba4344c7f7163b6b233cdd83eb5f687ed99230e0ba1beabccd70fdbf4f2ce246dd25058eb9fa2e0835962df9bd0d48520d91fe6d245c57fb6f0dbd6e7669c5a2acd648526396171a397878d4c55c83b7f54c9a699de37455191baf2a4e9d5d0f4cf4a98af7ec19d44dd649598bc9bacf8f14c8a6dbaa785a32d741ec166d24052bc2b51d44195e3ce2cd97e46afed7e013bb49cd424bbc2a4ea5908afcff5ddbc9b4cd0feee798ecb433bef43003da6ed3ec43babbc198403a3c5188bd2761ec81533bee53fe1f96576d3fe12faddf8ca00318c1c8d8fe91f44936be26a6cd02b2ceb031c55b570cf191a9fba9fded8f884fb820d9d043d4042215cf2117a31c7e7a0d048f0173d3b712f23d3761b71131432c015de14a8749bf1ca27de0e1e48229786f76813d1733439841a0716a5a22c2003ab8cb233526d3540601486d3ec114c5c06b12ca7e4cd68cce154ffe3a130df4c4b832a64eef6d4da84943fdf9498e1f32a70b7bb9a11033dc121153ea7c17cf008de60b47e20e71b7ed2382a5d6efc0513537dbcdbd19674e1e2b0fd8251da6c5e0934c5567f4263bdd4c950821d9dfed419e5849eb6642a2a42541b6cb3bcbab81354bba51c48cffaa5fc942f0f6b69c56f04de8d3c345543ef536c76e74bc6fa83a4c3ed57dbc429be62d236c420c7a9ed82ecf5d03e13f04b6d782269aa7d35e81496868413e7f4d0ac402924cb6506120614730e7b6aed69c7dc74927a2da099bd7a54f89516f3ccc5c2bb05e5dfa73aec7087f99fb3898de62f44cbf8b48509f455d43ad8d57e3645f0b979113aaa684f1bbfd6797a49b399b5cb6f4d2f2b7fc5090ac5419d4b23861808bb4adc259aff8e5e51addca2f4ba88bff6a0a5df6608d395e552d900cdc47f54d6b04250a12cea7a239c542b9efb9f2f2156233b0b79fb81cdaff64f3502aacf996ef35168b98a8c946157bb880ebae9f313fd8b5ca0a4720092edf7a8f51f36c5a8757abdc507da8444fe15bf40457f305630d545d7d976734e387a7a0d7c370b38f75f4501f7330f3f4ce7141ce1c2b4a86ce68ae6a4803f99dbf96d205135a22abded9dfef4d69f45a21984510731e1d05b67d72376a89ec7343ff9232b16642672e4f0200ec45cf2e069b5ac5c3c608d09e562de14cbccd821865d7220ba172460c881308fa0599210f24f98eb9c4e454ec1ddbf662e54113e9fc8d010ecc2e37a526378f05bfaaa502c4ce4bafd5e608aadfab5fa1b5821c32fcff6127a4cf86b1c0cdd0713660ddb74ab8fa95740cdd6bc70f31a7beb043d8dbcfa9a444efd591b28a607edc0bbaa51b23abc4f42f0940f8c112a4c93d84d9d279cc9b2dc4aa68432a6863770e0850e29c60ec4769aec14a22a9d193f387f6299b83eeab71662ef37adcf0a044029d481fae6dc77e60bc7fe7b2e2c7955c79815e1b7f5003f7ef368baf9d7e51b94061135540862987d5e3ea9e67445e9a5c388af41c748cf0250965a871363a6aa5d4df251f440f896d597883f060cbc4848bbcab2df2c32843ca15edcc227cbeb37c75fa71190fe93b2aa47454328b2a9c7a808d89c3ef84c9ef5dfda97f2f6cddb7b06ac7ddc478a9b739e37305fa8bd6d538d1dc51b7f9ae308c577018960bf599246c5531872159b84bafe672d947f928a875bac926959926346cea8042dd8db139e8f494deac4e5097e1a0e61e2a4caad1a90357ce06a9241627e519ac2c36745c648675030fc538aee67e57c4e6666d0e0d5f213acbfe2dd2e43893728d8cec10539b327b4a4ce84d672e95da8d82a924bbc2fc973048f4c012164ab21e497bc0872c9b7203d09c81debe1ee32d704b75cb575a10376d216c973566ab461440e9220667d92122b56d1427862116467124c090ee79a44fdba5570f5ebadb4a01236932c7234b185c052c73cc2c6bfad076cd9136389fa744a9bc8c50f292c016b7f654a81b4b2d5a44d0069d86bea8413317280a3fb235c24eaee92d889ac6347e908ab3d9d0e79b2b0506e9466ce822db193395cf1be758bb701e100e75a0dc4d2024d3febb4699aee3e00df8e43be9ef572897b7c3ed6be1ec1b4a7719b08e7d96bc9a8ffd000a0b7b0e93740d019052e58c88da7fc7ca3b3da2f91d04922836abcaf68d619131e2b2ba2365365b5a63e78cd6bb6c35422d7de3ecff9b575bfec46f57b4710c0593d15e205a33b9e03bea5c850cda2bd8da1f9eba6747babc6007eb39f610291f82e6f17bc3b48b19efc7a94593aaf598823e45966fa08e637301304d3d2361abd8f84a751a1a448d462d668adebdf4d415bc4fad4bcab6e4dcf21a78da5d8d7a4bbc483e9aa435c3af1f7703d397f916b588b5182e1cb53e38af42d6bdabff049a2dcb4856b59d2e518dc1d9241018c67f42febb7084a06e7d914620ac7848ce257f974cfd549a1b09637cef6aeeee6e829e9666c2687a1d0dcdf262674be4ca3efabe12138f8bda64ce465a0cabe7fb13cd00e5845b5f432e25dcaea27d6f225c02b53361e8fde6ffafaecf40dd4f8d64cd1bb94588d3c66b64dd6e1d0ad2cfde57f844b38c0307fabcc9bb71d5bc3e9b243c30ffaa9190238dd09b87fb9ec697bd86b5f9df8247666e426294e65430aadfa0ff31399fa1cb9255db5f63e21f779263078e8d79d8f649ea76c1b95eb8df798b00345123287c5bcc6822e48470117c7ec1aa2173fb276729418093b1b8ba3e4a42d6fef042170de7d28e5a4970e08789afb394af7b3b273c6084f6c93019f9c33c3097eb751c48370345d6d67d8bd7edf607f5c35d21bce0714611b5e25bd4d3670aa119f80d9b1ac46fafe2f46ac6fdd63e764530683fec4eee3f6345e58e057c9934a91b8f54bc12d7fcdb7c004892e8c6028d46d47ac1e61650874ffaabdad1fc85d2a23579c26ca59eb0abb6b815f118e4a3251dac94c06082cdf596eac9eb233769491eecbd892de79aef3bcc0aa24d7d8c22cb493ce9c3feaa2c50dbb9ae46ad1c33c0b858d4f7cf122e039c89c1747d1838c1c340e0450a9ba856551edb71d1cb7f46ce9441270722bef643e26de7a7cbfe13e2631bc0bdbc391ea76813d062708015e9b9523528d3aac5d702a9c980a6e86ef1fb2d65435f9348d76f97db36a7b9fabde0cc597e8073bac26cf2a34482b8658cf04b0fb2ae2f653c65111287d1803c146eb6dc76c0e553f84029e1df24adb279fbe772f6610a773faaeaab9700584a9eb33fed02aaccb12497840a7addbb32504a870d9e05327cfa7e3b97b41343b30fb8c7fb63a7dfe17f7b71f075a7016fbda7e1ea7d4ea9e594fc2293f9cffbc0e8572a07edb9cae8a60f8e0e9ecc033f4f93e553efc5a89722764f14dd7c90a0669fc87796a649464ee8b98d27c937fec41cb31ac320a189a03503960b5d2cb0fc709af9f313923a8a34a6b8279e33676c677b0bdd30cd619f0d80b458406b2d304421f09e680fa6983afc925efdf76acfb3117cb7b3de5c033c72de2c9692f17f65389eb4cc522b685b7880ccc5b8b3f17642565979cfb07ccdc3cd5142c3dd70b0756840a183c821b86f9c60fae686aa58dfb36a270b434e3f97973ccb146392c7befe7089abf086bd9cf54e24d23ba365f39fca628bc73a505baa752d8457dd767b0bf9cebb02562b9989af08392d7a931d0a6ac862b591223fcb2ef369cc4982d91ba907d51246ac005a5161fa206bc79246e261deac384a9bfa9bd4545eafbfab35472e8959ed2cfc3353ba25337f693f6f8ee463367ba666df2cc86e35ebc5fe8b1cb5a46933bfc7571ff7734a62eea5a839365b13d7f95471d32ce17297f00842684aaa909198bcfb340311ffd53f1694bc853d9f595413aa803a37014a0fe7a78652a91e847c7d37f7c9cb94fe31b676cd24df581f3b5acb31686f0780fa1083b079e8854fbf4b6fb7ec2f326976a6365a06eacee82bb070f133b5ce0a37a2274b1bf5f44a753c052524feb3893fc630230f1228722cba7480e4ccea116dc59ca711f224245ca4d148b15a3106a8ef0dfb0c16c0a104457974f329068de2e3bbaa547b3ad49494b2d1514cdd630ceceff2e465ff5cc8abba38e6f72ba632cc36fbc9d03a639171b7dcc60e0fad0daa1fc7fa747145474de78408ea62eca78b9d3472204c152fd2b0911dde8c4f48c5a5e1781295f92be7eeb1f416bf5fb6e7fb022c22afaa9eb9ed4758d3d9c086c4f67b0590889dd382c021024eb9fe48a8a624d37a78767a7eaef042ffed1d6a404b0e8b39254897d58634539677ff98353b62cbe7be0ae89dd986a58460f8c1c400ba5ce7931be02fe9abb6eb2c2b1601e1864e54ae6ee23d9d0e0f9c91a7c5d3ffa0277b9b577984ed0a6ffa72dfbe8a79e5e9f59d9bac68ea79f1e8baef70a48236ba0d978ff02112c868527c4c8898cec21b1edb3ec5b48c05675264de3c8ae34e6c319f070a1acdf0b4f6ceaf6a6c7bea203f11874a90b86023c26f9a58ea404e1bf669db765339ae70ecb93b496cffcabeefe06aad8b8304c5308d4913d07a97f5855853abe47e8d12fdfb1d6fafe816d6c6a90ef7de4be73cef30bc849fb5be10bbeea3a5cba907d7aa03292aac65ec7e5a4b72991bd3756c014bbb0317411439cb8f3521784bbe3f578108371067d4506cae806dc6e7cd692739c41cbbe1b1260918fd521aa242f7ece76789945488813b27b67a24380a07750688ff43cac6f8f2468d4ccb12924430cc3a6aa4b8528bd9a8779aa92cc25f30b064babb79d0e763b3e3854a3e3b8334dce1d860fc7c5ddcc655188d7ab4d5850a0cb462cf37cb19f685e3e268554850d4678f628272ba8475f2b1226c9b074", TestName = "TupleHash 128 MCT")]
        [TestCase(256, "acb91ac0a42bb1653fdd3b43ce7e8aa259f36dc13301be877363018fbbbddd779b7d8a33", "5bd8d621f62e973f47d29d3eab5575f25b62d59701b06b143a4174d193a1e39300a42aafd31673bbfaf4c30645bbd85b5bed62dd8ab0407cc7baebc50b2a0ec19b96a513f735c2dafb5256ffa5bedf2024b5faaabd2ca724e57c6685da4747d3f166a8d5845d9c81ffdb72d8470c730868a9a35ec1beaa76f7c4627ff9fdfb4c65acf63991d787bbbd9ec9090d3866463b87b0fd81373ea2a5d3deb29651f211e459ad55d6f4c023f71b17f9ce63acd4d5bc4c159c3821030f43d1074a13d051dbbb6b817e379ec064e259cb141f5c8a79a3882404798eb352744519a2ab4f0e69337d0d176f600ca15250511dc16612214a7c7b2045873c2a47f95e6e58a73da617a0c8f5bdfc500a03275f160b048a7503d7990d4e6d21812a3ed53e1b07097d9a6caab6afb97e166e0ba938e44e0dbc0c76cb443422ac59292c7700b8878736d4dc4e2eab74cebb7d465777d8ef99ef4b05fc48372223a0ea65f758dc72e4e357096ef0e943e9b17ed02adde39b98be5066ebfdd6e1867017bb00b2ad74270e5e1d4f79963708857c1b29c59054f8a604102e85fc2657faa0c63fec4d08df0f55c4fb33d589ff3f1d08b3febc35253abf15912c7a8780b2c3fe555494d4164637d4f9cdd45336c53b2d03bb38e9728b4e90f5a87ef504e037c344e2d92edb29f1d5b9bb8807accef3fe8d60e8c659cc1d83011663918b0c9e14b7a60d19b2ba438ae2e9b36c9f677d51045c74d28b786cc8050cf077284c42d2f331b2fd7941946c0f1f42533d816624e24ccd6477d324c67fe81373b60d5e118885ee385264e7122e1ca7b7554100a813955d09e7e4b8f9b0bf95d1d24696d10739e7cabd9c8fcf2c4637a99d8a254b5e26dae641dab36f0910ade78efba23a0d36ad287cb9c0225bfefc105bd6286413148f5ce918e3f7b7a852503014956c11258c509867a0f23ea21ec8b389a49dadf2cf54bb3fc5cf40fea4a118f7a223e4bfcac56eefec926d8f0c3f823a8d8ea25527ab7370e0eceb5440456fbe6e7ba92eb45ec50844ac2c703b06c40c8d6bbec7b77085e4daae918b57ef21357a75746adc5577c20cca16fe3a5e492edf50ad458cfbc2ede5f49dc283229cdf547ace11b65d0cc5cabc6d7546a6a5a2c416648d9e0b70393e5a2f0876a9edf346ae9d5cbbf08a4b8a7e3c38aa2c9108c8be7c565a13d1197bf78f66628a6cebaf84adf0f364477caac54c4af55d2eb247fc58a785225051e27ae53897be82f2552c46b5b0e1de5d1f2540077987f6c1bf46021309317fc5167a1e79110676ce27e8c45ed07315e0816f4e9bd14322274b39b7745a7d90f7dc3110a0bb149ea7a9b7449c04e5b1bd052d5f98aa09ca35cf200b87bd8e8dcadf76056206a95cc8069fc38958265d64bb1f1bf6115b152beb1ecc73af809e6d9dd2ad32f429cbdeff9ddfce33b5221a38106630423e5bdde37285b8d58a1999417c871e7f9bb94726608808a2b8df1b97be16594fd6624561e741b6ef9050420ff444ac4790f7cd8232a7cfdbf954810b0b35c22ff6a0ca6054fed6462bc299d3606e1f6a4e157e352c3ae57f58fa2ff6c0786e656e22468170e16b8067de56c2ac010ab9263f7e8c8e698b2d2a7b77ae075d2f5f03fe7ac3add5ca3135685e70007b18edbcab034b5a66e747b2fafa3871656944724d31e7369ae3235a5713883b708c5f558f34b0212cb43d427418760a21f2d2921e031698070f218c7fa5b15f7bff4b0b1b88999964afad37bf6fb5b36c7466ca81b338aba3a781952c8b923c130cef35f59c54cf6dcdc5f4c841aacc6ba76024ef71c137293b759de270968b048a1f0873a07ffca4eaa1984293e8f08d7ecbc531f6c22f164c589ba1dbbc1b9adbcf4e87580604cda468f85e97a8258a75a6cf519e4d223dcb3560e8ca73b1639d8e761f4016414263f50343d2419dec8243ca33ee3bdfbe5d161e2d15403a0e2090d96d748fd0fa7f0d7d791ef97de3a79528a63513ad9d6d5132867f5da7a025bd4d61698120cc340f058c56beb5572a7f811535b5eb6baad121786f32ce60cf80138ef6a8ee85332e7aea6beebfc7a34b70de44242f6f5edbb6", TestName = "TupleHash 256 MCT")]
        public void ShouldMonteCarloTestTupleHashForSampleSuppliedCase(int digestSize, string message, string digest)
        {
            var subject = new TupleHash_MCT(new Crypto.TupleHash.TupleHash());
            var messageBitStringTuple = new List<BitString>(new BitString[] { new BitString(message) });
            var digestBitString = new BitString(digest);
            var hashFunction = new HashFunction
            {
                Capacity = digestSize * 2,
                DigestLength = digestSize,
                XOF = false
            };

            var domain = new MathDomain();
            domain.AddSegment(new RangeDomainSegment(null, 16, 65536));
            var result = subject.MCTHash(hashFunction, messageBitStringTuple, domain, true, true);

            Assert.IsNotNull(result, "null check");
            Assert.IsTrue(result.Success, result.ErrorMessage);
            
            var resultDigest = result.Response[result.Response.Count - 1].Digest;
            Console.WriteLine(resultDigest.ToHex());
            Assert.AreEqual(digestBitString.BitLength, resultDigest.BitLength);
            Assert.AreEqual(digestBitString.ToHex(), resultDigest.ToHex());
        }
    }
}
