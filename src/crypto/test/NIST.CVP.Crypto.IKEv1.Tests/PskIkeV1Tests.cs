using NIST.CVP.Crypto.Common.Hash.ShaWrapper;
using NIST.CVP.Crypto.Common.KDF.Components.IKEv1.Enums;
using NIST.CVP.Math;
using NIST.CVP.Tests.Core.TestCategoryAttributes;
using NUnit.Framework;

namespace NIST.CVP.Crypto.IKEv1.Tests
{
    [TestFixture, FastCryptoTest]
    public class PskIkeV1Tests
    {
        private readonly IkeV1Factory _factory = new IkeV1Factory();

        [Test]
        [TestCase(ModeValues.SHA1, DigestSizes.d160,
            "1ead7e319ffa3461", "11111bfb76949326",
            "021330da3ce97cd999dba9c23c7b65c7a2a64e98f645fa3fbfd75730", 
            "e0ed2d580d55e1b7", "855e41db01bafb88",
            "a7",
            "ce066bb6939856e17798a7dbd599621d46fb9199", "ae745755722d9d755b8ad9cea17eea05044c69d4", "a4bf03f1582e14ec2b9eab5c3f6427a19d01ed6f", "9e78d632eff0c69b4f4f878c99797c513b37a73e",
            TestName = "PSK IKEv1 - SHA-1")]
        [TestCase(ModeValues.SHA2, DigestSizes.d224,
            "15d5802b0e1e5872666d2950762e119fca9eb8df8a2e39b30f521a6f510971e4fe81bcd69aa07fe47be55c21f421d8593d1cc6a2fb70aee6c135450140b9b3ca1603a3d1019931d606f829896380487245bdb2ced041ccc515a90311f1316d5a3d6629b5db24bc9e6ad5a28c9960bdbe8a29330bfc973839533f02eb6b9522915618ef741507d0147bc197386f152d39025bfe8585e5ac5d2cc734f0eaf54d594522619d5a2267b9178c9550c3269bbdb6488374fbab01f5d5455b69d3c8c05f30e1ffb4123e4a42ad54dfa453a57c4fa08c5fbc9e5f409479a32f0be9ca00912039887acac4d74712763e3a76141112579659c3408b73028437b8e43f9a178a", "0bb19b67b2439a8722bc1ced0eadb95fdfdbf294450d6700242b966c66f5bfbe5fcd9e111f7c3310898cd2e90ccb5c2981e0aac54815da00278139a23e3df4f6f1debf54b28219facd0a87807fccb58179b30a35c6218f48138c07cdc463230adcca8324e4a2cfb77925997ee03905308b8d213656906491f1ee2184fa51a690584e496cc2d22dc38f16522f7a3182fab3ab216c839497a3d01deeb0ae5725cbd086b943fadb31d725c7943c2df13a31c5714099ef3a0f04a8aecf9b119a67075581f50a8fa7c44abf5c46b6069e490ca29a9daf0572db76325d83ec8bd24a56d0c4f4e84eacb414792ca53df188c8646d31b245e1550148a6f247a2025b1fef",
            "1911ef15aed4d9262226ba40b427d5727ad1392a8d387010ac5abe47", 
            "d5676f11d2fe3d8f", "708a518749abd829",
            "61856038d797c3012b782551353e7fc4be81ae98eb87b389c5d61f3c",
            "76ab30a7167856393fe294a4972124b8586466323649e6fa1230f4ba", "c58388170655613975d7f5c9d7974bbfc16cee4e7890bc04bd992389", "a2dda70486e47c2620e5c881473a6cc4befc34c7e1a83fd2372efc39", "4f2f7f5331f9f26bb2651fd187e4266315369d03bd443984d0d8d3ac",
            TestName = "PSK IKEv1 - SHA2-224")]
        [TestCase(ModeValues.SHA2, DigestSizes.d256,
            "bcb61f721e3f546b033551155ac20ae2537bba3ae7df5eb560838c08c1003172e1d873c3bfcc356d22138e450817255047c63c8b0ca24d118cd57d403cdd75690a93c82db1d39c8a2996af1f02917a8ffcd8cdbdb80d84f8077ee144bb832c7b0536ac27c111ee1f3bb7f5e8d6b82c38e2fb702c4a605717c846834bacea514f11fa6edc83e7f8dc5a01a0bb7c21bb8870bfd7695cb1cc1849f001313963c155c6bdd91c589c44dd3eacaa94ca0baa8f16999b093a46f6fad2cbe658824f170a8b136006793adc0274a986f2cc8ef6cec74ce8dbbd837efe2af0564aea1073641e01184502c87efcfdc8223daf07edaa0d87a67e34b9a79f9cf1710e251cc66c", "2e0c1df3129adfcce81353e294e0617dcfdd6cc5c029dfddbeb512e8b203d6212271e0d74d7530495e6295cbb7cdcf7745a99b10ca00c0ad92d3ddcc9422c1cfda31fc9ba49fa2dbe4c567642f79b9dfd156c3c30c7b73ea3264d6f509cabe3f5c20e302a5fec3c18a2047ebb5e95dfad55b1eb245915f767e0ad6822ca2f760a06c071642a137643cadce092a2ebaea0d8714a4a1061c0b6d032b4835491b8eac4573d37f605f4634e74c9030ff17695cec50ce31f5a0149a3dfc458642e94ed43d370751885bd4b296b4f7bb556a7a14db22337ac6c78157884b00f7e7878a2627839082680bfb9497e85e27369cfbf7b707c39c9b9c1b1372c41d6de3623a",
            "8beb2cd063a9ab8b5fd357c1938b3cdecbce38d304fcf7bb1796d9c1", 
            "352c7435ed95fbc8", "9949ba3f9b80642d",
            "779642b61ddf1f3fcc01b8f0bfd50f78363a8563aa880cbb09d71f2d",
            "3dbe693af6582901e3d6d8d0554880cda868d7be3385441f2e8674e2d86a9b3b", "d5f17d7935b769ec54dda77b8d5139f13e6ed3462d0a2532154e74846f0af50b", "3967bc39b3a55dfd17a7780d6a344dd6a564194ee7cafe0b54947722ad4909d9", "996073eae0284fe45743ec7d7ab87c8954b0fa6f27443e531107bf12eb40ee98",
            TestName = "PSK IKEv1 - SHA2-256")]
        [TestCase(ModeValues.SHA2, DigestSizes.d384,
            "b50a3e5731e9732c1153ad812a6bdc680f3d1dfe59ca58915d11f901ecb26da1c52cd861df9f8a091730c3a7d56590ca39f2a85f92857b2b998e1e37b22f5acaa14cf8f9988c22549201101cef07d3dab974d81484f7a49d22cdfb7e564efcca80183b8d652e2e09d25f8dffa5a9f3732ae3dcff530549b452410a69af3483d9916de74e427139aa1499339b8cb88994d60c4a7cf1626e0daad45efcb6ecb52d841696e5265c21e5e169da8406a359ad04b11f402db37bf2d34ac2461174513b08860bcabc3165c43a2175d1efb1a77caa35e5e8413ac43532c22a96bae8fc02a83d06fa802c1c0e013e15f5f98086c4ba95b7d24a8b88d856df205f2b054315", "fa0ba52cdd33933e8b8037ca0375950e6e0fce3d1ae2896a28ad5c5029ce2c7dc156aa9b3a45c4903e746f33a453dead714acd9ed871f93cbd727e5b91ce85ad51f98c83ffef2e2aab44bc07cf2eb0d9ccd83db4fb41dcec099efa4eec25a33d940cfd0cf6dcdc1237524eef91355592c9cd98259e321c9d5237284bb5e3d5cbcd19986e0cc98e7ccfbf8db23976eeead34db487aaf1d6c25b9aabb2188ce3142743a20f7bcc421d1e840cd2604f68b5c14dd02af604500a11c7de1cb60eeb1b5b8a1e7cb56089560d38970240cf85a7b961c5001f993f2f3186f82d3e9b00d43a440e958d5832c6d60603653db86b9cb055a1c7f560f338e871a2042fd23882",
            "faea7f6c2511f460fc72121d0c9d80e48451013385777dc801dfe4b207cfacffaed337097a4350ba593431c9f7309bcc03f42e638928b90938aa10b43da0b662b63cf3976923e32b8de450cae3a053a8433af2a8f91066e3a97feb39feb722e70a693d02add1cf8932b8e110b873568b61d641da95fc7bcabbea246b317e78494685ce8895718ac40f3ae890c3a90de9fd6d1d9205d23e7040cd29f89d686df39f0364f0d52011e11c226ecf6c8bdf1576384f220ae1556814ac7e68690038c0350c93a6a98b9ba1500039de3b693451603d2aaa5cd52d415a373052db301adf3a3e2e658d5bdb9d20d034395c0ab5d10bd5dfbf9240dc4f1850b73f3bd7c746373d7c4faa2207796c1df42f338b090b463dade401edb93e00e9faf37fcea9d7b5591ca04a644d269edfa391d1c0476707a01e56e1fdf95804adcdcc0739cedf9d3f00ef243573a2821778e9c427fca4f6d0a17f91eed93845a6b64c749cf13ef368f76c741d8820ac6b56e6248bb37a631257b4be348c2fa4bc26f2de7de3401e04f03ff5c5854a3f1b9d2bae7bed1d99af7553cc072a7396c299a9c4157527590f885c64cd09d6eeb14c7b822688c90f01fff260a08b501f6720c3668cfe98d7596ff1cb51443e9e7d6ac35383c109a87e4f0350b4cd798963d2a125da62b5b987069a3b3462c5d206ce05e9934038cd81171efa93c45d3a4d31a15dd70c7a9240f85c4f21af38e94fcf865cea49915e3b3a9c69a6008b2041dcf004a001d4dc6d9c67d88deb9403744205c3550bb77e702b654f568dae8854f9c2ecca184f1cafb37c2b73c0bec5f2a3fa5b5fe7fc9cd0495751e0532dab804a0dc5d77d0408f6902263e7a535f4b02d48ea21474db6a34296e33dc541b1fb2cd0fc9cd5849c0cbecbe6ee244d9b52928b5bacd5091f7577bd9e336d58c73cf256e61dc8e9b8496fef0e2e4079221af14e210d73ceec1068c04d8afa1fd573700e52538d835d1f990d345928ec175cb3ba66d39d16983599a7c94f19cc526b51357c4a4b62b594f1df615ca3fb29d71d30c0aa293818d658501c6ec36020cafe518b30c17e0f8933dc909ba03a5bed0e6626558c0115c43b0f9a39fbafeaa3b69ec8c709f11dd46eb477090993eb5fad62056236c1b70cb598a5814c5e83f10ec08ad196158d72eb7322272888257560466d99037f98f2b8aa7e0c5df09ce4bbfdab323e770dac3edb7548453ddcc5f01812c72ad353cfe5ca7da79fd81f710f8b22aed3c1ae45bb5d7986a33db83a07a44562c19ddc6fe25e29b48df28492f18c64c2926fab3b2397b3210c8f76efd3158a430148b2b5c2e2f4675e27368a3bd6c356762856b10279514da01e47f4d2f70f50d1f29ef519d194f6c185944b73b0b4316675faff162cd68e5dbb7ccd1fd06e6d60835c05ec53524bd0fbfb06188e3ab2827a", 
            "d0e03e6960c63147", "83ebc35be5fcbfe5",
            "34596ef78d9919eddd937571338b4768c21f47ff4ea332ce5cf0ef20",
            "bd426fa2b71a652dfa6965fbdb48430c60a7a1ada81b59f24e3987e8e2436dc5692652953a73e2cdffa56cc176ccab74", "bc8bbb4d30dec1d76ea64623f4fae36c27adbe51fdb6bb2ff7dd8360dd0879b9bd30449c448bc532b5b6ccb21b0ff8f2", "3234e636d227b735db8dfafb5ffe1d8c877d59371d136235748c692647c00d2ce9569df9e181d497834e42a3dd162284", "46733ff32591b2abb1f46a45e1c8c8d4ed4180dd984bafd474eb35f862448fe4f3cafedf88487b7a4fd2025997ba562e",
            TestName = "PSK IKEv1 - SHA2-384")]
        [TestCase(ModeValues.SHA2, DigestSizes.d512,
            "62164b51e538b756", "9080a4133c31a75c",
            "49e3295455ce612db2b68c9cee7090cd81b1386417d014dc918ebc93", 
            "886f06fd952162c6", "91dd6e81c6e2feeb",
            "6c",
            "a7265170ff642c28c1cdf8121f2d1c9c6ddb48bb15675e5a5caaae175f1bcebbe94082c767ba94b1fd04ad96cc307bec2f42d5d7ed8b5d2f01b916d8d37cb436", "60c27245e6925e6f2c0abce1a175bb9f1d404898260e9e4d5d9308ea7bf2b3595c34621287a9037919264d6a7c80b8b337e0ab007c35712d0c407a4e385cd1b1", "dcd0bb2cb122e492a2ba6017cd25d8d6b000624d28969062236e683511ee45ea42e8591f06f8c7bda535c49f57e73c658dc37ed66d891fda33ce6f0c794caccf", "2398acdb0a0553542a0fedbef70e04495ed9edae8c3c60546409e1bb0ecb547e54c070d23b1c9226ac9d1f30eccdfb2c4f6462788b4b407148f44df58f8f2629",
            TestName = "PSK IKEv1 - SHA2-512")]
        public void ShouldIkeV1Correctly(ModeValues mode, DigestSizes digestSize, string niHex, string nrHex, string gxyHex, string ckyiHex, string ckyrHex, string pskHex, string sKeyIdHex, string sKeyIdDHex, string sKeyIdAHex, string sKeyIdEHex)
        {
            var ni = new BitString(niHex);
            var nr = new BitString(nrHex);
            var gxy = new BitString(gxyHex);
            var ckyi = new BitString(ckyiHex);
            var ckyr = new BitString(ckyrHex);
            var psk = new BitString(pskHex);
            var sKeyId = new BitString(sKeyIdHex);
            var sKeyIdD = new BitString(sKeyIdDHex);
            var sKeyIdA = new BitString(sKeyIdAHex);
            var sKeyIdE = new BitString(sKeyIdEHex);
            
            var hash = new HashFunction(mode, digestSize);
            var subject = _factory.GetIkeV1Instance(AuthenticationMethods.Psk, hash);

            var result = subject.GenerateIke(ni, nr, gxy, ckyi, ckyr, psk);

            Assert.IsTrue(result.Success);
            Assert.AreEqual(sKeyId, result.SKeyId, "sKeyId");
            Assert.AreEqual(sKeyIdD, result.SKeyIdD, "sKeyIdD");
            Assert.AreEqual(sKeyIdA, result.SKeyIdA, "sKeyIdA");
            Assert.AreEqual(sKeyIdE, result.SKeyIdE, "sKeyIdE");
        }
    }
}
